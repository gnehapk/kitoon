var libs_1 = require('../base/libs');
var DashboardController = (function () {
    function DashboardController(scopeService, $location, $log, intervalSvc, serverService, clusterService) {
        var _this = this;
        this.scopeService = scopeService;
        this.$location = $location;
        this.$log = $log;
        this.intervalSvc = intervalSvc;
        this.serverService = serverService;
        this.clusterService = clusterService;
        this.isLoading = { summaryData: true, utilizationData: true, trendsChartsData: true };
        this.utilization = { data: {}, config: {} };
        this.systemUtilization = { cpu: { data: {}, config: {} }, memory: { data: {}, config: {} } };
        this.utilizationByProfile = {};
        this.mostUsedPools = [];
        this.capacity = {};
        this.clusters = { criticalAlerts: 0, error: 0, nearfull: 0, total: 0 };
        this.hosts = { criticalAlerts: 0, error: 0, total: 0, unaccepted: 0 };
        this.pgs = { total: 0, error: 0, warning: 0 };
        this.osds = { criticalAlerts: 0, error: 0, nearfull: 0, total: 0 };
        this.objects = { criticalAlerts: 0, total: 0 };
        this.pools = { criticalAlerts: 0, down: 0, total: 0 };
        this.monitors = { criticalAlerts: 0, down: 0, total: 0 };
        this.trendsCharts = {
            overall: { title: "", data: { xData: [], yData: [] }, config: {} },
            cpu: { title: "", data: { xData: [], yData: [] }, config: {} },
            memory: { title: "", data: { xData: [], yData: [] }, config: {} },
            iops: { title: "", data: { xData: [], yData: [] }, config: {} },
            throughput: { title: "", data: { xData: [], yData: [] }, config: {} },
            latency: { title: "", data: { xData: [], yData: [] }, config: {} }
        };
        this.timeSlots = [{ name: "Last 1 hour", value: "-1h" },
            { name: "Last 2 hours", value: "-2h" },
            { name: "Last 24 hours", value: "" }];
        this.selectedTimeSlot = this.timeSlots[0];
        // Summary data is returned as empty if there are no clusters in the system.
        // So here we are fetching the cluster list and redirect
        // if no clusters are present
        this.clusterService.getList().then(function (clusters) {
            if (clusters.length === 0) {
                _this.$location.path('/clusters');
            }
            else {
                _this.timer = _this.intervalSvc(function () { return _this.loadDashboardData(); }, 120 * 1000);
                _this.scopeService.$on('$destroy', function () {
                    _this.intervalSvc.cancel(_this.timer);
                });
                _this.loadDashboardData();
            }
        });
    }
    /**
     *This is the callback function called after getting summary data.
    */
    DashboardController.prototype.loadDashboardData = function () {
        var _this = this;
        this.serverService.getDashboardSummary().then(function (summary) {
            _this.summary = summary;
            _this.formatUtilizationData(summary.usage);
            _this.formatUtilizationByProfileData(summary.storageprofileusage, summary.monitoringplugins);
            _this.getMostUsedPools(summary.storageusage);
            _this.osds = summary.slucount;
            _this.hosts = summary.nodescount;
            _this.clusters = summary.clusterscount;
            _this.pools = summary.storagecount;
            if (summary.providermonitoringdetails.ceph) {
                _this.monitors = summary.providermonitoringdetails.ceph.monitor;
                _this.objects.total = summary.providermonitoringdetails.ceph.objects.num_objects;
                _this.objects.criticalAlerts = summary.providermonitoringdetails.ceph.objects.num_objects_degraded;
                _this.pgs = summary.providermonitoringdetails.ceph.pgnum;
            }
            _this.changeTimeSlot(_this.selectedTimeSlot);
            _this.isLoading.summaryData = false;
        });
        this.getOverallUtilization();
    };
    /**
     *This is for overall utilization trend chart.
    */
    DashboardController.prototype.getOverallUtilization = function () {
        var _this = this;
        this.serverService.getSystemOverallUtilization().then(function (overall_utilization) {
            _this.setGraphData(overall_utilization, "overall", "", "%", "large");
        });
    };
    /**
     *This is the helper function for format the overall utilization data.
    */
    DashboardController.prototype.formatUtilizationData = function (usage) {
        this.capacity = usage;
        this.utilization.data = usage;
        this.utilization.config.chartId = "utilizationChart";
        this.utilization.config.thresholds = { 'warning': '60', 'error': '90' };
        this.utilization.config.centerLabelFn = function () {
            return ((usage.used * 100) / usage.total).toFixed(1) + "% Used";
        };
        this.utilization.config.tooltipFn = function (d) {
            return '<span class="donut-tooltip-pf"style="white-space: nowrap;">' +
                libs_1.numeral(d[0].value).format('0 b') + ' ' + d[0].name +
                '</span>';
        };
        this.isLoading.utilizationData = false;
    };
    /**
     *This is the helper function for format the utilization by profile data.
    */
    DashboardController.prototype.formatUtilizationByProfileData = function (profiles, monitoringplugins) {
        var _this = this;
        this.utilizationByProfile.threshold = {};
        monitoringplugins.storage_profile_utilization.configs.forEach(function (config) {
            _this.utilizationByProfile.threshold[config.type] = config.value;
        });
        this.utilizationByProfile.profiles = [];
        var othersProfile = { "used": 0, "total": 0 };
        Object.keys(profiles).forEach(function (profile) {
            var usedData = profiles[profile]["utilization"];
            if (profile === 'default' || profile === 'sas' || profile === 'ssd') {
                _this.utilizationByProfile.profiles.push({ "usage": usedData, "subtitle": profile });
            }
            else {
                othersProfile.used = othersProfile.used + profiles[profile]["utilization"]["used"];
                othersProfile.total = othersProfile.total + profiles[profile]["utilization"]["total"];
            }
        });
        if (othersProfile.total > 0) {
            this.utilizationByProfile.profiles.push({ "usage": { "total": othersProfile.total, "used": othersProfile.used }, "subtitle": "Others" });
        }
    };
    DashboardController.prototype.getMostUsedPools = function (storageUsage) {
        var _this = this;
        this.mostUsedPools = [];
        _.each(storageUsage, function (pool) {
            _this.mostUsedPools.push({ "title": pool["name"], "data": { total: 100, used: pool["usage"]["percentused"] } });
        });
    };
    DashboardController.prototype.getCpuUtilization = function (timeSlot) {
        var _this = this;
        var usage = { "total": 0, "used": 0 };
        if (this.summary.utilizations.cpupercentageusage !== undefined) {
            usage = { "total": 100, "used": this.summary.utilizations.cpupercentageusage };
        }
        this.setGraphUtilization(usage, "cpu");
        this.serverService.getSystemCpuUtilization(timeSlot.value).then(function (cpu_utilization) {
            _this.setGraphData(cpu_utilization, "cpu", "", "%", "large");
        });
    };
    DashboardController.prototype.getMemoryUtilization = function (timeSlot) {
        var _this = this;
        var usage = { "total": 0, "used": 0 };
        if (this.summary.utilizations.memoryusage !== undefined) {
            usage = { "total": this.summary.utilizations.memoryusage.total, "used": this.summary.utilizations.memoryusage.used };
        }
        this.setGraphUtilization(usage, "memory");
        this.serverService.getSystemMemoryUtilization(timeSlot.value).then(function (memory_utilization) {
            _this.setGraphData(memory_utilization, "memory", "", "%", "large");
        });
    };
    DashboardController.prototype.getIOPS = function (timeSlot) {
        var _this = this;
        this.serverService.getIOPS(timeSlot.value).then(function (iops) {
            _this.setGraphData(iops, "iops", "IOPS", "", "compact");
        });
    };
    DashboardController.prototype.getThroughput = function (timeSlot) {
        var _this = this;
        this.serverService.getThroughput(timeSlot.value).then(function (throughput) {
            _this.setGraphData(throughput, "throughput", "Throughput", "B/s", "compact");
        });
    };
    DashboardController.prototype.getNetworkLatency = function (timeSlot) {
        var _this = this;
        this.serverService.getNetworkLatency(timeSlot.value).then(function (network_latency) {
            _this.setGraphData(network_latency, "latency", "Latency", "ms", "compact");
        });
    };
    DashboardController.prototype.setGraphUtilization = function (usage, graphName) {
        this.systemUtilization[graphName].data = usage;
        this.systemUtilization[graphName].config.chartId = graphName;
        this.systemUtilization[graphName].config.thresholds = { 'warning': '60', 'error': '90' };
        this.systemUtilization[graphName].config.tooltipFn = function (d) {
            return '<span class="donut-tooltip-pf"style="white-space: nowrap;">' +
                ((d[0].value * 100) / usage.total).toFixed(1) + '% ' + d[0].name +
                '</span>';
        };
        this.systemUtilization[graphName].config.centerLabelFn = function () {
            return ((usage.used * 100) / usage.total).toFixed(1) + "% Used";
        };
    };
    DashboardController.prototype.setGraphData = function (graphArray, graphName, graphTitle, graphUnits, graphLayout) {
        var times = [];
        var used = [];
        times.push("dates");
        used.push("used");
        var isDataAvailable = false;
        if (graphArray.length !== 0) {
            var usageDataArray = graphArray[0].datapoints;
            isDataAvailable = (usageDataArray.length > 0 ? true : false);
            for (var index in usageDataArray) {
                var subArray = usageDataArray[index];
                times.push(new Date(subArray[1]));
                used.push(subArray[0].toFixed(1));
            }
        }
        this.trendsCharts[graphName] = {
            title: graphTitle,
            data: {
                dataAvailable: isDataAvailable,
                total: 100,
                xData: times,
                yData: used
            },
            config: {
                chartId: graphName,
                title: graphTitle,
                layout: graphLayout,
                valueType: 'actual',
                units: graphUnits,
                tooltipFn: function (d) {
                    return '<span class="donut-tooltip-pf">' +
                        d[0].value + ' ' + graphUnits +
                        '</span>';
                }
            }
        };
        this.isLoading.trendsChartsData = false;
    };
    DashboardController.prototype.changeTimeSlot = function (time) {
        this.selectedTimeSlot = time;
        this.getCpuUtilization(this.selectedTimeSlot);
        this.getMemoryUtilization(this.selectedTimeSlot);
        this.getIOPS(this.selectedTimeSlot);
        this.getThroughput(this.selectedTimeSlot);
        this.getNetworkLatency(this.selectedTimeSlot);
    };
    DashboardController.$inject = [
        '$scope',
        '$location',
        '$log',
        '$interval',
        'ServerService',
        'ClusterService'
    ];
    return DashboardController;
})();
exports.DashboardController = DashboardController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvZGFzaGJvYXJkL2Rhc2hib2FyZC1jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbIkRhc2hib2FyZENvbnRyb2xsZXIiLCJEYXNoYm9hcmRDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiRGFzaGJvYXJkQ29udHJvbGxlci5sb2FkRGFzaGJvYXJkRGF0YSIsIkRhc2hib2FyZENvbnRyb2xsZXIuZ2V0T3ZlcmFsbFV0aWxpemF0aW9uIiwiRGFzaGJvYXJkQ29udHJvbGxlci5mb3JtYXRVdGlsaXphdGlvbkRhdGEiLCJEYXNoYm9hcmRDb250cm9sbGVyLmZvcm1hdFV0aWxpemF0aW9uQnlQcm9maWxlRGF0YSIsIkRhc2hib2FyZENvbnRyb2xsZXIuZ2V0TW9zdFVzZWRQb29scyIsIkRhc2hib2FyZENvbnRyb2xsZXIuZ2V0Q3B1VXRpbGl6YXRpb24iLCJEYXNoYm9hcmRDb250cm9sbGVyLmdldE1lbW9yeVV0aWxpemF0aW9uIiwiRGFzaGJvYXJkQ29udHJvbGxlci5nZXRJT1BTIiwiRGFzaGJvYXJkQ29udHJvbGxlci5nZXRUaHJvdWdocHV0IiwiRGFzaGJvYXJkQ29udHJvbGxlci5nZXROZXR3b3JrTGF0ZW5jeSIsIkRhc2hib2FyZENvbnRyb2xsZXIuc2V0R3JhcGhVdGlsaXphdGlvbiIsIkRhc2hib2FyZENvbnRyb2xsZXIuc2V0R3JhcGhEYXRhIiwiRGFzaGJvYXJkQ29udHJvbGxlci5jaGFuZ2VUaW1lU2xvdCJdLCJtYXBwaW5ncyI6IkFBSUEscUJBQXNCLGNBQWMsQ0FBQyxDQUFBO0FBRXJDO0lBNkJJQSw2QkFBb0JBLFlBQXVCQSxFQUMvQkEsU0FBOEJBLEVBQzlCQSxJQUFvQkEsRUFDcEJBLFdBQWdDQSxFQUNoQ0EsYUFBNEJBLEVBQzVCQSxjQUE4QkE7UUFsQzlDQyxpQkF1UUNBO1FBMU91QkEsaUJBQVlBLEdBQVpBLFlBQVlBLENBQVdBO1FBQy9CQSxjQUFTQSxHQUFUQSxTQUFTQSxDQUFxQkE7UUFDOUJBLFNBQUlBLEdBQUpBLElBQUlBLENBQWdCQTtRQUNwQkEsZ0JBQVdBLEdBQVhBLFdBQVdBLENBQXFCQTtRQUNoQ0Esa0JBQWFBLEdBQWJBLGFBQWFBLENBQWVBO1FBQzVCQSxtQkFBY0EsR0FBZEEsY0FBY0EsQ0FBZ0JBO1FBRWxDQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxFQUFFQSxXQUFXQSxFQUFFQSxJQUFJQSxFQUFFQSxlQUFlQSxFQUFFQSxJQUFJQSxFQUFFQSxnQkFBZ0JBLEVBQUVBLElBQUlBLEVBQUVBLENBQUNBO1FBQ3RGQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxFQUFFQSxJQUFJQSxFQUFFQSxFQUFFQSxFQUFFQSxNQUFNQSxFQUFFQSxFQUFFQSxFQUFFQSxDQUFDQTtRQUM1Q0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxFQUFDQSxHQUFHQSxFQUFDQSxFQUFDQSxJQUFJQSxFQUFDQSxFQUFFQSxFQUFDQSxNQUFNQSxFQUFDQSxFQUFFQSxFQUFDQSxFQUFDQSxNQUFNQSxFQUFDQSxFQUFDQSxJQUFJQSxFQUFDQSxFQUFFQSxFQUFDQSxNQUFNQSxFQUFDQSxFQUFFQSxFQUFDQSxFQUFDQSxDQUFDQTtRQUM5RUEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUMvQkEsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDeEJBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ25CQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxFQUFFQSxjQUFjQSxFQUFFQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxRQUFRQSxFQUFFQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUN2RUEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsRUFBRUEsY0FBY0EsRUFBRUEsQ0FBQ0EsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFBRUEsVUFBVUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDdEVBLElBQUlBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLEVBQUVBLE9BQU9BLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO1FBQzlDQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxFQUFFQSxjQUFjQSxFQUFFQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxRQUFRQSxFQUFFQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUNuRUEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsRUFBRUEsY0FBY0EsRUFBRUEsQ0FBQ0EsRUFBRUEsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7UUFDL0NBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEVBQUVBLGNBQWNBLEVBQUVBLENBQUNBLEVBQUVBLElBQUlBLEVBQUVBLENBQUNBLEVBQUVBLEtBQUtBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO1FBQ3REQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxFQUFFQSxjQUFjQSxFQUFFQSxDQUFDQSxFQUFFQSxJQUFJQSxFQUFFQSxDQUFDQSxFQUFFQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxDQUFDQTtRQUN6REEsSUFBSUEsQ0FBQ0EsWUFBWUEsR0FBR0E7WUFDaEJBLE9BQU9BLEVBQUVBLEVBQUNBLEtBQUtBLEVBQUNBLEVBQUVBLEVBQUNBLElBQUlBLEVBQUNBLEVBQUNBLEtBQUtBLEVBQUNBLEVBQUVBLEVBQUNBLEtBQUtBLEVBQUNBLEVBQUVBLEVBQUNBLEVBQUNBLE1BQU1BLEVBQUNBLEVBQUVBLEVBQUNBO1lBQ3REQSxHQUFHQSxFQUFFQSxFQUFDQSxLQUFLQSxFQUFDQSxFQUFFQSxFQUFDQSxJQUFJQSxFQUFDQSxFQUFDQSxLQUFLQSxFQUFDQSxFQUFFQSxFQUFDQSxLQUFLQSxFQUFDQSxFQUFFQSxFQUFDQSxFQUFDQSxNQUFNQSxFQUFDQSxFQUFFQSxFQUFDQTtZQUNsREEsTUFBTUEsRUFBRUEsRUFBQ0EsS0FBS0EsRUFBQ0EsRUFBRUEsRUFBQ0EsSUFBSUEsRUFBQ0EsRUFBQ0EsS0FBS0EsRUFBQ0EsRUFBRUEsRUFBQ0EsS0FBS0EsRUFBQ0EsRUFBRUEsRUFBQ0EsRUFBQ0EsTUFBTUEsRUFBQ0EsRUFBRUEsRUFBQ0E7WUFDckRBLElBQUlBLEVBQUVBLEVBQUNBLEtBQUtBLEVBQUNBLEVBQUVBLEVBQUNBLElBQUlBLEVBQUNBLEVBQUNBLEtBQUtBLEVBQUNBLEVBQUVBLEVBQUNBLEtBQUtBLEVBQUNBLEVBQUVBLEVBQUNBLEVBQUNBLE1BQU1BLEVBQUNBLEVBQUVBLEVBQUNBO1lBQ25EQSxVQUFVQSxFQUFFQSxFQUFDQSxLQUFLQSxFQUFDQSxFQUFFQSxFQUFDQSxJQUFJQSxFQUFDQSxFQUFDQSxLQUFLQSxFQUFDQSxFQUFFQSxFQUFDQSxLQUFLQSxFQUFDQSxFQUFFQSxFQUFDQSxFQUFDQSxNQUFNQSxFQUFDQSxFQUFFQSxFQUFDQTtZQUN6REEsT0FBT0EsRUFBRUEsRUFBQ0EsS0FBS0EsRUFBQ0EsRUFBRUEsRUFBQ0EsSUFBSUEsRUFBQ0EsRUFBQ0EsS0FBS0EsRUFBQ0EsRUFBRUEsRUFBQ0EsS0FBS0EsRUFBQ0EsRUFBRUEsRUFBQ0EsRUFBQ0EsTUFBTUEsRUFBQ0EsRUFBRUEsRUFBQ0E7U0FDekRBLENBQUNBO1FBQ0ZBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLEVBQUVBLElBQUlBLEVBQUVBLGFBQWFBLEVBQUVBLEtBQUtBLEVBQUVBLEtBQUtBLEVBQUVBO1lBQzFDQSxFQUFFQSxJQUFJQSxFQUFFQSxjQUFjQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQTtZQUN0Q0EsRUFBRUEsSUFBSUEsRUFBRUEsZUFBZUEsRUFBRUEsS0FBS0EsRUFBRUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDbkRBLElBQUlBLENBQUNBLGdCQUFnQkEsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7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QUFnQkEsQ0FBQ0EsQ0FBQ0E7SUFDbERBLENBQUNBO0lBalBNZCwyQkFBT0EsR0FBa0JBO1FBQzVCQSxRQUFRQTtRQUNSQSxXQUFXQTtRQUNYQSxNQUFNQTtRQUNOQSxXQUFXQTtRQUNYQSxlQUFlQTtRQUNmQSxnQkFBZ0JBO0tBQ25CQSxDQUFDQTtJQTRPTkEsMEJBQUNBO0FBQURBLENBdlFBLEFBdVFDQSxJQUFBO0FBdlFZLDJCQUFtQixzQkF1US9CLENBQUEiLCJmaWxlIjoibW9kdWxlcy9kYXNoYm9hcmQvZGFzaGJvYXJkLWNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1NlcnZlclNlcnZpY2V9IGZyb20gJy4uL3Jlc3Qvc2VydmVyJztcbmltcG9ydCB7Q2x1c3RlclNlcnZpY2V9IGZyb20gJy4uL3Jlc3QvY2x1c3RlcnMnO1xuaW1wb3J0IHtEYXNoYm9hcmRTdW1tYXJ5RGF0YX0gZnJvbSAnLi4vcmVzdC9zZXJ2ZXInO1xuaW1wb3J0IHtVc2FnZURhdGF9IGZyb20gJy4uL3Jlc3Qvc2VydmVyJztcbmltcG9ydCB7bnVtZXJhbH0gZnJvbSAnLi4vYmFzZS9saWJzJztcblxuZXhwb3J0IGNsYXNzIERhc2hib2FyZENvbnRyb2xsZXIge1xuICAgIHByaXZhdGUgc3VtbWFyeTogYW55O1xuICAgIHByaXZhdGUgY2x1c3RlcnM6IGFueTtcbiAgICBwcml2YXRlIGhvc3RzOiBhbnk7XG4gICAgcHJpdmF0ZSBwb29sczogYW55O1xuICAgIHByaXZhdGUgcGdzOiBhbnk7XG4gICAgcHJpdmF0ZSBvc2RzOiBhbnk7XG4gICAgcHJpdmF0ZSBvYmplY3RzOiBhbnk7XG4gICAgcHJpdmF0ZSBtb25pdG9yczogYW55O1xuICAgIHByaXZhdGUgY2FwYWNpdHk6IGFueTtcbiAgICBwcml2YXRlIHV0aWxpemF0aW9uOiBhbnk7XG4gICAgcHJpdmF0ZSBzeXN0ZW1VdGlsaXphdGlvbjogYW55O1xuICAgIHByaXZhdGUgdXRpbGl6YXRpb25CeVByb2ZpbGU6IGFueTtcbiAgICBwcml2YXRlIG1vc3RVc2VkUG9vbHM6IGFueTtcbiAgICBwcml2YXRlIHRyZW5kc0NoYXJ0czogYW55O1xuICAgIHByaXZhdGUgdGltZVNsb3RzOiBbe25hbWU6c3RyaW5nLCB2YWx1ZTpzdHJpbmd9XTtcbiAgICBwcml2YXRlIHNlbGVjdGVkVGltZVNsb3Q6IGFueTtcbiAgICBwcml2YXRlIHRpbWVyOiBuZy5JUHJvbWlzZTxhbnk+O1xuICAgIHByaXZhdGUgaXNMb2FkaW5nOiBhbnk7XG5cbiAgICBzdGF0aWMgJGluamVjdDogQXJyYXk8c3RyaW5nPiA9IFtcbiAgICAgICAgJyRzY29wZScsXG4gICAgICAgICckbG9jYXRpb24nLFxuICAgICAgICAnJGxvZycsXG4gICAgICAgICckaW50ZXJ2YWwnLFxuICAgICAgICAnU2VydmVyU2VydmljZScsXG4gICAgICAgICdDbHVzdGVyU2VydmljZSdcbiAgICBdO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzY29wZVNlcnZpY2U6IG5nLklTY29wZSxcbiAgICAgICAgcHJpdmF0ZSAkbG9jYXRpb246IG5nLklMb2NhdGlvblNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgJGxvZzogbmcuSUxvZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgaW50ZXJ2YWxTdmM6IG5nLklJbnRlcnZhbFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgc2VydmVyU2VydmljZTogU2VydmVyU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBjbHVzdGVyU2VydmljZTogQ2x1c3RlclNlcnZpY2UpIHtcblxuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB7IHN1bW1hcnlEYXRhOiB0cnVlLCB1dGlsaXphdGlvbkRhdGE6IHRydWUsIHRyZW5kc0NoYXJ0c0RhdGE6IHRydWUgfTtcbiAgICAgICAgICAgIHRoaXMudXRpbGl6YXRpb24gPSB7IGRhdGE6IHt9LCBjb25maWc6IHt9IH07XG4gICAgICAgICAgICB0aGlzLnN5c3RlbVV0aWxpemF0aW9uID0ge2NwdTp7ZGF0YTp7fSxjb25maWc6e319LG1lbW9yeTp7ZGF0YTp7fSxjb25maWc6e319fTtcbiAgICAgICAgICAgIHRoaXMudXRpbGl6YXRpb25CeVByb2ZpbGUgPSB7fTtcbiAgICAgICAgICAgIHRoaXMubW9zdFVzZWRQb29scyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5jYXBhY2l0eSA9IHt9O1xuICAgICAgICAgICAgdGhpcy5jbHVzdGVycyA9IHsgY3JpdGljYWxBbGVydHM6IDAsIGVycm9yOiAwLCBuZWFyZnVsbDogMCwgdG90YWw6IDAgfTtcbiAgICAgICAgICAgIHRoaXMuaG9zdHMgPSB7IGNyaXRpY2FsQWxlcnRzOiAwLCBlcnJvcjogMCwgdG90YWw6IDAsIHVuYWNjZXB0ZWQ6IDAgfTtcbiAgICAgICAgICAgIHRoaXMucGdzID0geyB0b3RhbDogMCwgZXJyb3I6IDAsIHdhcm5pbmc6IDAgfTtcbiAgICAgICAgICAgIHRoaXMub3NkcyA9IHsgY3JpdGljYWxBbGVydHM6IDAsIGVycm9yOiAwLCBuZWFyZnVsbDogMCwgdG90YWw6IDAgfTtcbiAgICAgICAgICAgIHRoaXMub2JqZWN0cyA9IHsgY3JpdGljYWxBbGVydHM6IDAsIHRvdGFsOiAwIH07XG4gICAgICAgICAgICB0aGlzLnBvb2xzID0geyBjcml0aWNhbEFsZXJ0czogMCwgZG93bjogMCwgdG90YWw6IDAgfTtcbiAgICAgICAgICAgIHRoaXMubW9uaXRvcnMgPSB7IGNyaXRpY2FsQWxlcnRzOiAwLCBkb3duOiAwLCB0b3RhbDogMCB9O1xuICAgICAgICAgICAgdGhpcy50cmVuZHNDaGFydHMgPSB7XG4gICAgICAgICAgICAgICAgb3ZlcmFsbDoge3RpdGxlOlwiXCIsZGF0YTp7eERhdGE6W10seURhdGE6W119LGNvbmZpZzp7fX0sXG4gICAgICAgICAgICAgICAgY3B1OiB7dGl0bGU6XCJcIixkYXRhOnt4RGF0YTpbXSx5RGF0YTpbXX0sY29uZmlnOnt9fSxcbiAgICAgICAgICAgICAgICBtZW1vcnk6IHt0aXRsZTpcIlwiLGRhdGE6e3hEYXRhOltdLHlEYXRhOltdfSxjb25maWc6e319LFxuICAgICAgICAgICAgICAgIGlvcHM6IHt0aXRsZTpcIlwiLGRhdGE6e3hEYXRhOltdLHlEYXRhOltdfSxjb25maWc6e319LFxuICAgICAgICAgICAgICAgIHRocm91Z2hwdXQ6IHt0aXRsZTpcIlwiLGRhdGE6e3hEYXRhOltdLHlEYXRhOltdfSxjb25maWc6e319LFxuICAgICAgICAgICAgICAgIGxhdGVuY3k6IHt0aXRsZTpcIlwiLGRhdGE6e3hEYXRhOltdLHlEYXRhOltdfSxjb25maWc6e319XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy50aW1lU2xvdHMgPSBbeyBuYW1lOiBcIkxhc3QgMSBob3VyXCIsIHZhbHVlOiBcIi0xaFwiIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgeyBuYW1lOiBcIkxhc3QgMiBob3Vyc1wiLCB2YWx1ZTogXCItMmhcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgIHsgbmFtZTogXCJMYXN0IDI0IGhvdXJzXCIsIHZhbHVlOiBcIlwiIH1dO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFRpbWVTbG90ID0gdGhpcy50aW1lU2xvdHNbMF07XG4gICAgICAgICAgICAvLyBTdW1tYXJ5IGRhdGEgaXMgcmV0dXJuZWQgYXMgZW1wdHkgaWYgdGhlcmUgYXJlIG5vIGNsdXN0ZXJzIGluIHRoZSBzeXN0ZW0uXG4gICAgICAgICAgICAvLyBTbyBoZXJlIHdlIGFyZSBmZXRjaGluZyB0aGUgY2x1c3RlciBsaXN0IGFuZCByZWRpcmVjdFxuICAgICAgICAgICAgLy8gaWYgbm8gY2x1c3RlcnMgYXJlIHByZXNlbnRcbiAgICAgICAgICAgIHRoaXMuY2x1c3RlclNlcnZpY2UuZ2V0TGlzdCgpLnRoZW4oKGNsdXN0ZXJzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNsdXN0ZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2NhdGlvbi5wYXRoKCcvY2x1c3RlcnMnKTtcbiAgICAgICAgICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGltZXIgPSB0aGlzLmludGVydmFsU3ZjKCgpID0+IHRoaXMubG9hZERhc2hib2FyZERhdGEoKSwgMTIwICogMTAwMCApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3BlU2VydmljZS4kb24oJyRkZXN0cm95JywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcnZhbFN2Yy5jYW5jZWwodGhpcy50aW1lcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXNoYm9hcmREYXRhKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpUaGlzIGlzIHRoZSBjYWxsYmFjayBmdW5jdGlvbiBjYWxsZWQgYWZ0ZXIgZ2V0dGluZyBzdW1tYXJ5IGRhdGEuXG4gICAgKi9cbiAgICBwdWJsaWMgbG9hZERhc2hib2FyZERhdGEoKSB7XG4gICAgICAgIHRoaXMuc2VydmVyU2VydmljZS5nZXREYXNoYm9hcmRTdW1tYXJ5KCkudGhlbigoc3VtbWFyeSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdW1tYXJ5ID0gc3VtbWFyeTtcbiAgICAgICAgICAgIHRoaXMuZm9ybWF0VXRpbGl6YXRpb25EYXRhKHN1bW1hcnkudXNhZ2UpO1xuICAgICAgICAgICAgdGhpcy5mb3JtYXRVdGlsaXphdGlvbkJ5UHJvZmlsZURhdGEoc3VtbWFyeS5zdG9yYWdlcHJvZmlsZXVzYWdlLCBzdW1tYXJ5Lm1vbml0b3JpbmdwbHVnaW5zKTtcbiAgICAgICAgICAgIHRoaXMuZ2V0TW9zdFVzZWRQb29scyhzdW1tYXJ5LnN0b3JhZ2V1c2FnZSk7XG4gICAgICAgICAgICB0aGlzLm9zZHMgPSBzdW1tYXJ5LnNsdWNvdW50O1xuICAgICAgICAgICAgdGhpcy5ob3N0cyA9IHN1bW1hcnkubm9kZXNjb3VudDtcbiAgICAgICAgICAgIHRoaXMuY2x1c3RlcnMgPSBzdW1tYXJ5LmNsdXN0ZXJzY291bnQ7XG4gICAgICAgICAgICB0aGlzLnBvb2xzID0gc3VtbWFyeS5zdG9yYWdlY291bnQ7XG4gICAgICAgICAgICBpZihzdW1tYXJ5LnByb3ZpZGVybW9uaXRvcmluZ2RldGFpbHMuY2VwaCkge1xuICAgICAgICAgICAgICAgIHRoaXMubW9uaXRvcnMgPSBzdW1tYXJ5LnByb3ZpZGVybW9uaXRvcmluZ2RldGFpbHMuY2VwaC5tb25pdG9yO1xuICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0cy50b3RhbCA9IHN1bW1hcnkucHJvdmlkZXJtb25pdG9yaW5nZGV0YWlscy5jZXBoLm9iamVjdHMubnVtX29iamVjdHM7XG4gICAgICAgICAgICAgICAgdGhpcy5vYmplY3RzLmNyaXRpY2FsQWxlcnRzID0gc3VtbWFyeS5wcm92aWRlcm1vbml0b3JpbmdkZXRhaWxzLmNlcGgub2JqZWN0cy5udW1fb2JqZWN0c19kZWdyYWRlZDtcbiAgICAgICAgICAgICAgICB0aGlzLnBncyA9IHN1bW1hcnkucHJvdmlkZXJtb25pdG9yaW5nZGV0YWlscy5jZXBoLnBnbnVtO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VUaW1lU2xvdCh0aGlzLnNlbGVjdGVkVGltZVNsb3QpO1xuICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcuc3VtbWFyeURhdGEgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ2V0T3ZlcmFsbFV0aWxpemF0aW9uKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpUaGlzIGlzIGZvciBvdmVyYWxsIHV0aWxpemF0aW9uIHRyZW5kIGNoYXJ0LlxuICAgICovXG4gICAgcHVibGljIGdldE92ZXJhbGxVdGlsaXphdGlvbigpIHtcbiAgICAgICAgdGhpcy5zZXJ2ZXJTZXJ2aWNlLmdldFN5c3RlbU92ZXJhbGxVdGlsaXphdGlvbigpLnRoZW4oKG92ZXJhbGxfdXRpbGl6YXRpb24pID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0R3JhcGhEYXRhKG92ZXJhbGxfdXRpbGl6YXRpb24sXCJvdmVyYWxsXCIsXCJcIixcIiVcIixcImxhcmdlXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlRoaXMgaXMgdGhlIGhlbHBlciBmdW5jdGlvbiBmb3IgZm9ybWF0IHRoZSBvdmVyYWxsIHV0aWxpemF0aW9uIGRhdGEuXG4gICAgKi9cbiAgICBwdWJsaWMgZm9ybWF0VXRpbGl6YXRpb25EYXRhKHVzYWdlOiBVc2FnZURhdGEpIHtcbiAgICAgICAgdGhpcy5jYXBhY2l0eSA9IHVzYWdlO1xuICAgICAgICB0aGlzLnV0aWxpemF0aW9uLmRhdGEgPSB1c2FnZVxuICAgICAgICB0aGlzLnV0aWxpemF0aW9uLmNvbmZpZy5jaGFydElkID0gXCJ1dGlsaXphdGlvbkNoYXJ0XCI7XG4gICAgICAgIHRoaXMudXRpbGl6YXRpb24uY29uZmlnLnRocmVzaG9sZHMgPSB7J3dhcm5pbmcnOic2MCcsJ2Vycm9yJzonOTAnfTtcbiAgICAgICAgdGhpcy51dGlsaXphdGlvbi5jb25maWcuY2VudGVyTGFiZWxGbiA9ICgpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuICgodXNhZ2UudXNlZCAqIDEwMCkvdXNhZ2UudG90YWwpLnRvRml4ZWQoMSkgKyBcIiUgVXNlZFwiO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnV0aWxpemF0aW9uLmNvbmZpZy50b29sdGlwRm4gPSAoZCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPVwiZG9udXQtdG9vbHRpcC1wZlwic3R5bGU9XCJ3aGl0ZS1zcGFjZTogbm93cmFwO1wiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICBudW1lcmFsKGRbMF0udmFsdWUpLmZvcm1hdCgnMCBiJykgKyAnICcgKyBkWzBdLm5hbWUgK1xuICAgICAgICAgICAgICAgICAgICAgJzwvc3Bhbj4nO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmlzTG9hZGluZy51dGlsaXphdGlvbkRhdGEgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlRoaXMgaXMgdGhlIGhlbHBlciBmdW5jdGlvbiBmb3IgZm9ybWF0IHRoZSB1dGlsaXphdGlvbiBieSBwcm9maWxlIGRhdGEuXG4gICAgKi9cbiAgICBwdWJsaWMgZm9ybWF0VXRpbGl6YXRpb25CeVByb2ZpbGVEYXRhKHByb2ZpbGVzOiBhbnksIG1vbml0b3JpbmdwbHVnaW5zOiBhbnkpIHtcbiAgICAgICAgdGhpcy51dGlsaXphdGlvbkJ5UHJvZmlsZS50aHJlc2hvbGQgPSB7fTtcbiAgICAgICAgbW9uaXRvcmluZ3BsdWdpbnMuc3RvcmFnZV9wcm9maWxlX3V0aWxpemF0aW9uLmNvbmZpZ3MuZm9yRWFjaCgoY29uZmlnOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXRpbGl6YXRpb25CeVByb2ZpbGUudGhyZXNob2xkW2NvbmZpZy50eXBlXSA9IGNvbmZpZy52YWx1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy51dGlsaXphdGlvbkJ5UHJvZmlsZS5wcm9maWxlcyA9IFtdO1xuICAgICAgICB2YXIgb3RoZXJzUHJvZmlsZTogVXNhZ2VEYXRhID0geyBcInVzZWRcIjogMCwgXCJ0b3RhbFwiOiAwfTtcbiAgICAgICAgT2JqZWN0LmtleXMocHJvZmlsZXMpLmZvckVhY2goKHByb2ZpbGUpID0+IHtcbiAgICAgICAgICAgIHZhciB1c2VkRGF0YTogYW55ID0gcHJvZmlsZXNbcHJvZmlsZV1bXCJ1dGlsaXphdGlvblwiXTtcbiAgICAgICAgICAgIGlmKHByb2ZpbGUgPT09ICdkZWZhdWx0JyB8fCBwcm9maWxlID09PSAnc2FzJyB8fCBwcm9maWxlID09PSAnc3NkJykge1xuICAgICAgICAgICAgICAgIHRoaXMudXRpbGl6YXRpb25CeVByb2ZpbGUucHJvZmlsZXMucHVzaCh7IFwidXNhZ2VcIjp1c2VkRGF0YSwgXCJzdWJ0aXRsZVwiOnByb2ZpbGUgfSk7XG4gICAgICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICAgICAgb3RoZXJzUHJvZmlsZS51c2VkID0gb3RoZXJzUHJvZmlsZS51c2VkICsgcHJvZmlsZXNbcHJvZmlsZV1bXCJ1dGlsaXphdGlvblwiXVtcInVzZWRcIl07XG4gICAgICAgICAgICAgICAgb3RoZXJzUHJvZmlsZS50b3RhbCA9IG90aGVyc1Byb2ZpbGUudG90YWwgKyBwcm9maWxlc1twcm9maWxlXVtcInV0aWxpemF0aW9uXCJdW1widG90YWxcIl07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAob3RoZXJzUHJvZmlsZS50b3RhbCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMudXRpbGl6YXRpb25CeVByb2ZpbGUucHJvZmlsZXMucHVzaCh7IFwidXNhZ2VcIiA6IHsgXCJ0b3RhbFwiOiBvdGhlcnNQcm9maWxlLnRvdGFsLCBcInVzZWRcIjogb3RoZXJzUHJvZmlsZS51c2VkIH0gLCBcInN1YnRpdGxlXCIgOiBcIk90aGVyc1wiIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldE1vc3RVc2VkUG9vbHMoc3RvcmFnZVVzYWdlKSB7XG4gICAgICAgIHRoaXMubW9zdFVzZWRQb29scyA9IFtdO1xuICAgICAgICBfLmVhY2goc3RvcmFnZVVzYWdlLCAocG9vbCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tb3N0VXNlZFBvb2xzLnB1c2goe1widGl0bGVcIjpwb29sW1wibmFtZVwiXSxcImRhdGFcIjoge3RvdGFsOiAxMDAsIHVzZWQ6IHBvb2xbXCJ1c2FnZVwiXVtcInBlcmNlbnR1c2VkXCJdfX0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Q3B1VXRpbGl6YXRpb24odGltZVNsb3Q6IGFueSkge1xuICAgICAgICB2YXIgdXNhZ2U6IGFueSA9IHtcInRvdGFsXCI6IDAsXCJ1c2VkXCI6IDB9O1xuICAgICAgICBpZih0aGlzLnN1bW1hcnkudXRpbGl6YXRpb25zLmNwdXBlcmNlbnRhZ2V1c2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB1c2FnZSA9IHsgXCJ0b3RhbFwiOjEwMCwgXCJ1c2VkXCI6IHRoaXMuc3VtbWFyeS51dGlsaXphdGlvbnMuY3B1cGVyY2VudGFnZXVzYWdlIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldEdyYXBoVXRpbGl6YXRpb24odXNhZ2UsIFwiY3B1XCIpO1xuICAgICAgICB0aGlzLnNlcnZlclNlcnZpY2UuZ2V0U3lzdGVtQ3B1VXRpbGl6YXRpb24odGltZVNsb3QudmFsdWUpLnRoZW4oKGNwdV91dGlsaXphdGlvbikgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRHcmFwaERhdGEoY3B1X3V0aWxpemF0aW9uLFwiY3B1XCIsXCJcIixcIiVcIixcImxhcmdlXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TWVtb3J5VXRpbGl6YXRpb24odGltZVNsb3Q6IGFueSkge1xuICAgICAgICB2YXIgdXNhZ2U6IGFueSA9IHtcInRvdGFsXCI6IDAsXCJ1c2VkXCI6IDB9O1xuICAgICAgICBpZih0aGlzLnN1bW1hcnkudXRpbGl6YXRpb25zLm1lbW9yeXVzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHVzYWdlID0geyBcInRvdGFsXCI6dGhpcy5zdW1tYXJ5LnV0aWxpemF0aW9ucy5tZW1vcnl1c2FnZS50b3RhbCwgXCJ1c2VkXCI6IHRoaXMuc3VtbWFyeS51dGlsaXphdGlvbnMubWVtb3J5dXNhZ2UudXNlZCB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRHcmFwaFV0aWxpemF0aW9uKHVzYWdlLCBcIm1lbW9yeVwiKTtcbiAgICAgICAgdGhpcy5zZXJ2ZXJTZXJ2aWNlLmdldFN5c3RlbU1lbW9yeVV0aWxpemF0aW9uKHRpbWVTbG90LnZhbHVlKS50aGVuKChtZW1vcnlfdXRpbGl6YXRpb24pID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0R3JhcGhEYXRhKG1lbW9yeV91dGlsaXphdGlvbixcIm1lbW9yeVwiLFwiXCIsXCIlXCIsXCJsYXJnZVwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldElPUFModGltZVNsb3Q6IGFueSkge1xuICAgICAgICB0aGlzLnNlcnZlclNlcnZpY2UuZ2V0SU9QUyh0aW1lU2xvdC52YWx1ZSkudGhlbigoaW9wcykgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRHcmFwaERhdGEoaW9wcyxcImlvcHNcIixcIklPUFNcIixcIlwiLFwiY29tcGFjdFwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFRocm91Z2hwdXQodGltZVNsb3Q6IGFueSkge1xuICAgICAgICB0aGlzLnNlcnZlclNlcnZpY2UuZ2V0VGhyb3VnaHB1dCh0aW1lU2xvdC52YWx1ZSkudGhlbigodGhyb3VnaHB1dCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRHcmFwaERhdGEodGhyb3VnaHB1dCxcInRocm91Z2hwdXRcIixcIlRocm91Z2hwdXRcIixcIkIvc1wiLFwiY29tcGFjdFwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE5ldHdvcmtMYXRlbmN5KHRpbWVTbG90OiBhbnkpIHtcbiAgICAgICAgdGhpcy5zZXJ2ZXJTZXJ2aWNlLmdldE5ldHdvcmtMYXRlbmN5KHRpbWVTbG90LnZhbHVlKS50aGVuKChuZXR3b3JrX2xhdGVuY3kpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0R3JhcGhEYXRhKG5ldHdvcmtfbGF0ZW5jeSxcImxhdGVuY3lcIixcIkxhdGVuY3lcIixcIm1zXCIsXCJjb21wYWN0XCIpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0R3JhcGhVdGlsaXphdGlvbih1c2FnZSwgZ3JhcGhOYW1lKSB7XG4gICAgICAgIHRoaXMuc3lzdGVtVXRpbGl6YXRpb25bZ3JhcGhOYW1lXS5kYXRhID0gdXNhZ2VcbiAgICAgICAgdGhpcy5zeXN0ZW1VdGlsaXphdGlvbltncmFwaE5hbWVdLmNvbmZpZy5jaGFydElkID0gZ3JhcGhOYW1lO1xuICAgICAgICB0aGlzLnN5c3RlbVV0aWxpemF0aW9uW2dyYXBoTmFtZV0uY29uZmlnLnRocmVzaG9sZHMgPSB7J3dhcm5pbmcnOic2MCcsJ2Vycm9yJzonOTAnfTtcbiAgICAgICAgdGhpcy5zeXN0ZW1VdGlsaXphdGlvbltncmFwaE5hbWVdLmNvbmZpZy50b29sdGlwRm4gPSAoZCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPVwiZG9udXQtdG9vbHRpcC1wZlwic3R5bGU9XCJ3aGl0ZS1zcGFjZTogbm93cmFwO1wiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAoKGRbMF0udmFsdWUgKiAxMDApL3VzYWdlLnRvdGFsKS50b0ZpeGVkKDEpICsgJyUgJyArIGRbMF0ubmFtZSArXG4gICAgICAgICAgICAgICAgICAgICAnPC9zcGFuPic7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuc3lzdGVtVXRpbGl6YXRpb25bZ3JhcGhOYW1lXS5jb25maWcuY2VudGVyTGFiZWxGbiA9ICgpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuICgodXNhZ2UudXNlZCAqIDEwMCkvdXNhZ2UudG90YWwpLnRvRml4ZWQoMSkgKyBcIiUgVXNlZFwiO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRHcmFwaERhdGEoZ3JhcGhBcnJheSwgZ3JhcGhOYW1lLCBncmFwaFRpdGxlLCBncmFwaFVuaXRzLCBncmFwaExheW91dCkge1xuICAgICAgICB2YXIgdGltZXMgPSBbXTtcbiAgICAgICAgdmFyIHVzZWQgPSBbXTtcbiAgICAgICAgdGltZXMucHVzaChcImRhdGVzXCIpO1xuICAgICAgICB1c2VkLnB1c2goXCJ1c2VkXCIpO1xuICAgICAgICB2YXIgaXNEYXRhQXZhaWxhYmxlOiBib29sZWFuID0gZmFsc2U7XG4gICAgICAgIGlmKGdyYXBoQXJyYXkubGVuZ3RoICE9PSAwICkge1xuICAgICAgICAgICAgdmFyIHVzYWdlRGF0YUFycmF5ID0gZ3JhcGhBcnJheVswXS5kYXRhcG9pbnRzO1xuICAgICAgICAgICAgaXNEYXRhQXZhaWxhYmxlID0gKHVzYWdlRGF0YUFycmF5Lmxlbmd0aCA+IDAgPyB0cnVlIDogZmFsc2UpO1xuICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggaW4gdXNhZ2VEYXRhQXJyYXkpIHtcbiAgICAgICAgICAgICAgdmFyIHN1YkFycmF5ID0gdXNhZ2VEYXRhQXJyYXlbaW5kZXhdO1xuICAgICAgICAgICAgICB0aW1lcy5wdXNoKG5ldyBEYXRlKHN1YkFycmF5WzFdKSk7XG4gICAgICAgICAgICAgIHVzZWQucHVzaChzdWJBcnJheVswXS50b0ZpeGVkKDEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRyZW5kc0NoYXJ0c1tncmFwaE5hbWVdID0ge1xuICAgICAgICAgICAgdGl0bGU6IGdyYXBoVGl0bGUsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICBkYXRhQXZhaWxhYmxlOiBpc0RhdGFBdmFpbGFibGUsXG4gICAgICAgICAgICAgICAgICB0b3RhbDogMTAwLFxuICAgICAgICAgICAgICAgICAgeERhdGE6IHRpbWVzLFxuICAgICAgICAgICAgICAgICAgeURhdGE6IHVzZWRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBjaGFydElkICAgICAgOiAgZ3JhcGhOYW1lLFxuICAgICAgICAgICAgICAgIHRpdGxlICAgICAgICA6ICBncmFwaFRpdGxlLFxuICAgICAgICAgICAgICAgIGxheW91dCAgICAgICA6ICBncmFwaExheW91dCxcbiAgICAgICAgICAgICAgICB2YWx1ZVR5cGUgICAgOiAnYWN0dWFsJyxcbiAgICAgICAgICAgICAgICB1bml0cyAgICAgICAgOiAgZ3JhcGhVbml0cyxcbiAgICAgICAgICAgICAgICB0b29sdGlwRm4gICAgOiAgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICAnPHNwYW4gY2xhc3M9XCJkb251dC10b29sdGlwLXBmXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZFswXS52YWx1ZSArICcgJyArIGdyYXBoVW5pdHMgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzTG9hZGluZy50cmVuZHNDaGFydHNEYXRhID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcHVibGljIGNoYW5nZVRpbWVTbG90KHRpbWU6IGFueSkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkVGltZVNsb3QgPSB0aW1lO1xuICAgICAgICB0aGlzLmdldENwdVV0aWxpemF0aW9uKHRoaXMuc2VsZWN0ZWRUaW1lU2xvdCk7XG4gICAgICAgIHRoaXMuZ2V0TWVtb3J5VXRpbGl6YXRpb24odGhpcy5zZWxlY3RlZFRpbWVTbG90KTtcbiAgICAgICAgdGhpcy5nZXRJT1BTKHRoaXMuc2VsZWN0ZWRUaW1lU2xvdCk7XG4gICAgICAgIHRoaXMuZ2V0VGhyb3VnaHB1dCh0aGlzLnNlbGVjdGVkVGltZVNsb3QpO1xuICAgICAgICB0aGlzLmdldE5ldHdvcmtMYXRlbmN5KHRoaXMuc2VsZWN0ZWRUaW1lU2xvdCk7XG4gICAgfVxuXG59XG4iXX0=
