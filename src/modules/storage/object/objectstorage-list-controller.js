/// <reference path="../../../../typings/tsd.d.ts" />
var ModalHelpers = require('../../modal/modal-helpers');
var ObjectStorageListController = (function () {
    function ObjectStorageListController($scope, $interval, $location, $log, $timeout, $q, $modal, clusterSvc, storageSvc, requestSvc, requestTrackingSvc, growl) {
        var _this = this;
        this.$scope = $scope;
        this.$interval = $interval;
        this.$location = $location;
        this.$log = $log;
        this.$timeout = $timeout;
        this.$q = $q;
        this.$modal = $modal;
        this.clusterSvc = clusterSvc;
        this.storageSvc = storageSvc;
        this.requestSvc = requestSvc;
        this.requestTrackingSvc = requestTrackingSvc;
        this.growl = growl;
        this.clusterMap = {};
        this.ecprofiles = [];
        this.ecprofiles['default'] = '2+1';
        this.ecprofiles['k4m2'] = '4+2';
        this.ecprofiles['k6m3'] = '6+3';
        this.ecprofiles['k8m4'] = '8+4';
        this.paramsObject = $location.search();
        if (Object.keys(this.paramsObject).length > 0) {
            if ("tab" in this.paramsObject) {
                delete this.paramsObject.tab;
            }
            this.updateSearchQuery(this.paramsObject);
        }
        this.timer = this.$interval(function () { return _this.refresh(); }, 60000);
        this.$scope.$on('$destroy', function () {
            _this.$interval.cancel(_this.timer);
        });
        this.refresh();
        this.clusterSvc.getList().then(function (clusterlist) {
            _this.clusters = clusterlist;
        });
    }
    ObjectStorageListController.prototype.isArray = function (data) {
        return data instanceof Array;
    };
    ObjectStorageListController.prototype.updateSearchQuery = function (paramsObject) {
        var _this = this;
        this.searchQuery = '';
        /*  paramsObject can have 3 case : -
                1) { status: [error,warning] , tab: <OSD,HOST,etc> }
                2) { tab: <OSD,HOST,etc> }
                3) { status: [error,warning] }
            and searchQuery will be like this : -
            /api/<ver>/clusters?status=ok&status=warning&tab=<HOST/OSD/etc>
        */
        Object.keys(paramsObject).forEach(function (value) {
            var joinedStr = "";
            if (paramsObject[value] instanceof Array) {
                var queryArray = paramsObject[value].map(function (status) {
                    return value + '=' + status;
                });
                joinedStr = queryArray.join('&');
            }
            else {
                joinedStr = value + "=" + paramsObject[value];
            }
            if (_this.searchQuery !== '') {
                _this.searchQuery += "&";
            }
            _this.searchQuery += joinedStr;
        });
    };
    ObjectStorageListController.prototype.clearSearchQuery = function (key, itemIndex) {
        if (itemIndex === null) {
            delete this.paramsObject[key];
        }
        else {
            this.paramsObject[key].splice(itemIndex, 1);
        }
        this.updateSearchQuery(this.paramsObject);
        this.refresh();
    };
    ObjectStorageListController.prototype.refresh = function () {
        var _this = this;
        if (this.clusterId) {
            // Current storage resource doesn't have cluster name, so here
            // we are fetching the cluster(s) in the system
            // This code will be removed once the storage resource includes
            // cluster name
            this.clusterSvc.get(this.clusterId).then(function (cluster) {
                _this.clusterMap[cluster.clusterid] = cluster;
                if (_this.searchQuery === '') {
                    return _this.storageSvc.getListByCluster(_this.clusterId);
                }
                else {
                    return _this.storageSvc.getFilteredListByCluster(_this.clusterId, _this.searchQuery);
                }
            }).then(function (list) {
                _this.loadData(list);
            });
        }
        else {
            this.clusterSvc.getList().then(function (clusters) {
                var requests = [];
                _.each(clusters, function (cluster) {
                    _this.clusterMap[cluster.clusterid] = cluster;
                });
                if (_this.searchQuery === '') {
                    return _this.storageSvc.getList();
                }
                else {
                    return _this.storageSvc.getFilteredList(_this.searchQuery);
                }
            }).then(function (list) {
                _this.loadData(list);
            });
        }
    };
    ObjectStorageListController.prototype.loadData = function (storages) {
        this.list = storages;
    };
    ObjectStorageListController.prototype.getClusterName = function (clusterid) {
        return this.clusterMap[clusterid].name;
    };
    ObjectStorageListController.prototype.create = function () {
        this.$location.path('/storage/new');
    };
    ObjectStorageListController.prototype.remove = function (storage) {
        var _this = this;
        var modal = ModalHelpers.RemoveConfirmation(this.$modal, {});
        modal.$scope.$hide = _.wrap(modal.$scope.$hide, function ($hide, confirmed) {
            if (confirmed) {
                _this.storageSvc.delete(storage.clusterid, storage.storageid).then(function (task) {
                    _this.requestSvc.get(task.data.taskid).then(function (result) {
                        _this.requestTrackingSvc.add(result.id, result.name);
                    });
                });
            }
            $hide();
        });
    };
    ObjectStorageListController.prototype.createCluster = function () {
        this.$location.path('/clusters/new');
    };
    ObjectStorageListController.prototype.isupdateNeed = function (storage, updatedStorage) {
        if (storage.replicas !== this.editPool.replicas || storage.quota_enabled !== updatedStorage.quota_enabled ||
            storage.quota_params.quota_max_bytes !== updatedStorage.quota_params.quota_max_bytes ||
            storage.quota_params.quota_max_objects !== updatedStorage.quota_params.quota_max_objects) {
            return true;
        }
    };
    ObjectStorageListController.prototype.update = function (storage) {
        var _this = this;
        var pool;
        pool = {
            quota_enabled: false,
            quota_params: {
                quota_max_bytes: "0",
                quota_max_objects: "0"
            }
        };
        pool.quota_enabled = this.editPool.quota_enabled;
        if (this.editPool.quota_enabled) {
            if (this.enable_quota_max_objects) {
                pool.quota_params.quota_max_objects = this.editPool.quota_params.quota_max_objects.toString();
            }
            if (this.enable_max_percentage) {
                pool.quota_params.quota_max_bytes = Math.round((this.maxPercentage / 100) * this.editPool.usage.total).toString();
            }
        }
        if (storage.type === 'replicated') {
            pool.replicas = this.editPool.replicas;
        }
        if (this.isupdateNeed(storage, pool)) {
            // PoolName should be update seperately... so that need to make two different calls*/
            this.storageSvc.update(storage.clusterid, storage.storageid, pool)
                .catch(function (error) {
                _this.growl.error("Cannot update pool" + storage.name);
            })
                .then(function (success) {
                if (!_this.updateName(storage)) {
                    _this.growl.success(storage.name + " update initiated");
                }
            });
        }
        else {
            this.updateName(storage);
        }
        this.timer = this.$interval(function () { return _this.refresh(); }, 60000);
    };
    ObjectStorageListController.prototype.updateName = function (storage) {
        var _this = this;
        if (storage.name != this.editPool.name) {
            var poolName = {
                name: this.editPool.name
            };
            this.storageSvc.update(storage.clusterid, storage.storageid, poolName).catch(function (error) {
                _this.growl.error("Cannot update pool name " + storage.name);
            }).then(function (success) {
                _this.growl.success(storage.name + " update initiated");
            });
            return true;
        }
        else {
            return false;
        }
    };
    ObjectStorageListController.prototype.edit = function (storage) {
        this.$interval.cancel(this.timer);
        this.timer = undefined;
        this.editPool = _.cloneDeep(storage);
        if (this.editPool.quota_params.quota_max_bytes) {
            this.enable_max_percentage = true;
            this.maxPercentage = Math.round((this.editPool.quota_params.quota_max_bytes / this.editPool.usage.total) * 100);
        }
        if (this.editPool.quota_params.quota_max_objects) {
            this.editPool.quota_params.quota_max_objects = parseInt(this.editPool.quota_params.quota_max_objects, 10);
            this.enable_quota_max_objects = true;
        }
    };
    ObjectStorageListController.$inject = [
        '$scope',
        '$interval',
        '$location',
        '$log',
        '$timeout',
        '$q',
        '$modal',
        'ClusterService',
        'StorageService',
        'RequestService',
        'RequestTrackingService',
        'growl'
    ];
    return ObjectStorageListController;
})();
exports.ObjectStorageListController = ObjectStorageListController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvc3RvcmFnZS9vYmplY3Qvb2JqZWN0c3RvcmFnZS1saXN0LWNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiT2JqZWN0U3RvcmFnZUxpc3RDb250cm9sbGVyIiwiT2JqZWN0U3RvcmFnZUxpc3RDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiT2JqZWN0U3RvcmFnZUxpc3RDb250cm9sbGVyLmlzQXJyYXkiLCJPYmplY3RTdG9yYWdlTGlzdENvbnRyb2xsZXIudXBkYXRlU2VhcmNoUXVlcnkiLCJPYmplY3RTdG9yYWdlTGlzdENvbnRyb2xsZXIuY2xlYXJTZWFyY2hRdWVyeSIsIk9iamVjdFN0b3JhZ2VMaXN0Q29udHJvbGxlci5yZWZyZXNoIiwiT2JqZWN0U3RvcmFnZUxpc3RDb250cm9sbGVyLmxvYWREYXRhIiwiT2JqZWN0U3RvcmFnZUxpc3RDb250cm9sbGVyLmdldENsdXN0ZXJOYW1lIiwiT2JqZWN0U3RvcmFnZUxpc3RDb250cm9sbGVyLmNyZWF0ZSIsIk9iamVjdFN0b3JhZ2VMaXN0Q29udHJvbGxlci5yZW1vdmUiLCJPYmplY3RTdG9yYWdlTGlzdENvbnRyb2xsZXIuY3JlYXRlQ2x1c3RlciIsIk9iamVjdFN0b3JhZ2VMaXN0Q29udHJvbGxlci5pc3VwZGF0ZU5lZWQiLCJPYmplY3RTdG9yYWdlTGlzdENvbnRyb2xsZXIudXBkYXRlIiwiT2JqZWN0U3RvcmFnZUxpc3RDb250cm9sbGVyLnVwZGF0ZU5hbWUiLCJPYmplY3RTdG9yYWdlTGlzdENvbnRyb2xsZXIuZWRpdCJdLCJtYXBwaW5ncyI6IkFBQUEscURBQXFEO0FBUXJELElBQVksWUFBWSxXQUFNLDJCQUEyQixDQUFDLENBQUE7QUFFMUQ7SUE0QklBLHFDQUNZQSxNQUFpQkEsRUFDakJBLFNBQThCQSxFQUM5QkEsU0FBOEJBLEVBQzlCQSxJQUFvQkEsRUFDcEJBLFFBQTRCQSxFQUM1QkEsRUFBZ0JBLEVBQ2hCQSxNQUFXQSxFQUNYQSxVQUEwQkEsRUFDMUJBLFVBQTBCQSxFQUMxQkEs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S0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDcEhBLENBQUNBO1FBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLFlBQVlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDL0NBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLFlBQVlBLENBQUNBLGlCQUFpQkEsR0FBR0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUMxR0EsSUFBSUEsQ0FBQ0Esd0JBQXdCQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN6Q0EsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFsT01kLG1DQUFPQSxHQUFrQkE7UUFDNUJBLFFBQVFBO1FBQ1JBLFdBQVdBO1FBQ1hBLFdBQVdBO1FBQ1hBLE1BQU1BO1FBQ05BLFVBQVVBO1FBQ1ZBLElBQUlBO1FBQ0pBLFFBQVFBO1FBQ1JBLGdCQUFnQkE7UUFDaEJBLGdCQUFnQkE7UUFDaEJBLGdCQUFnQkE7UUFDaEJBLHdCQUF3QkE7UUFDeEJBLE9BQU9BO0tBQ1ZBLENBQUNBO0lBc05OQSxrQ0FBQ0E7QUFBREEsQ0FqUEEsQUFpUENBLElBQUE7QUFqUFksbUNBQTJCLDhCQWlQdkMsQ0FBQSIsImZpbGUiOiJtb2R1bGVzL3N0b3JhZ2Uvb2JqZWN0L29iamVjdHN0b3JhZ2UtbGlzdC1jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uLy4uL3R5cGluZ3MvdHNkLmQudHNcIiAvPlxuXG5pbXBvcnQge1V0aWxTZXJ2aWNlfSBmcm9tICcuLi8uLi9yZXN0L3V0aWwnO1xuaW1wb3J0IHtDbHVzdGVyU2VydmljZX0gZnJvbSAnLi4vLi4vcmVzdC9jbHVzdGVycyc7XG5pbXBvcnQge1N0b3JhZ2VTZXJ2aWNlfSBmcm9tICcuLi8uLi9yZXN0L3N0b3JhZ2UnO1xuaW1wb3J0IHtSZXF1ZXN0U2VydmljZX0gZnJvbSAnLi4vLi4vcmVzdC9yZXF1ZXN0JztcbmltcG9ydCB7UmVxdWVzdFRyYWNraW5nU2VydmljZX0gZnJvbSAnLi4vLi4vcmVxdWVzdHMvcmVxdWVzdC10cmFja2luZy1zdmMnO1xuaW1wb3J0IHtudW1lcmFsfSBmcm9tICcuLi8uLi9iYXNlL2xpYnMnO1xuaW1wb3J0ICogYXMgTW9kYWxIZWxwZXJzIGZyb20gJy4uLy4uL21vZGFsL21vZGFsLWhlbHBlcnMnO1xuXG5leHBvcnQgY2xhc3MgT2JqZWN0U3RvcmFnZUxpc3RDb250cm9sbGVyIHtcbiAgICBwcml2YXRlIGNsdXN0ZXJJZDogc3RyaW5nO1xuICAgIHByaXZhdGUgbGlzdDogQXJyYXk8YW55PjtcbiAgICBwcml2YXRlIGNsdXN0ZXJNYXAgPSB7fTtcbiAgICBwcml2YXRlIHRpbWVyO1xuICAgIHByaXZhdGUgY2x1c3RlcnM7XG4gICAgcHJpdmF0ZSBjYXBhY2l0eTtcbiAgICBwcml2YXRlIGVkaXRQb29sO1xuICAgIHByaXZhdGUgbWF4UGVyY2VudGFnZTtcbiAgICBwcml2YXRlIGVuYWJsZV9tYXhfcGVyY2VudGFnZTtcbiAgICBwcml2YXRlIGVuYWJsZV9xdW90YV9tYXhfb2JqZWN0cztcbiAgICBwcml2YXRlIGVjcHJvZmlsZXMgPSBbXTtcbiAgICBwcml2YXRlIHNlYXJjaFF1ZXJ5OiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBwYXJhbXNPYmplY3Q6IGFueTtcbiAgICBzdGF0aWMgJGluamVjdDogQXJyYXk8c3RyaW5nPiA9IFtcbiAgICAgICAgJyRzY29wZScsXG4gICAgICAgICckaW50ZXJ2YWwnLFxuICAgICAgICAnJGxvY2F0aW9uJyxcbiAgICAgICAgJyRsb2cnLFxuICAgICAgICAnJHRpbWVvdXQnLFxuICAgICAgICAnJHEnLFxuICAgICAgICAnJG1vZGFsJyxcbiAgICAgICAgJ0NsdXN0ZXJTZXJ2aWNlJyxcbiAgICAgICAgJ1N0b3JhZ2VTZXJ2aWNlJyxcbiAgICAgICAgJ1JlcXVlc3RTZXJ2aWNlJyxcbiAgICAgICAgJ1JlcXVlc3RUcmFja2luZ1NlcnZpY2UnLFxuICAgICAgICAnZ3Jvd2wnXG4gICAgXTtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSAkc2NvcGU6IG5nLklTY29wZSxcbiAgICAgICAgcHJpdmF0ZSAkaW50ZXJ2YWw6IG5nLklJbnRlcnZhbFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgJGxvY2F0aW9uOiBuZy5JTG9jYXRpb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlICRsb2c6IG5nLklMb2dTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlICR0aW1lb3V0OiBuZy5JVGltZW91dFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgJHE6IG5nLklRU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSAkbW9kYWw6IGFueSxcbiAgICAgICAgcHJpdmF0ZSBjbHVzdGVyU3ZjOiBDbHVzdGVyU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBzdG9yYWdlU3ZjOiBTdG9yYWdlU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByZXF1ZXN0U3ZjOiBSZXF1ZXN0U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByZXF1ZXN0VHJhY2tpbmdTdmM6IFJlcXVlc3RUcmFja2luZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgZ3Jvd2w6IGFueSkge1xuICAgICAgICB0aGlzLmVjcHJvZmlsZXNbJ2RlZmF1bHQnXSA9ICcyKzEnO1xuICAgICAgICB0aGlzLmVjcHJvZmlsZXNbJ2s0bTInXSA9ICc0KzInO1xuICAgICAgICB0aGlzLmVjcHJvZmlsZXNbJ2s2bTMnXSA9ICc2KzMnO1xuICAgICAgICB0aGlzLmVjcHJvZmlsZXNbJ2s4bTQnXSA9ICc4KzQnO1xuICAgICAgICB0aGlzLnBhcmFtc09iamVjdCA9ICRsb2NhdGlvbi5zZWFyY2goKTtcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMucGFyYW1zT2JqZWN0KS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBpZiAoXCJ0YWJcIiBpbiB0aGlzLnBhcmFtc09iamVjdCkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBhcmFtc09iamVjdC50YWI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlYXJjaFF1ZXJ5KHRoaXMucGFyYW1zT2JqZWN0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWVyID0gdGhpcy4kaW50ZXJ2YWwoKCkgPT4gdGhpcy5yZWZyZXNoKCksIDYwMDAwKTtcbiAgICAgICAgdGhpcy4kc2NvcGUuJG9uKCckZGVzdHJveScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJGludGVydmFsLmNhbmNlbCh0aGlzLnRpbWVyKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgICAgICB0aGlzLmNsdXN0ZXJTdmMuZ2V0TGlzdCgpLnRoZW4oY2x1c3Rlcmxpc3QgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbHVzdGVycyA9IGNsdXN0ZXJsaXN0O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNBcnJheShkYXRhKTogQm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBkYXRhIGluc3RhbmNlb2YgQXJyYXk7XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZVNlYXJjaFF1ZXJ5KHBhcmFtc09iamVjdDogYW55KSB7XG4gICAgICAgIHRoaXMuc2VhcmNoUXVlcnkgPSAnJztcbiAgICAgICAgLyogIHBhcmFtc09iamVjdCBjYW4gaGF2ZSAzIGNhc2UgOiAtXG4gICAgICAgICAgICAgICAgMSkgeyBzdGF0dXM6IFtlcnJvcix3YXJuaW5nXSAsIHRhYjogPE9TRCxIT1NULGV0Yz4gfVxuICAgICAgICAgICAgICAgIDIpIHsgdGFiOiA8T1NELEhPU1QsZXRjPiB9XG4gICAgICAgICAgICAgICAgMykgeyBzdGF0dXM6IFtlcnJvcix3YXJuaW5nXSB9XG4gICAgICAgICAgICBhbmQgc2VhcmNoUXVlcnkgd2lsbCBiZSBsaWtlIHRoaXMgOiAtXG4gICAgICAgICAgICAvYXBpLzx2ZXI+L2NsdXN0ZXJzP3N0YXR1cz1vayZzdGF0dXM9d2FybmluZyZ0YWI9PEhPU1QvT1NEL2V0Yz5cbiAgICAgICAgKi9cbiAgICAgICAgT2JqZWN0LmtleXMocGFyYW1zT2JqZWN0KS5mb3JFYWNoKCh2YWx1ZTogYW55KSA9PiB7XG4gICAgICAgICAgICBsZXQgam9pbmVkU3RyID0gXCJcIjtcbiAgICAgICAgICAgIGlmIChwYXJhbXNPYmplY3RbdmFsdWVdIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcXVlcnlBcnJheSA9IHBhcmFtc09iamVjdFt2YWx1ZV0ubWFwKGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgKyAnPScgKyBzdGF0dXM7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBqb2luZWRTdHIgPSBxdWVyeUFycmF5LmpvaW4oJyYnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgam9pbmVkU3RyID0gdmFsdWUgKyBcIj1cIiArIHBhcmFtc09iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5zZWFyY2hRdWVyeSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFF1ZXJ5ICs9IFwiJlwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNlYXJjaFF1ZXJ5ICs9IGpvaW5lZFN0cjtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNsZWFyU2VhcmNoUXVlcnkoa2V5LCBpdGVtSW5kZXgpIHtcbiAgICAgICAgaWYgKGl0ZW1JbmRleCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMucGFyYW1zT2JqZWN0W2tleV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBhcmFtc09iamVjdFtrZXldLnNwbGljZShpdGVtSW5kZXgsIDEpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlU2VhcmNoUXVlcnkodGhpcy5wYXJhbXNPYmplY3QpO1xuICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVmcmVzaCgpIHtcbiAgICAgICAgaWYgKHRoaXMuY2x1c3RlcklkKSB7XG4gICAgICAgICAgICAvLyBDdXJyZW50IHN0b3JhZ2UgcmVzb3VyY2UgZG9lc24ndCBoYXZlIGNsdXN0ZXIgbmFtZSwgc28gaGVyZVxuICAgICAgICAgICAgLy8gd2UgYXJlIGZldGNoaW5nIHRoZSBjbHVzdGVyKHMpIGluIHRoZSBzeXN0ZW1cbiAgICAgICAgICAgIC8vIFRoaXMgY29kZSB3aWxsIGJlIHJlbW92ZWQgb25jZSB0aGUgc3RvcmFnZSByZXNvdXJjZSBpbmNsdWRlc1xuICAgICAgICAgICAgLy8gY2x1c3RlciBuYW1lXG4gICAgICAgICAgICB0aGlzLmNsdXN0ZXJTdmMuZ2V0KHRoaXMuY2x1c3RlcklkKS50aGVuKChjbHVzdGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbHVzdGVyTWFwW2NsdXN0ZXIuY2x1c3RlcmlkXSA9IGNsdXN0ZXI7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VhcmNoUXVlcnkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2VTdmMuZ2V0TGlzdEJ5Q2x1c3Rlcih0aGlzLmNsdXN0ZXJJZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZVN2Yy5nZXRGaWx0ZXJlZExpc3RCeUNsdXN0ZXIodGhpcy5jbHVzdGVySWQsIHRoaXMuc2VhcmNoUXVlcnkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnRoZW4obGlzdCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YShsaXN0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jbHVzdGVyU3ZjLmdldExpc3QoKS50aGVuKChjbHVzdGVyczogQXJyYXk8YW55PikgPT4ge1xuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0cyA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZWFjaChjbHVzdGVycywgKGNsdXN0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbHVzdGVyTWFwW2NsdXN0ZXIuY2x1c3RlcmlkXSA9IGNsdXN0ZXI7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VhcmNoUXVlcnkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2VTdmMuZ2V0TGlzdCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2VTdmMuZ2V0RmlsdGVyZWRMaXN0KHRoaXMuc2VhcmNoUXVlcnkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnRoZW4obGlzdCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YShsaXN0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGxvYWREYXRhKHN0b3JhZ2VzKSB7XG4gICAgICAgIHRoaXMubGlzdCA9IHN0b3JhZ2VzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDbHVzdGVyTmFtZShjbHVzdGVyaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2x1c3Rlck1hcFtjbHVzdGVyaWRdLm5hbWU7XG4gICAgfVxuXG4gICAgcHVibGljIGNyZWF0ZSgpIHtcbiAgICAgICAgdGhpcy4kbG9jYXRpb24ucGF0aCgnL3N0b3JhZ2UvbmV3Jyk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbW92ZShzdG9yYWdlKSB7XG4gICAgICAgIHZhciBtb2RhbCA9IE1vZGFsSGVscGVycy5SZW1vdmVDb25maXJtYXRpb24odGhpcy4kbW9kYWwsIHtcbiAgICAgICAgfSk7XG4gICAgICAgIG1vZGFsLiRzY29wZS4kaGlkZSA9IF8ud3JhcChtb2RhbC4kc2NvcGUuJGhpZGUsICgkaGlkZSwgY29uZmlybWVkOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICBpZiAoY29uZmlybWVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9yYWdlU3ZjLmRlbGV0ZShzdG9yYWdlLmNsdXN0ZXJpZCwgc3RvcmFnZS5zdG9yYWdlaWQpLnRoZW4oKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0U3ZjLmdldCh0YXNrLmRhdGEudGFza2lkKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFRyYWNraW5nU3ZjLmFkZChyZXN1bHQuaWQsIHJlc3VsdC5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkaGlkZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY3JlYXRlQ2x1c3RlcigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy4kbG9jYXRpb24ucGF0aCgnL2NsdXN0ZXJzL25ldycpO1xuICAgIH1cblxuICAgIHB1YmxpYyBpc3VwZGF0ZU5lZWQoc3RvcmFnZSwgdXBkYXRlZFN0b3JhZ2UpIHtcbiAgICAgICAgaWYgKHN0b3JhZ2UucmVwbGljYXMgIT09IHRoaXMuZWRpdFBvb2wucmVwbGljYXMgfHwgc3RvcmFnZS5xdW90YV9lbmFibGVkICE9PSB1cGRhdGVkU3RvcmFnZS5xdW90YV9lbmFibGVkIHx8XG4gICAgICAgICAgICBzdG9yYWdlLnF1b3RhX3BhcmFtcy5xdW90YV9tYXhfYnl0ZXMgIT09IHVwZGF0ZWRTdG9yYWdlLnF1b3RhX3BhcmFtcy5xdW90YV9tYXhfYnl0ZXMgfHxcbiAgICAgICAgICAgIHN0b3JhZ2UucXVvdGFfcGFyYW1zLnF1b3RhX21heF9vYmplY3RzICE9PSB1cGRhdGVkU3RvcmFnZS5xdW90YV9wYXJhbXMucXVvdGFfbWF4X29iamVjdHMpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZShzdG9yYWdlKTogdm9pZCB7XG4gICAgICAgIGxldCBwb29sO1xuICAgICAgICBwb29sID0ge1xuICAgICAgICAgICAgcXVvdGFfZW5hYmxlZDogZmFsc2UsXG4gICAgICAgICAgICBxdW90YV9wYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBxdW90YV9tYXhfYnl0ZXM6IFwiMFwiLFxuICAgICAgICAgICAgICAgIHF1b3RhX21heF9vYmplY3RzOiBcIjBcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBwb29sLnF1b3RhX2VuYWJsZWQgPSB0aGlzLmVkaXRQb29sLnF1b3RhX2VuYWJsZWQ7XG4gICAgICAgIGlmICh0aGlzLmVkaXRQb29sLnF1b3RhX2VuYWJsZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmVuYWJsZV9xdW90YV9tYXhfb2JqZWN0cykge1xuICAgICAgICAgICAgICAgIHBvb2wucXVvdGFfcGFyYW1zLnF1b3RhX21heF9vYmplY3RzID0gdGhpcy5lZGl0UG9vbC5xdW90YV9wYXJhbXMucXVvdGFfbWF4X29iamVjdHMudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmVuYWJsZV9tYXhfcGVyY2VudGFnZSkge1xuICAgICAgICAgICAgICAgIHBvb2wucXVvdGFfcGFyYW1zLnF1b3RhX21heF9ieXRlcyA9IE1hdGgucm91bmQoKHRoaXMubWF4UGVyY2VudGFnZSAvIDEwMCkgKiB0aGlzLmVkaXRQb29sLnVzYWdlLnRvdGFsKS50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzdG9yYWdlLnR5cGUgPT09ICdyZXBsaWNhdGVkJykge1xuICAgICAgICAgICAgcG9vbC5yZXBsaWNhcyA9IHRoaXMuZWRpdFBvb2wucmVwbGljYXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXN1cGRhdGVOZWVkKHN0b3JhZ2UsIHBvb2wpKSB7XG4gICAgICAgICAgICAvLyBQb29sTmFtZSBzaG91bGQgYmUgdXBkYXRlIHNlcGVyYXRlbHkuLi4gc28gdGhhdCBuZWVkIHRvIG1ha2UgdHdvIGRpZmZlcmVudCBjYWxscyovXG4gICAgICAgICAgICB0aGlzLnN0b3JhZ2VTdmMudXBkYXRlKHN0b3JhZ2UuY2x1c3RlcmlkLCBzdG9yYWdlLnN0b3JhZ2VpZCwgcG9vbClcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyb3dsLmVycm9yKFwiQ2Fubm90IHVwZGF0ZSBwb29sXCIgKyBzdG9yYWdlLm5hbWUpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oc3VjY2VzcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnVwZGF0ZU5hbWUoc3RvcmFnZSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncm93bC5zdWNjZXNzKHN0b3JhZ2UubmFtZSArIFwiIHVwZGF0ZSBpbml0aWF0ZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTmFtZShzdG9yYWdlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWVyID0gdGhpcy4kaW50ZXJ2YWwoKCkgPT4gdGhpcy5yZWZyZXNoKCksIDYwMDAwKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlTmFtZShzdG9yYWdlKSB7XG4gICAgICAgIGlmIChzdG9yYWdlLm5hbWUgIT0gdGhpcy5lZGl0UG9vbC5uYW1lKSB7XG4gICAgICAgICAgICBsZXQgcG9vbE5hbWUgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5lZGl0UG9vbC5uYW1lXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5zdG9yYWdlU3ZjLnVwZGF0ZShzdG9yYWdlLmNsdXN0ZXJpZCwgc3RvcmFnZS5zdG9yYWdlaWQsIHBvb2xOYW1lKS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm93bC5lcnJvcihcIkNhbm5vdCB1cGRhdGUgcG9vbCBuYW1lIFwiICsgc3RvcmFnZS5uYW1lKTtcbiAgICAgICAgICAgIH0pLnRoZW4oc3VjY2VzcyA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm93bC5zdWNjZXNzKHN0b3JhZ2UubmFtZSArIFwiIHVwZGF0ZSBpbml0aWF0ZWRcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBlZGl0KHN0b3JhZ2UpIHtcbiAgICAgICAgdGhpcy4kaW50ZXJ2YWwuY2FuY2VsKHRoaXMudGltZXIpO1xuICAgICAgICB0aGlzLnRpbWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmVkaXRQb29sID0gXy5jbG9uZURlZXAoc3RvcmFnZSk7XG4gICAgICAgIGlmICh0aGlzLmVkaXRQb29sLnF1b3RhX3BhcmFtcy5xdW90YV9tYXhfYnl0ZXMpIHtcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlX21heF9wZXJjZW50YWdlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMubWF4UGVyY2VudGFnZSA9IE1hdGgucm91bmQoKHRoaXMuZWRpdFBvb2wucXVvdGFfcGFyYW1zLnF1b3RhX21heF9ieXRlcyAvIHRoaXMuZWRpdFBvb2wudXNhZ2UudG90YWwpICogMTAwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5lZGl0UG9vbC5xdW90YV9wYXJhbXMucXVvdGFfbWF4X29iamVjdHMpIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdFBvb2wucXVvdGFfcGFyYW1zLnF1b3RhX21heF9vYmplY3RzID0gcGFyc2VJbnQodGhpcy5lZGl0UG9vbC5xdW90YV9wYXJhbXMucXVvdGFfbWF4X29iamVjdHMsIDEwKTtcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlX3F1b3RhX21heF9vYmplY3RzID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
