// <reference path="../../../typings/tsd.d.ts" />
var StorageNewController = (function () {
    function StorageNewController($location, clusterSvc) {
        var _this = this;
        this.$location = $location;
        this.clusterSvc = clusterSvc;
        this.clusters = [];
        this.clusterSvc.getList().then(function (clusters) {
            _this.clusters = clusters;
            if (_this.clusters.length > 0) {
                _this.cluster = _this.clusters[0];
                _this.validateCluster(_this.cluster);
            }
        });
        this.type = "object";
        this.paramsObject = $location.search();
        if (this.paramsObject.type !== undefined) {
            if (this.paramsObject.type === 'block') {
                this.type = this.paramsObject.type;
            }
        }
    }
    StorageNewController.prototype.validateCluster = function (cluster) {
        var _this = this;
        this.clusterSvc.get(cluster.clusterid).then(function (result) {
            if (result.state == 2) {
                return _this.clusterSvc.getClusterSummary(cluster.clusterid);
            }
            else {
                _this.errorMessage = "Cluster is not active";
            }
        }).then(function (summary) {
            if (summary.slucount.total) {
                _this.errorMessage = "";
            }
            else {
                _this.errorMessage = "There is no OSD in the selected cluster";
            }
        });
    };
    StorageNewController.prototype.next = function () {
        if (this.cluster) {
            if (this.type === 'object') {
                this.addGenericStorage();
            }
            else if (this.type === 'block') {
                this.addBlockStorage();
            }
        }
    };
    StorageNewController.prototype.cancel = function () {
        if (this.type === 'object') {
            this.$location.path('/storage/');
        }
        else if (this.type === 'block') {
            this.$location.path('/rbds/');
        }
    };
    StorageNewController.prototype.addGenericStorage = function () {
        this.$location.search({});
        this.$location.path('/storage/new/object/' + this.cluster.clusterid);
    };
    StorageNewController.prototype.addBlockStorage = function () {
        this.$location.search({});
        this.$location.path('/storage/new/block/' + this.cluster.clusterid);
    };
    StorageNewController.$inject = [
        '$location',
        'ClusterService'
    ];
    return StorageNewController;
})();
exports.StorageNewController = StorageNewController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvc3RvcmFnZS9zdG9yYWdlLW5ldy50cyJdLCJuYW1lcyI6WyJTdG9yYWdlTmV3Q29udHJvbGxlciIsIlN0b3JhZ2VOZXdDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiU3RvcmFnZU5ld0NvbnRyb2xsZXIudmFsaWRhdGVDbHVzdGVyIiwiU3RvcmFnZU5ld0NvbnRyb2xsZXIubmV4dCIsIlN0b3JhZ2VOZXdDb250cm9sbGVyLmNhbmNlbCIsIlN0b3JhZ2VOZXdDb250cm9sbGVyLmFkZEdlbmVyaWNTdG9yYWdlIiwiU3RvcmFnZU5ld0NvbnRyb2xsZXIuYWRkQmxvY2tTdG9yYWdlIl0sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7QUFLakQ7SUFZSUEsOEJBQW9CQSxTQUE4QkEsRUFDdENBLFVBQTBCQTtRQWIxQ0MsaUJBOEVDQTtRQWxFdUJBLGNBQVNBLEdBQVRBLFNBQVNBLENBQXFCQTtRQUN0Q0EsZUFBVUEsR0FBVkEsVUFBVUEsQ0FBZ0JBO1FBQ2xDQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNuQkEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBQ0EsUUFBUUE7WUFDcENBLEtBQUlBLENBQUNBLFFBQVFBLEdBQUdBLFFBQVFBLENBQUNBO1lBQ3pCQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDM0JBLEtBQUlBLENBQUNBLE9BQU9BLEdBQUdBLEtBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNoQ0EsS0FBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsS0FBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7WUFDdkNBLENBQUNBO1FBQ0xBLENBQUNBLENBQUNBLENBQUNBO1FBQ0hBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLFFBQVFB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QUFFQSxDQUFDQSxDQUFDQTtRQUMxQkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0Esc0JBQXNCQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtJQUN6RUEsQ0FBQ0E7SUFFTUwsOENBQWVBLEdBQXRCQTtRQUNJTSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUMxQkEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EscUJBQXFCQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtJQUN4RUEsQ0FBQ0E7SUF0RU1OLDRCQUFPQSxHQUFrQkE7UUFDNUJBLFdBQVdBO1FBQ1hBLGdCQUFnQkE7S0FDbkJBLENBQUNBO0lBb0VOQSwyQkFBQ0E7QUFBREEsQ0E5RUEsQUE4RUNBLElBQUE7QUE5RVksNEJBQW9CLHVCQThFaEMsQ0FBQSIsImZpbGUiOiJtb2R1bGVzL3N0b3JhZ2Uvc3RvcmFnZS1uZXcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi90eXBpbmdzL3RzZC5kLnRzXCIgLz5cblxuaW1wb3J0IHtDbHVzdGVyU2VydmljZX0gZnJvbSAnLi4vcmVzdC9jbHVzdGVycyc7XG5pbXBvcnQge0NsdXN0ZXJ9IGZyb20gJy4uL3Jlc3QvY2x1c3RlcnMnO1xuXG5leHBvcnQgY2xhc3MgU3RvcmFnZU5ld0NvbnRyb2xsZXIge1xuICAgIHByaXZhdGUgY2x1c3RlcnM6IEFycmF5PENsdXN0ZXI+O1xuICAgIHByaXZhdGUgY2x1c3RlcjogQ2x1c3RlcjtcbiAgICBwcml2YXRlIGVycm9yTWVzc2FnZTogc3RyaW5nO1xuICAgIHByaXZhdGUgdHlwZTogU3RyaW5nO1xuICAgIHByaXZhdGUgcGFyYW1zT2JqZWN0OiBhbnk7XG5cbiAgICBzdGF0aWMgJGluamVjdDogQXJyYXk8c3RyaW5nPiA9IFtcbiAgICAgICAgJyRsb2NhdGlvbicsXG4gICAgICAgICdDbHVzdGVyU2VydmljZSdcbiAgICBdO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSAkbG9jYXRpb246IG5nLklMb2NhdGlvblNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgY2x1c3RlclN2YzogQ2x1c3RlclNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5jbHVzdGVycyA9IFtdO1xuICAgICAgICB0aGlzLmNsdXN0ZXJTdmMuZ2V0TGlzdCgpLnRoZW4oKGNsdXN0ZXJzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsdXN0ZXJzID0gY2x1c3RlcnM7XG4gICAgICAgICAgICBpZiAodGhpcy5jbHVzdGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbHVzdGVyID0gdGhpcy5jbHVzdGVyc1swXTtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbGlkYXRlQ2x1c3Rlcih0aGlzLmNsdXN0ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50eXBlID0gXCJvYmplY3RcIjtcbiAgICAgICAgdGhpcy5wYXJhbXNPYmplY3QgPSAkbG9jYXRpb24uc2VhcmNoKCk7XG4gICAgICAgIGlmICh0aGlzLnBhcmFtc09iamVjdC50eXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmKHRoaXMucGFyYW1zT2JqZWN0LnR5cGUgPT09ICdibG9jaycpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSB0aGlzLnBhcmFtc09iamVjdC50eXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHZhbGlkYXRlQ2x1c3RlcihjbHVzdGVyKTp2b2lkIHtcbiAgICAgICAgdGhpcy5jbHVzdGVyU3ZjLmdldChjbHVzdGVyLmNsdXN0ZXJpZCkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZihyZXN1bHQuc3RhdGUgPT0gMikge1xuICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbHVzdGVyU3ZjLmdldENsdXN0ZXJTdW1tYXJ5KGNsdXN0ZXIuY2x1c3RlcmlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gXCJDbHVzdGVyIGlzIG5vdCBhY3RpdmVcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkudGhlbigoc3VtbWFyeSkgPT4ge1xuICAgICAgICAgICAgaWYoc3VtbWFyeS5zbHVjb3VudC50b3RhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gXCJUaGVyZSBpcyBubyBPU0QgaW4gdGhlIHNlbGVjdGVkIGNsdXN0ZXJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIG5leHQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmNsdXN0ZXIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRHZW5lcmljU3RvcmFnZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy50eXBlID09PSAnYmxvY2snKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRCbG9ja1N0b3JhZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjYW5jZWwoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0aGlzLiRsb2NhdGlvbi5wYXRoKCcvc3RvcmFnZS8nKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnR5cGUgPT09ICdibG9jaycpIHtcbiAgICAgICAgICAgIHRoaXMuJGxvY2F0aW9uLnBhdGgoJy9yYmRzLycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGFkZEdlbmVyaWNTdG9yYWdlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLiRsb2NhdGlvbi5zZWFyY2goe30pO1xuICAgICAgICB0aGlzLiRsb2NhdGlvbi5wYXRoKCcvc3RvcmFnZS9uZXcvb2JqZWN0LycgKyB0aGlzLmNsdXN0ZXIuY2x1c3RlcmlkKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkQmxvY2tTdG9yYWdlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLiRsb2NhdGlvbi5zZWFyY2goe30pO1xuICAgICAgICB0aGlzLiRsb2NhdGlvbi5wYXRoKCcvc3RvcmFnZS9uZXcvYmxvY2svJyArIHRoaXMuY2x1c3Rlci5jbHVzdGVyaWQpO1xuICAgIH1cbn1cbiJdfQ==
