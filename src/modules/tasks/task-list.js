// <reference path="../../../typings/tsd.d.ts" />
var TaskListController = (function () {
    function TaskListController($scope, $interval, $location, requestSvc) {
        var _this = this;
        this.$scope = $scope;
        this.$interval = $interval;
        this.$location = $location;
        this.requestSvc = requestSvc;
        this.pageNo = 1;
        this.pageSize = 20;
        this.totalPages = 1;
        this.taskStatus = ['Inprogress', 'Completed', 'Failed'];
        this.totalCount = 0;
        this.selectedStatus = [];
        this.filterObject = {};
        this.timer = this.$interval(function () { return _this.refresh(); }, 5000);
        this.$scope.$on('$destroy', function () {
            _this.$interval.cancel(_this.timer);
        });
        this.refresh();
    }
    TaskListController.prototype.refresh = function () {
        var _this = this;
        this.requestSvc.getList(this.pageNo, this.pageSize, this.selectedStatus, this.fromDateTimeFilter, this.toDateTimeFilter, this.searchQuery).then(function (data) {
            _this.totalCount = data.totalcount;
            _this.totalPages = Math.ceil(data.totalcount / _this.pageSize);
            _this.loadData(data.tasks);
        });
    };
    TaskListController.prototype.paginate = function (pageNo) {
        if (pageNo < 1 || pageNo > this.totalPages)
            return;
        this.pageNo = pageNo;
        this.refresh();
    };
    TaskListController.prototype.loadData = function (tasks) {
        var list = [];
        _.each(tasks, function (task) {
            var firstStatus = _.first(task.statuslist);
            if (firstStatus) {
                task.timestamp = firstStatus.Timestamp;
            }
            list.push(task);
        });
        this.list = list;
    };
    TaskListController.prototype.viewDetails = function (taskId) {
        this.$location.path('/tasks/' + taskId);
    };
    TaskListController.prototype.toggleSelection = function (status) {
        var idx = this.selectedStatus.indexOf(status);
        if (idx > -1) {
            this.selectedStatus.splice(idx, 1);
        }
        else {
            this.selectedStatus.push(status);
        }
        this.filterObject["status"] = this.selectedStatus;
        this.refresh();
    };
    TaskListController.prototype.applyFilter = function (key, value) {
        if (value.length === 0) {
            delete this.filterObject[key];
        }
        else {
            this.filterObject[key] = value;
        }
        this.refresh();
    };
    TaskListController.prototype.resetFilters = function () {
        delete this.filterObject["from"];
        delete this.filterObject["to"];
        delete this.filterObject["search"];
        this.filterObject["status"] = [];
        this.fromDateTimeFilter = this.filterObject["from"];
        this.toDateTimeFilter = this.filterObject["to"];
        this.selectedStatus = this.filterObject["status"];
        this.searchQuery = this.filterObject["search"];
    };
    TaskListController.prototype.clearFilter = function (key) {
        if (key === "status") {
            this.filterObject[key] = [];
        }
        else {
            delete this.filterObject[key];
        }
        this.fromDateTimeFilter = this.filterObject["from"];
        this.toDateTimeFilter = this.filterObject["to"];
        this.selectedStatus = this.filterObject["status"];
        this.searchQuery = this.filterObject["search"];
    };
    TaskListController.$inject = [
        '$scope',
        '$interval',
        '$location',
        'RequestService'
    ];
    return TaskListController;
})();
exports.TaskListController = TaskListController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvdGFza3MvdGFzay1saXN0LnRzIl0sIm5hbWVzIjpbIlRhc2tMaXN0Q29udHJvbGxlciIsIlRhc2tMaXN0Q29udHJvbGxlci5jb25zdHJ1Y3RvciIsIlRhc2tMaXN0Q29udHJvbGxlci5yZWZyZXNoIiwiVGFza0xpc3RDb250cm9sbGVyLnBhZ2luYXRlIiwiVGFza0xpc3RDb250cm9sbGVyLmxvYWREYXRhIiwiVGFza0xpc3RDb250cm9sbGVyLnZpZXdEZXRhaWxzIiwiVGFza0xpc3RDb250cm9sbGVyLnRvZ2dsZVNlbGVjdGlvbiIsIlRhc2tMaXN0Q29udHJvbGxlci5hcHBseUZpbHRlciIsIlRhc2tMaXN0Q29udHJvbGxlci5yZXNldEZpbHRlcnMiLCJUYXNrTGlzdENvbnRyb2xsZXIuY2xlYXJGaWx0ZXIiXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDtBQUtqRDtJQW1CSUEsNEJBQ1lBLE1BQWlCQSxFQUNqQkEsU0FBOEJBLEVBQzlCQSxTQUE4QkEsRUFDOUJBLFVBQTBCQTtRQXZCMUNDLGlCQTRHQ0E7UUF4RmVBLFdBQU1BLEdBQU5BLE1BQU1BLENBQVdBO1FBQ2pCQSxjQUFTQSxHQUFUQSxTQUFTQSxDQUFxQkE7UUFDOUJBLGNBQVNBLEdBQVRBLFNBQVNBLENBQXFCQTtRQUM5QkEsZUFBVUEsR0FBVkEsVUFBVUEsQ0FBZ0JBO1FBcEI5QkEsV0FBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDWEEsYUFBUUEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDZEEsZUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFZkEsZUFBVUEsR0FBR0EsQ0FBQ0EsWUFBWUEsRUFBRUEsV0FBV0EsRUFBRUEsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDbkRBLGVBQVVBLEdBQUdBLENBQUNBLENBQUNBO1FBR2ZBLG1CQUFjQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNwQkEsaUJBQVlBLEdBQUdBLEVBQUVBLENBQUNBO1FBWXRCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJ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QSxnQkFBZ0JBO0tBQ25CQSxDQUFDQTtJQTBGTkEseUJBQUNBO0FBQURBLENBNUdBLEFBNEdDQSxJQUFBO0FBNUdZLDBCQUFrQixxQkE0RzlCLENBQUEiLCJmaWxlIjoibW9kdWxlcy90YXNrcy90YXNrLWxpc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi90eXBpbmdzL3RzZC5kLnRzXCIgLz5cblxuaW1wb3J0IHtVdGlsU2VydmljZX0gZnJvbSAnLi4vcmVzdC91dGlsJztcbmltcG9ydCB7UmVxdWVzdFNlcnZpY2V9IGZyb20gJy4uL3Jlc3QvcmVxdWVzdCc7XG5cbmV4cG9ydCBjbGFzcyBUYXNrTGlzdENvbnRyb2xsZXIge1xuICAgIHByaXZhdGUgbGlzdDogQXJyYXk8YW55PjtcbiAgICBwcml2YXRlIHRpbWVyO1xuICAgIHByaXZhdGUgcGFnZU5vID0gMTtcbiAgICBwcml2YXRlIHBhZ2VTaXplID0gMjA7XG4gICAgcHJpdmF0ZSB0b3RhbFBhZ2VzID0gMTtcbiAgICBwcml2YXRlIHNlYXJjaFF1ZXJ5OiBzdHJpbmc7XG4gICAgcHJpdmF0ZSB0YXNrU3RhdHVzID0gWydJbnByb2dyZXNzJywgJ0NvbXBsZXRlZCcsICdGYWlsZWQnXTtcbiAgICBwcml2YXRlIHRvdGFsQ291bnQgPSAwO1xuICAgIHByaXZhdGUgZnJvbURhdGVUaW1lRmlsdGVyOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSB0b0RhdGVUaW1lRmlsdGVyOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBzZWxlY3RlZFN0YXR1cyA9IFtdO1xuICAgIHByaXZhdGUgZmlsdGVyT2JqZWN0ID0ge307XG4gICAgc3RhdGljICRpbmplY3Q6IEFycmF5PHN0cmluZz4gPSBbXG4gICAgICAgICckc2NvcGUnLFxuICAgICAgICAnJGludGVydmFsJyxcbiAgICAgICAgJyRsb2NhdGlvbicsXG4gICAgICAgICdSZXF1ZXN0U2VydmljZSdcbiAgICBdO1xuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlICRzY29wZTogbmcuSVNjb3BlLFxuICAgICAgICBwcml2YXRlICRpbnRlcnZhbDogbmcuSUludGVydmFsU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSAkbG9jYXRpb246IG5nLklMb2NhdGlvblNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgcmVxdWVzdFN2YzogUmVxdWVzdFNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy50aW1lciA9IHRoaXMuJGludGVydmFsKCgpID0+IHRoaXMucmVmcmVzaCgpLCA1MDAwKTtcbiAgICAgICAgdGhpcy4kc2NvcGUuJG9uKCckZGVzdHJveScsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJGludGVydmFsLmNhbmNlbCh0aGlzLnRpbWVyKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZWZyZXNoKCkge1xuICAgICAgICB0aGlzLnJlcXVlc3RTdmMuZ2V0TGlzdCh0aGlzLnBhZ2VObywgdGhpcy5wYWdlU2l6ZSwgdGhpcy5zZWxlY3RlZFN0YXR1cywgdGhpcy5mcm9tRGF0ZVRpbWVGaWx0ZXIsIHRoaXMudG9EYXRlVGltZUZpbHRlciwgdGhpcy5zZWFyY2hRdWVyeSkudGhlbigoZGF0YTogYW55KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRvdGFsQ291bnQgPSBkYXRhLnRvdGFsY291bnQ7XG4gICAgICAgICAgICB0aGlzLnRvdGFsUGFnZXMgPSBNYXRoLmNlaWwoZGF0YS50b3RhbGNvdW50IC8gdGhpcy5wYWdlU2l6ZSk7XG4gICAgICAgICAgICB0aGlzLmxvYWREYXRhKGRhdGEudGFza3MpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcGFnaW5hdGUocGFnZU5vKSB7XG4gICAgICAgIGlmIChwYWdlTm8gPCAxIHx8IHBhZ2VObyA+IHRoaXMudG90YWxQYWdlcylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5wYWdlTm8gPSBwYWdlTm87XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBsb2FkRGF0YSh0YXNrczogQXJyYXk8YW55Pikge1xuICAgICAgICB2YXIgbGlzdCA9IFtdO1xuICAgICAgICBfLmVhY2godGFza3MsICh0YXNrKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGZpcnN0U3RhdHVzID0gXy5maXJzdDxhbnk+KHRhc2suc3RhdHVzbGlzdCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2sudGltZXN0YW1wID0gZmlyc3RTdGF0dXMuVGltZXN0YW1wO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsaXN0LnB1c2godGFzaylcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGlzdCA9IGxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIHZpZXdEZXRhaWxzKHRhc2tJZCkge1xuICAgICAgICB0aGlzLiRsb2NhdGlvbi5wYXRoKCcvdGFza3MvJyArIHRhc2tJZCk7XG4gICAgfVxuXG4gICAgcHVibGljIHRvZ2dsZVNlbGVjdGlvbihzdGF0dXMpIHtcbiAgICAgICAgdmFyIGlkeCA9IHRoaXMuc2VsZWN0ZWRTdGF0dXMuaW5kZXhPZihzdGF0dXMpO1xuICAgICAgICBpZiAoaWR4ID4gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRTdGF0dXMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkU3RhdHVzLnB1c2goc3RhdHVzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpbHRlck9iamVjdFtcInN0YXR1c1wiXSA9IHRoaXMuc2VsZWN0ZWRTdGF0dXM7XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhcHBseUZpbHRlcihrZXksIHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmZpbHRlck9iamVjdFtrZXldXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZpbHRlck9iamVjdFtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlc2V0RmlsdGVycygpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuZmlsdGVyT2JqZWN0W1wiZnJvbVwiXTtcbiAgICAgICAgZGVsZXRlIHRoaXMuZmlsdGVyT2JqZWN0W1widG9cIl07XG4gICAgICAgIGRlbGV0ZSB0aGlzLmZpbHRlck9iamVjdFtcInNlYXJjaFwiXTtcbiAgICAgICAgdGhpcy5maWx0ZXJPYmplY3RbXCJzdGF0dXNcIl0gPSBbXTtcbiAgICAgICAgdGhpcy5mcm9tRGF0ZVRpbWVGaWx0ZXIgPSB0aGlzLmZpbHRlck9iamVjdFtcImZyb21cIl07XG4gICAgICAgIHRoaXMudG9EYXRlVGltZUZpbHRlciA9IHRoaXMuZmlsdGVyT2JqZWN0W1widG9cIl07XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRTdGF0dXMgPSB0aGlzLmZpbHRlck9iamVjdFtcInN0YXR1c1wiXTtcbiAgICAgICAgdGhpcy5zZWFyY2hRdWVyeSA9IHRoaXMuZmlsdGVyT2JqZWN0W1wic2VhcmNoXCJdO1xuICAgIH1cblxuICAgIHB1YmxpYyBjbGVhckZpbHRlcihrZXkpIHtcbiAgICAgICAgaWYgKGtleSA9PT0gXCJzdGF0dXNcIikge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJPYmplY3Rba2V5XSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuZmlsdGVyT2JqZWN0W2tleV07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mcm9tRGF0ZVRpbWVGaWx0ZXIgPSB0aGlzLmZpbHRlck9iamVjdFtcImZyb21cIl07XG4gICAgICAgIHRoaXMudG9EYXRlVGltZUZpbHRlciA9IHRoaXMuZmlsdGVyT2JqZWN0W1widG9cIl07XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRTdGF0dXMgPSB0aGlzLmZpbHRlck9iamVjdFtcInN0YXR1c1wiXTtcbiAgICAgICAgdGhpcy5zZWFyY2hRdWVyeSA9IHRoaXMuZmlsdGVyT2JqZWN0W1wic2VhcmNoXCJdO1xuICAgIH1cblxufVxuIl19
