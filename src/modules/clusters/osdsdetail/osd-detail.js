// <reference path="../typings/tsd.d.ts" />
var ModalHelpers = require('../../modal/modal-helpers');
var OsdDetailController = (function () {
    function OsdDetailController(qService, $modal, locationService, scopeService, timeoutService, logService, intervalSvc, serverService, clusterService, requestSvc, requestTrackingSvc) {
        var _this = this;
        this.qService = qService;
        this.$modal = $modal;
        this.locationService = locationService;
        this.scopeService = scopeService;
        this.timeoutService = timeoutService;
        this.logService = logService;
        this.intervalSvc = intervalSvc;
        this.serverService = serverService;
        this.clusterService = clusterService;
        this.requestSvc = requestSvc;
        this.requestTrackingSvc = requestTrackingSvc;
        /* Applying filter on OSD list from the ng-repeat in UI. here we have 3 set of filters based on
        1)osd status 2)utilization 3) pg_status . and at a time only one set of filter can be applied .
        so that why here i have if condition to check the set of filter . */
        this.applyFilter = function (osd) {
            if (_this.activeFilter === 'osd_status') {
                return _this.filterList.OSDStatus[osd.status].checked || _this.isNoFilterSelected(_this.filterList.OSDStatus);
            }
            else if (_this.activeFilter === 'utilization') {
                return _this.filterList.Utilization[osd.usage.status].checked || _this.isNoFilterSelected(_this.filterList.Utilization);
            }
            else if (_this.activeFilter === 'pg_status') {
                if (_this.isNoFilterSelected(_this.filterList.PGStatus)) {
                    return true;
                }
                var result = false;
                _.each(_this.filterList.PGStatus, function (element) {
                    if (element.checked) {
                        if (osd.options1.pgsummary.pgarray.indexOf(element.name) === -1) {
                            return false;
                        }
                        else {
                            result = true;
                        }
                    }
                });
                return result;
            }
        };
        this.filteredOSD = {};
        this.isLeftSidebarShow = true;
        this.selection = { activeOsd: {}, allSelectedOsds: {} };
        this.activeFilter = 'osd_status';
        this.filterList = {};
        /* Note: This filterList is tightly coupled with status(osd,utilization,pg) order. if order
        of element will get change , it will break the filter features */
        this.filterList.OSDStatus = [
            { name: "Up-In", icon: "pficon pficon-ok", enabled: false, checked: false },
            { name: "Up-Out", icon: "pficon pficon-warning-triangle-o", enabled: false, checked: false },
            { name: "Down-In", icon: "pficon pficon-warning-triangle-o", enabled: false, checked: false },
            { name: "Down", icon: "fa fa-arrow-circle-o-down down-color", enabled: false, checked: false }
        ];
        this.filterList.PGStatus = [
            { name: "active", checked: false },
            { name: "clean", checked: false },
            { name: "creating", checked: false },
            { name: "replay", checked: false },
            { name: "splitting", checked: false },
            { name: "scrubbing", checked: false },
            { name: "degraded", checked: false },
            { name: "undersized", checked: false },
            { name: "repair", checked: false },
            { name: "recovery", checked: false },
            { name: "backfill", checked: false },
            { name: "remapped", checked: false },
            { name: "down", checked: false },
            { name: "inconsistent", checked: false },
            { name: "peering", checked: false },
            { name: "incomplete", checked: false },
            { name: "stale", checked: false },
        ];
        this.filterList.Utilization = [
            { name: "Full (95% or more)", icon: "progress-bar-full", enabled: false, checked: false },
            { name: "Near Full (85% or more)", icon: "progress-bar-near-full", enabled: false, checked: false },
            { name: "50% - 85%", icon: "progress-bar-average", enabled: false, checked: false },
            { name: "Less than 50%", icon: "progress-bar-normal", enabled: false, checked: false }
        ];
        this.storageProfileArray = [
            { 'name': 'All', 'value': '' },
            { 'name': 'Default', 'value': 'default' },
            { 'name': 'SAS', 'value': 'sas' },
            { 'name': 'SSD', 'value': 'ssd' }
        ];
        this.selectByStorageProfile = { storageprofile: '' };
        this.totalSelectedOSDs = [];
        this.timer = this.intervalSvc(function () { return _this.getOSDs(); }, 120 * 1000);
        this.scopeService.$on('$destroy', function () {
            _this.intervalSvc.cancel(_this.timer);
        });
        this.groupBy = 'node';
        this.getOSDs();
        this.paramsObject = locationService.search();
        if (Object.keys(this.paramsObject).length > 0) {
            if (this.paramsObject.active_filter !== undefined && this.paramsObject.filter_name !== undefined) {
                this.activeFilter = this.paramsObject.active_filter;
                if (this.paramsObject.active_filter === 'osd_status') {
                    this.paramsObject.filter_name.forEach(function (name) {
                        _.find(_this.filterList.OSDStatus, function (filter) {
                            return filter.name === name;
                        }).checked = true;
                    });
                }
                else if (this.paramsObject.active_filter === 'utilization') {
                    _.find(this.filterList.Utilization, function (filter) {
                        return filter.name.split(' ')[0] === _this.paramsObject.filter_name;
                    }).checked = true;
                }
            }
        }
        /* Here , watching the filteredOSD(filtered osd list) variable for any changes .
        so that we can select first value as a selected OSD in UI . and if there is no
        any element inside array, than no osd will be selected in UI. */
        this.scopeService.$watch(function () { return _this.filteredOSD; }, function (newValue, oldValue) {
            _this.maintainTotalSelectedOsds();
            _this.selection.activeOsd = null;
            _.forOwn(_this.filteredOSD, function (value, key) {
                if (value.length > 0) {
                    _this.selection.activeOsd = value[0];
                    return false;
                }
            });
        }, true);
    }
    /* Getting OSD list here */
    OsdDetailController.prototype.getOSDs = function () {
        var _this = this;
        if (this.type === 'Cluster') {
            this.clusterService.getSlus(this.id).then(function (slus) {
                _this.settingUpOsds(slus);
                _this.performGroupBy();
            });
        }
        else {
            this.serverService.getNodeSlus(this.id).then(function (slus) {
                /* Adding all possible storage profiles in drop down */
                var newStorageProfiles = _.pluck(slus, 'storageprofile');
                newStorageProfiles.forEach(function (profile) {
                    _this.storageProfileArray.push({ 'name': profile, 'value': profile });
                });
                _this.storageProfileArray = _.uniq(_this.storageProfileArray, 'value');
                _this.settingUpOsds(slus);
            });
        }
    };
    OsdDetailController.prototype.settingUpOsds = function (slus) {
        var _this = this;
        this.osdList = slus;
        (this.osdList || []).map(function (osd) {
            var pgArray = [];
            /* Adding the usage status for each osd , so that easily can find color code as well
            as filter for percentused in UI */
            osd.usage.status = (osd.usage.percentused >= 95 ? 0 : (osd.usage.percentused >= 85 ? 1 : (osd.usage.percentused >= 50 ? 2 : 3)));
            /* By default , we have disabled all filter . and Just here we are enabling the filters
            which are present in OSD list */
            if (!_this.filterList.OSDStatus[osd.status].enabled) {
                _this.filterList.OSDStatus[osd.status].enabled = true;
            }
            if (!_this.filterList.Utilization[osd.usage.status].enabled) {
                _this.filterList.Utilization[osd.usage.status].enabled = true;
            }
            /* we have pg summary in object format with '+' sign . example - "pgsummary":{"active+undersized+degraded":128} .
            Here , we want to each key after spliting with '+' sign , should be array elements
            so that easily can apply filter  */
            Object.keys(osd.options1.pgsummary).forEach(function (element) {
                pgArray = pgArray.concat(element.split("+"));
            });
            osd.options1.pgsummary.pgarray = pgArray;
            osd.node = osd.options1.node;
        });
    };
    /* Performing Group by */
    OsdDetailController.prototype.performGroupBy = function () {
        if (this.groupBy === 'node') {
            this.osdListGroupBy = _.groupBy(this.osdList, function (osd) { return osd.options1.node; });
        }
        else {
            this.osdListGroupBy = _.groupBy(this.osdList, function (osd) { return osd.storageprofile; });
        }
    };
    /* Calling on osd action changed and performing actions on selected osds */
    OsdDetailController.prototype.osdActionChange = function (osdAction) {
        var _this = this;
        var actionObject = (osdAction === 'mark_up' ? { up: true } : (osdAction === 'mark_in' ? { in: true } : { in: false }));
        if (osdAction === 'mark_out') {
            var modal = ModalHelpers.OsdActionConfirmation(this.$modal, {}, 'Are you sure you want to move the selected OSDs out of the cluster?');
            modal.$scope.$hide = _.wrap(modal.$scope.$hide, function ($hide, confirmed) {
                if (confirmed) {
                    _this.performOsdAction(actionObject);
                }
                $hide();
            });
        }
        else {
            this.performOsdAction(actionObject);
        }
    };
    /* Performing the Actions on selected osds */
    OsdDetailController.prototype.performOsdAction = function (actionObject) {
        var _this = this;
        if (this.totalSelectedOSDs.length === 0) {
            this.clusterService.slusAction(this.id, this.selection.activeOsd.sluid, actionObject).then(function (result) {
                _this.requestSvc.get(result.data.taskid).then(function (task) {
                    _this.requestTrackingSvc.add(task.id, task.name);
                });
            });
        }
        else {
            _.each(this.totalSelectedOSDs, function (osd) {
                _this.clusterService.slusAction(_this.id, osd.sluid, actionObject).then(function (result) {
                    _this.requestSvc.get(result.data.taskid).then(function (task) {
                        _this.requestTrackingSvc.add(task.id, task.name);
                    });
                });
            });
        }
        this.selection.allSelectedOsds = {};
        this.totalSelectedOSDs = [];
        this.timeoutService(function () { return _this.getOSDs(); }, 10000);
    };
    /* Maintaining the total selected osds by checkbox for Action */
    OsdDetailController.prototype.maintainTotalSelectedOsds = function () {
        var _this = this;
        this.totalSelectedOSDs = [];
        _.forOwn(this.filteredOSD, function (value, key) {
            _.each(value, function (osd) {
                if (_this.selection.allSelectedOsds[osd.sluid] === true) {
                    _this.totalSelectedOSDs.push(osd);
                }
            });
        });
    };
    /* It will return true/false based on given filter group.
    If there is no filter applied for this , than it will return true
    otherwise it will return false.*/
    OsdDetailController.prototype.isNoFilterSelected = function (filterObj) {
        for (var key in filterObj) {
            if (filterObj[key].checked) {
                return false;
            }
        }
        return true;
    };
    //Services that are used in this class.
    OsdDetailController.$inject = [
        '$q',
        '$modal',
        '$location',
        '$scope',
        '$timeout',
        '$log',
        '$interval',
        'ServerService',
        'ClusterService',
        'RequestService',
        'RequestTrackingService'
    ];
    return OsdDetailController;
})();
exports.OsdDetailController = OsdDetailController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvY2x1c3RlcnMvb3Nkc2RldGFpbC9vc2QtZGV0YWlsLnRzIl0sIm5hbWVzIjpbIk9zZERldGFpbENvbnRyb2xsZXIiLCJPc2REZXRhaWxDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiT3NkRGV0YWlsQ29udHJvbGxlci5nZXRPU0RzIiwiT3NkRGV0YWlsQ29udHJvbGxlci5zZXR0aW5nVXBPc2RzIiwiT3NkRGV0YWlsQ29udHJvbGxlci5wZXJmb3JtR3JvdXBCeSIsIk9zZERldGFpbENvbnRyb2xsZXIub3NkQWN0aW9uQ2hhbmdlIiwiT3NkRGV0YWlsQ29udHJvbGxlci5wZXJmb3JtT3NkQWN0aW9uIiwiT3NkRGV0YWlsQ29udHJvbGxlci5tYWludGFpblRvdGFsU2VsZWN0ZWRPc2RzIiwiT3NkRGV0YWlsQ29udHJvbGxlci5pc05vRmlsdGVyU2VsZWN0ZWQiXSwibWFwcGluZ3MiOiJBQUFBLDJDQUEyQztBQU0zQyxJQUFZLFlBQVksV0FBTSwyQkFBMkIsQ0FBQyxDQUFBO0FBRzFEO0lBZ0NJQSw2QkFBb0JBLFFBQXNCQSxFQUM5QkEsTUFBV0EsRUFDWEEsZUFBb0NBLEVBQ3BDQSxZQUF1QkEsRUFDdkJBLGNBQWtDQSxFQUNsQ0EsVUFBMEJBLEVBQzFCQSxXQUFnQ0EsRUFDaENBLGFBQTRCQSxFQUM1QkEsY0FBOEJBLEVBQzlCQSxVQUEwQkEsRUFDMUJBLGtCQUEwQ0E7UUExQzFEQyxpQkE2UUNBO1FBN091QkEsYUFBUUEsR0FBUkEsUUFBUUEsQ0FBY0E7UUFDOUJBLFdBQU1BLEdBQU5BLE1BQU1BLENBQUtBO1FBQ1hBLG9CQUFlQSxHQUFmQSxlQUFlQSxDQUFxQkE7UUFDcENBLGlCQUFZQSxHQUFaQSxZQUFZQSxDQUFXQTtRQUN2QkEsbUJBQWNBLEdBQWRBLGNBQWNBLENBQW9CQTtRQUNsQ0EsZUFBVUEsR0FBVkEsVUFBVUEsQ0FBZ0JBO1FBQzFCQSxnQkFBV0EsR0FBWEEsV0FBV0EsQ0FBcUJBO1FBQ2hDQSxrQkFBYUEsR0FBYkEsYUFBYUEs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WUFDakdBLEVBQUNBLElBQUlBLEVBQUVBLFdBQVdBLEVBQUVBLElBQUlBLEVBQUVBLHNCQUFzQkEsRUFBRUEsT0FBT0EsRUFBRUEsS0FBS0EsRUFBRUEsT0FBT0EsRUFBRUEsS0FBS0EsRUFBQ0E7WUFDakZBLEVBQUNBLElBQUlBLEVBQUVBLGVBQWVBLEVBQUVBLElBQUlBLEVBQUVBLHFCQUFxQkEsRUFBRUEsT0FBT0EsRUFBRUEsS0FBS0EsRUFBRUEsT0FBT0EsRUFBRUEsS0FBS0EsRUFBQ0E7U0FDdkZBLENBQUNBO1FBQ0ZBLElBQUlBLENBQUNBLG1CQUFtQkEsR0FBR0E7WUFDdkJBLEVBQUNBLE1BQU1BLEVBQUVBLEtBQUtBLEVBQUVBLE9BQU9BLEVBQUVBLEVBQUVBLEVBQUNBO1lBQzVCQSxFQUFDQSxNQUFNQSxFQUFFQSxTQUFTQSxFQUFFQSxPQUFPQSxFQUFFQSxTQUFTQSxFQUFDQTtZQUN2Q0EsRUFBQ0EsTUFBTUEsRUFBRUEsS0FBS0EsRUFBRUEsT0FBT0EsRUFBRUEsS0FBS0EsRUFBQ0E7WUFDL0JBLEVBQUNBLE1BQU1BLEVBQUVBLEtBQUtBLEVBQUVBLE9BQU9BLEVBQUVBLEtBQUtBLEVBQUNBO1NBQ2xDQSxDQUFDQTtRQUNGQSxJQUFJQSxDQUFDQSxzQkFBc0JBLEdBQUdBLEVBQUVBLGNBQWNBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBO1FBQ3JEQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxjQUFNQSxPQUFBQSxLQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxFQUFkQSxDQUFjQSxFQUFFQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFFQSxDQUFDQTtRQUNqRUEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsRUFBRUE7WUFDOUJBLEtBQUlBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBLEtBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1FBQ3hDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNIQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUN0QkEsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7UUFDZkEsSUFBSUEsQ0FBQ0EsWUFBWUEsR0FBR0EsZUFBZUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDN0NBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzVDQSxFQUFFQSxDQUFBQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxhQUFhQSxLQUFLQSxTQUFTQSxJQUFJQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxXQUFXQSxLQUFLQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDOUZBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLGFBQWFBLENBQUNBO2dCQUNwREEsRUFBRUEsQ0FBQUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsYUFBYUEsS0FBS0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2xEQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxXQUFXQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFDQSxJQUFTQTt3QkFDNUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUlBLENBQUNBLFVBQVVBLENBQUNBLFNBQVNBLEVBQUVBLFVBQUNBLE1BQVdBOzRCQUN0Q0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsS0FBS0EsSUFBSUEsQ0FBQ0E7d0JBQ3BDQSxDQUFDQSxDQUFDQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQTtvQkFDdEJBLENBQUNBLENBQUNBLENBQUNBO2dCQUNQQSxDQUFDQTtnQkFBQUEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsYUFBYUEsS0FBS0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3pEQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxXQUFXQSxFQUFFQSxVQUFDQSxNQUFXQTt3QkFDeENBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLEtBQUlBLENBQUNBLFlBQVlBLENBQUNBLFdBQVdBLENBQUNBO29CQUMzRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0E7Z0JBQ3RCQSxDQUFDQTtZQUNMQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUNEQTs7d0VBRWdFQTtRQUNoRUEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsY0FBUUEsTUFBTUEsQ0FBQ0EsS0FBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsVUFBQ0EsUUFBUUEsRUFBRUEsUUFBUUE7WUFDNUVBLEtBQUlBLENBQUNBLHlCQUF5QkEsRUFBRUEsQ0FBQ0E7WUFDakNBLEtBQUlBLENBQUNBLFNBQVNBLENBQUNBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBO1lBQ2hDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFJQSxDQUFDQSxXQUFXQSxFQUFFQSxVQUFDQSxLQUFLQSxFQUFFQSxHQUFHQTtnQkFDbENBLEVBQUVBLENBQUNBLENBQUVBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUVBLENBQUNBLENBQUNBLENBQUNBO29CQUNyQkEsS0FBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsU0FBU0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3BDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtnQkFDakJBLENBQUNBO1lBQ0xBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLENBQUNBLEVBQUNBLElBQUlBLENBQUNBLENBQUNBO0lBQ1pBLENBQUNBO0lBRURELDJCQUEyQkE7SUFDcEJBLHFDQUFPQSxHQUFkQTtRQUFBRSxpQkFpQkNBO1FBaEJHQSxFQUFFQSxDQUFBQSxDQUFFQSxJQUFJQSxDQUFDQSxJQUFJQSxLQUFLQSxTQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMzQkEsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBQ0EsSUFBZ0JBO2dCQUN2REEsS0FBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ3pCQSxLQUFJQSxDQUFDQSxjQUFjQSxFQUFFQSxDQUFDQTtZQUMxQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUEEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDSkEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBQ0EsSUFBZ0JBO2dCQUMxREEsdURBQXVEQTtnQkFDdkRBLElBQUlBLGtCQUFrQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsRUFBRUEsZ0JBQWdCQSxDQUFDQSxDQUFDQTtnQkFDekRBLGtCQUFrQkEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBQ0EsT0FBT0E7b0JBQy9CQSxLQUFJQSxDQUFDQSxtQkFBbUJBLENBQUNBLElBQUlBLENBQUNBLEVBQUNBLE1BQU1BLEVBQUVBLE9BQU9BLEVBQUVBLE9BQU9BLEVBQUVBLE9BQU9BLEVBQUNBLENBQUNBLENBQUNBO2dCQUN2RUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ0hBLEtBQUlBLENBQUNBLG1CQUFtQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBSUEsQ0FBQ0EsbUJBQW1CQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFBQTtnQkFDcEVBLEtBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQzdCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNQQSxDQUFDQTtJQUNMQSxDQUFDQTtJQUVNRiwyQ0FBYUEsR0FBcEJBLFVBQXFCQSxJQUFnQkE7UUFBckNHLGlCQXdCQ0E7UUF2QkdBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBO1FBQ3BCQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFFQSxVQUFDQSxHQUFHQTtZQUMxQkEsSUFBSUEsT0FBT0EsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDakJBOzhDQUNrQ0E7WUFDbENBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLFdBQVdBLElBQUVBLEVBQUVBLEdBQUVBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLFdBQVdBLElBQUVBLEVBQUVBLEdBQUVBLENBQUNBLEdBQUVBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLFdBQVdBLElBQUVBLEVBQUVBLEdBQUVBLENBQUNBLEdBQUdBLENBQUNBLENBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQ3ZIQTs0Q0FDZ0NBO1lBQ2hDQSxFQUFFQSxDQUFBQSxDQUFDQSxDQUFDQSxLQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxTQUFTQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDaERBLEtBQUlBLENBQUNBLFVBQVVBLENBQUNBLFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBO1lBQ3pEQSxDQUFDQTtZQUNEQSxFQUFFQSxDQUFBQSxDQUFDQSxDQUFDQSxLQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxXQUFXQSxDQUFDQSxHQUFHQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDeERBLEtBQUlBLENBQUNBLFVBQVVBLENBQUNBLFdBQVdBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBO1lBQ2pFQSxDQUFDQTtZQUNEQTs7K0NBRW1DQTtZQUNuQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBQ0EsT0FBT0E7Z0JBQ2hEQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqREEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDSEEsR0FBR0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsT0FBT0EsR0FBR0EsT0FBT0EsQ0FBQ0E7WUFDekNBLEdBQUdBLENBQUNBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBO1FBQ2pDQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUNQQSxDQUFDQTtJQUVESCx5QkFBeUJBO0lBQ2xCQSw0Q0FBY0EsR0FBckJBO1FBQ0lJLEVBQUVBLENBQUFBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEtBQUtBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ3pCQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxDQUFDQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxVQUFTQSxHQUFHQSxJQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQSxDQUFDLENBQUMsQ0FBQ0EsQ0FBQ0E7UUFDN0ZBLENBQUNBO1FBQUFBLElBQUlBLENBQUNBLENBQUNBO1lBQ0hBLElBQUlBLENBQUNBLGNBQWNBLEdBQUdBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLFVBQVNBLEdBQUdBLElBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUEsQ0FBQyxDQUFDLENBQUNBLENBQUNBO1FBQzlGQSxDQUFDQTtJQUNMQSxDQUFDQTtJQUVESiwyRUFBMkVBO0lBQ3BFQSw2Q0FBZUEsR0FBdEJBLFVBQXVCQSxTQUFTQTtRQUFoQ0ssaUJBYUNBO1FBWkdBLElBQUlBLFlBQVlBLEdBQUdBLENBQUNBLFNBQVNBLEtBQUdBLFNBQVNBLEdBQUNBLEVBQUNBLEVBQUVBLEVBQUNBLElBQUlBLEVBQUNBLEdBQUNBLENBQUNBLFNBQVNBLEtBQUdBLFNBQVNBLEdBQUNBLEVBQUNBLEVBQUVBLEVBQUNBLElBQUlBLEVBQUNBLEdBQUNBLEVBQUNBLEVBQUVBLEVBQUNBLEtBQUtBLEVBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2xHQSxFQUFFQSxDQUFBQSxDQUFDQSxTQUFTQSxLQUFLQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMxQkEsSUFBSUEsS0FBS0EsR0FBR0EsWUFBWUEsQ0FBQ0EscUJBQXFCQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxFQUFFQSxFQUFFQSxxRUFBcUVBLENBQUNBLENBQUNBO1lBQ3ZJQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxFQUFFQSxVQUFDQSxLQUFLQSxFQUFFQSxTQUFrQkE7Z0JBQ3RFQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDVEEsS0FBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtnQkFDM0NBLENBQUNBO2dCQUNEQSxLQUFLQSxFQUFFQSxDQUFDQTtZQUNaQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNQQSxDQUFDQTtRQUFBQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNIQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFlBQVlBLENBQUNBLENBQUNBO1FBQ3hDQSxDQUFDQTtJQUNMQSxDQUFDQTtJQUVETCw2Q0FBNkNBO0lBQ3RDQSw4Q0FBZ0JBLEdBQXZCQSxVQUF3QkEsWUFBWUE7UUFBcENNLGlCQW1CQ0E7UUFsQkdBLEVBQUVBLENBQUFBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsTUFBTUEsS0FBS0EsQ0FBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdENBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLFVBQVVBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLEVBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLFNBQVNBLENBQUNBLEtBQUtBLEVBQUNBLFlBQVlBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQUNBLE1BQU1BO2dCQUM1RkEsS0FBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBQ0EsSUFBSUE7b0JBQzlDQSxLQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLEVBQUVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO2dCQUNwREEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDUEEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUEEsQ0FBQ0E7UUFBQUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDSEEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxVQUFDQSxHQUFRQTtnQkFDcENBLEtBQUlBLENBQUNBLGNBQWNBLENBQUNBLFVBQVVBLENBQUNBLEtBQUlBLENBQUNBLEVBQUVBLEVBQUNBLEdBQUdBLENBQUNBLEtBQUtBLEVBQUNBLFlBQVlBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQUNBLE1BQU1BO29CQUN2RUEsS0FBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBQ0EsSUFBSUE7d0JBQzlDQSxLQUFJQSxDQUFDQSxrQkFBa0JBLENBQUNBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLEVBQUVBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO29CQUNwREEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1BBLENBQUNBLENBQUNBLENBQUNBO1lBQ1BBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLGVBQWVBLEdBQUVBLEVBQUVBLENBQUNBO1FBQ25DQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzVCQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxjQUFNQSxPQUFBQSxLQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxFQUFkQSxDQUFjQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtJQUNyREEsQ0FBQ0E7SUFFRE4sZ0VBQWdFQTtJQUN6REEsdURBQXlCQSxHQUFoQ0E7UUFBQU8saUJBU0NBO1FBUkdBLElBQUlBLENBQUNBLGlCQUFpQkEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDNUJBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLFVBQUNBLEtBQUtBLEVBQUVBLEdBQUdBO1lBQ2xDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxVQUFDQSxHQUFRQTtnQkFDbkJBLEVBQUVBLENBQUNBLENBQUNBLEtBQUlBLENBQUNBLFNBQVNBLENBQUNBLGVBQWVBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLElBQUtBLENBQUNBLENBQUNBLENBQUNBO29CQUN0REEsS0FBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDckNBLENBQUNBO1lBQ0xBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLENBQUNBLENBQUNBLENBQUNBO0lBQ1BBLENBQUNBO0lBMEJEUDs7cUNBRWlDQTtJQUMxQkEsZ0RBQWtCQSxHQUF6QkEsVUFBMEJBLFNBQVNBO1FBQy9CUSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3pCQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtZQUNqQkEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7SUFDaEJBLENBQUNBO0lBMVBEUix1Q0FBdUNBO0lBQ2hDQSwyQkFBT0EsR0FBa0JBO1FBQzVCQSxJQUFJQTtRQUNKQSxRQUFRQTtRQUNSQSxXQUFXQTtRQUNYQSxRQUFRQTtRQUNSQSxVQUFVQTtRQUNWQSxNQUFNQTtRQUNOQSxXQUFXQTtRQUNYQSxlQUFlQTtRQUNmQSxnQkFBZ0JBO1FBQ2hCQSxnQkFBZ0JBO1FBQ2hCQSx3QkFBd0JBO0tBQzNCQSxDQUFDQTtJQStPTkEsMEJBQUNBO0FBQURBLENBN1FBLEFBNlFDQSxJQUFBO0FBN1FZLDJCQUFtQixzQkE2US9CLENBQUEiLCJmaWxlIjoibW9kdWxlcy9jbHVzdGVycy9vc2RzZGV0YWlsL29zZC1kZXRhaWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90eXBpbmdzL3RzZC5kLnRzXCIgLz5cblxuaW1wb3J0IHtTZXJ2ZXJTZXJ2aWNlfSBmcm9tICcuLi8uLi9yZXN0L3NlcnZlcic7XG5pbXBvcnQge0NsdXN0ZXJTZXJ2aWNlfSBmcm9tICcuLi8uLi9yZXN0L2NsdXN0ZXJzJztcbmltcG9ydCB7UmVxdWVzdFNlcnZpY2V9IGZyb20gJy4uLy4uL3Jlc3QvcmVxdWVzdCc7XG5pbXBvcnQge1JlcXVlc3RUcmFja2luZ1NlcnZpY2V9IGZyb20gJy4uLy4uL3JlcXVlc3RzL3JlcXVlc3QtdHJhY2tpbmctc3ZjJztcbmltcG9ydCAqIGFzIE1vZGFsSGVscGVycyBmcm9tICcuLi8uLi9tb2RhbC9tb2RhbC1oZWxwZXJzJztcbmltcG9ydCB7bnVtZXJhbH0gZnJvbSAnLi4vLi4vYmFzZS9saWJzJztcblxuZXhwb3J0IGNsYXNzIE9zZERldGFpbENvbnRyb2xsZXIge1xuICAgIHByaXZhdGUgaWQ6IGFueTtcbiAgICBwcml2YXRlIHR5cGU6IGFueTtcbiAgICBwcml2YXRlIG9zZExpc3Q6IEFycmF5PGFueT47XG4gICAgcHJpdmF0ZSBvc2RMaXN0R3JvdXBCeTogYW55O1xuICAgIHByaXZhdGUgZ3JvdXBCeTogc3RyaW5nO1xuICAgIHByaXZhdGUgZmlsdGVyTGlzdDogYW55O1xuICAgIHByaXZhdGUgc2VsZWN0aW9uOiBhbnk7XG4gICAgcHJpdmF0ZSBhY3RpdmVGaWx0ZXI6IHN0cmluZztcbiAgICBwcml2YXRlIGlzTGVmdFNpZGViYXJTaG93OiBib29sZWFuO1xuICAgIHByaXZhdGUgZmlsdGVyZWRPU0Q6IGFueTtcbiAgICBwcml2YXRlIHRvdGFsU2VsZWN0ZWRPU0RzOiBBcnJheTxhbnk+O1xuICAgIHByaXZhdGUgc3RvcmFnZVByb2ZpbGVBcnJheTogQXJyYXk8YW55PjtcbiAgICBwcml2YXRlIHNlbGVjdEJ5U3RvcmFnZVByb2ZpbGU6IGFueTtcbiAgICBwcml2YXRlIHBhcmFtc09iamVjdDogYW55O1xuICAgIHByaXZhdGUgdGltZXI6IG5nLklQcm9taXNlPGFueT47XG5cbiAgICAvL1NlcnZpY2VzIHRoYXQgYXJlIHVzZWQgaW4gdGhpcyBjbGFzcy5cbiAgICBzdGF0aWMgJGluamVjdDogQXJyYXk8c3RyaW5nPiA9IFtcbiAgICAgICAgJyRxJyxcbiAgICAgICAgJyRtb2RhbCcsXG4gICAgICAgICckbG9jYXRpb24nLFxuICAgICAgICAnJHNjb3BlJyxcbiAgICAgICAgJyR0aW1lb3V0JyxcbiAgICAgICAgJyRsb2cnLFxuICAgICAgICAnJGludGVydmFsJyxcbiAgICAgICAgJ1NlcnZlclNlcnZpY2UnLFxuICAgICAgICAnQ2x1c3RlclNlcnZpY2UnLFxuICAgICAgICAnUmVxdWVzdFNlcnZpY2UnLFxuICAgICAgICAnUmVxdWVzdFRyYWNraW5nU2VydmljZSdcbiAgICBdO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBxU2VydmljZTogbmcuSVFTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlICRtb2RhbDogYW55LFxuICAgICAgICBwcml2YXRlIGxvY2F0aW9uU2VydmljZTogbmcuSUxvY2F0aW9uU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBzY29wZVNlcnZpY2U6IG5nLklTY29wZSxcbiAgICAgICAgcHJpdmF0ZSB0aW1lb3V0U2VydmljZTogbmcuSVRpbWVvdXRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGxvZ1NlcnZpY2U6IG5nLklMb2dTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGludGVydmFsU3ZjOiBuZy5JSW50ZXJ2YWxTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHNlcnZlclNlcnZpY2U6IFNlcnZlclNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgY2x1c3RlclNlcnZpY2U6IENsdXN0ZXJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJlcXVlc3RTdmM6IFJlcXVlc3RTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJlcXVlc3RUcmFja2luZ1N2YzogUmVxdWVzdFRyYWNraW5nU2VydmljZSkge1xuXG4gICAgICAgIHRoaXMuZmlsdGVyZWRPU0QgPSB7fTtcbiAgICAgICAgdGhpcy5pc0xlZnRTaWRlYmFyU2hvdyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uID0geyBhY3RpdmVPc2Q6IHt9ICxhbGxTZWxlY3RlZE9zZHM6IHt9IH07XG4gICAgICAgIHRoaXMuYWN0aXZlRmlsdGVyID0gJ29zZF9zdGF0dXMnO1xuICAgICAgICB0aGlzLmZpbHRlckxpc3QgPSB7fTtcbiAgICAgICAgLyogTm90ZTogVGhpcyBmaWx0ZXJMaXN0IGlzIHRpZ2h0bHkgY291cGxlZCB3aXRoIHN0YXR1cyhvc2QsdXRpbGl6YXRpb24scGcpIG9yZGVyLiBpZiBvcmRlclxuICAgICAgICBvZiBlbGVtZW50IHdpbGwgZ2V0IGNoYW5nZSAsIGl0IHdpbGwgYnJlYWsgdGhlIGZpbHRlciBmZWF0dXJlcyAqL1xuICAgICAgICB0aGlzLmZpbHRlckxpc3QuT1NEU3RhdHVzID0gW1xuICAgICAgICAgICAge25hbWU6IFwiVXAtSW5cIiwgaWNvbjogXCJwZmljb24gcGZpY29uLW9rXCIsIGVuYWJsZWQ6IGZhbHNlLCBjaGVja2VkOiBmYWxzZX0sXG4gICAgICAgICAgICB7bmFtZTogXCJVcC1PdXRcIiwgaWNvbjogXCJwZmljb24gcGZpY29uLXdhcm5pbmctdHJpYW5nbGUtb1wiLCBlbmFibGVkOiBmYWxzZSwgY2hlY2tlZDogZmFsc2V9LFxuICAgICAgICAgICAge25hbWU6IFwiRG93bi1JblwiLCBpY29uOiBcInBmaWNvbiBwZmljb24td2FybmluZy10cmlhbmdsZS1vXCIsIGVuYWJsZWQ6IGZhbHNlLCBjaGVja2VkOiBmYWxzZX0sXG4gICAgICAgICAgICB7bmFtZTogXCJEb3duXCIsIGljb246IFwiZmEgZmEtYXJyb3ctY2lyY2xlLW8tZG93biBkb3duLWNvbG9yXCIsIGVuYWJsZWQ6IGZhbHNlLCBjaGVja2VkOiBmYWxzZX1cbiAgICAgICAgXTtcbiAgICAgICAgdGhpcy5maWx0ZXJMaXN0LlBHU3RhdHVzID0gW1xuICAgICAgICAgICAge25hbWU6IFwiYWN0aXZlXCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcImNsZWFuXCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcImNyZWF0aW5nXCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcInJlcGxheVwiLCBjaGVja2VkOiBmYWxzZX0sXG4gICAgICAgICAgICB7bmFtZTogXCJzcGxpdHRpbmdcIiwgY2hlY2tlZDogZmFsc2V9LFxuICAgICAgICAgICAge25hbWU6IFwic2NydWJiaW5nXCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcImRlZ3JhZGVkXCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcInVuZGVyc2l6ZWRcIiwgY2hlY2tlZDogZmFsc2V9LFxuICAgICAgICAgICAge25hbWU6IFwicmVwYWlyXCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcInJlY292ZXJ5XCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcImJhY2tmaWxsXCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcInJlbWFwcGVkXCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcImRvd25cIiwgY2hlY2tlZDogZmFsc2V9LFxuICAgICAgICAgICAge25hbWU6IFwiaW5jb25zaXN0ZW50XCIsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcInBlZXJpbmdcIiwgY2hlY2tlZDogZmFsc2V9LFxuICAgICAgICAgICAge25hbWU6IFwiaW5jb21wbGV0ZVwiLCBjaGVja2VkOiBmYWxzZX0sXG4gICAgICAgICAgICB7bmFtZTogXCJzdGFsZVwiLCBjaGVja2VkOiBmYWxzZX0sXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuZmlsdGVyTGlzdC5VdGlsaXphdGlvbiA9IFtcbiAgICAgICAgICAgIHtuYW1lOiBcIkZ1bGwgKDk1JSBvciBtb3JlKVwiLCBpY29uOiBcInByb2dyZXNzLWJhci1mdWxsXCIsIGVuYWJsZWQ6IGZhbHNlLCBjaGVja2VkOiBmYWxzZX0sXG4gICAgICAgICAgICB7bmFtZTogXCJOZWFyIEZ1bGwgKDg1JSBvciBtb3JlKVwiLCBpY29uOiBcInByb2dyZXNzLWJhci1uZWFyLWZ1bGxcIiwgZW5hYmxlZDogZmFsc2UsIGNoZWNrZWQ6IGZhbHNlfSxcbiAgICAgICAgICAgIHtuYW1lOiBcIjUwJSAtIDg1JVwiLCBpY29uOiBcInByb2dyZXNzLWJhci1hdmVyYWdlXCIsIGVuYWJsZWQ6IGZhbHNlLCBjaGVja2VkOiBmYWxzZX0sXG4gICAgICAgICAgICB7bmFtZTogXCJMZXNzIHRoYW4gNTAlXCIsIGljb246IFwicHJvZ3Jlc3MtYmFyLW5vcm1hbFwiLCBlbmFibGVkOiBmYWxzZSwgY2hlY2tlZDogZmFsc2V9XG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuc3RvcmFnZVByb2ZpbGVBcnJheSA9IFtcbiAgICAgICAgICAgIHsnbmFtZSc6ICdBbGwnLCAndmFsdWUnOiAnJ30sXG4gICAgICAgICAgICB7J25hbWUnOiAnRGVmYXVsdCcsICd2YWx1ZSc6ICdkZWZhdWx0J30sXG4gICAgICAgICAgICB7J25hbWUnOiAnU0FTJywgJ3ZhbHVlJzogJ3Nhcyd9LFxuICAgICAgICAgICAgeyduYW1lJzogJ1NTRCcsICd2YWx1ZSc6ICdzc2QnfVxuICAgICAgICBdO1xuICAgICAgICB0aGlzLnNlbGVjdEJ5U3RvcmFnZVByb2ZpbGUgPSB7IHN0b3JhZ2Vwcm9maWxlOiAnJyB9O1xuICAgICAgICB0aGlzLnRvdGFsU2VsZWN0ZWRPU0RzID0gW107XG4gICAgICAgIHRoaXMudGltZXIgPSB0aGlzLmludGVydmFsU3ZjKCgpID0+IHRoaXMuZ2V0T1NEcygpLCAxMjAgKiAxMDAwICk7XG4gICAgICAgIHRoaXMuc2NvcGVTZXJ2aWNlLiRvbignJGRlc3Ryb3knLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmludGVydmFsU3ZjLmNhbmNlbCh0aGlzLnRpbWVyKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ3JvdXBCeSA9ICdub2RlJztcbiAgICAgICAgdGhpcy5nZXRPU0RzKCk7XG4gICAgICAgIHRoaXMucGFyYW1zT2JqZWN0ID0gbG9jYXRpb25TZXJ2aWNlLnNlYXJjaCgpO1xuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5wYXJhbXNPYmplY3QpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmKHRoaXMucGFyYW1zT2JqZWN0LmFjdGl2ZV9maWx0ZXIgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnBhcmFtc09iamVjdC5maWx0ZXJfbmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVGaWx0ZXIgPSB0aGlzLnBhcmFtc09iamVjdC5hY3RpdmVfZmlsdGVyO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMucGFyYW1zT2JqZWN0LmFjdGl2ZV9maWx0ZXIgPT09ICdvc2Rfc3RhdHVzJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmFtc09iamVjdC5maWx0ZXJfbmFtZS5mb3JFYWNoKChuYW1lOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZmluZCh0aGlzLmZpbHRlckxpc3QuT1NEU3RhdHVzLCAoZmlsdGVyOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlci5uYW1lID09PSBuYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1lbHNlIGlmKHRoaXMucGFyYW1zT2JqZWN0LmFjdGl2ZV9maWx0ZXIgPT09ICd1dGlsaXphdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgXy5maW5kKHRoaXMuZmlsdGVyTGlzdC5VdGlsaXphdGlvbiwgKGZpbHRlcjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlci5uYW1lLnNwbGl0KCcgJylbMF0gPT09IHRoaXMucGFyYW1zT2JqZWN0LmZpbHRlcl9uYW1lO1xuICAgICAgICAgICAgICAgICAgICB9KS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLyogSGVyZSAsIHdhdGNoaW5nIHRoZSBmaWx0ZXJlZE9TRChmaWx0ZXJlZCBvc2QgbGlzdCkgdmFyaWFibGUgZm9yIGFueSBjaGFuZ2VzIC5cbiAgICAgICAgc28gdGhhdCB3ZSBjYW4gc2VsZWN0IGZpcnN0IHZhbHVlIGFzIGEgc2VsZWN0ZWQgT1NEIGluIFVJIC4gYW5kIGlmIHRoZXJlIGlzIG5vXG4gICAgICAgIGFueSBlbGVtZW50IGluc2lkZSBhcnJheSwgdGhhbiBubyBvc2Qgd2lsbCBiZSBzZWxlY3RlZCBpbiBVSS4gKi9cbiAgICAgICAgdGhpcy5zY29wZVNlcnZpY2UuJHdhdGNoKCgpID0+IHsgcmV0dXJuIHRoaXMuZmlsdGVyZWRPU0Q7IH0sIChuZXdWYWx1ZSwgb2xkVmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMubWFpbnRhaW5Ub3RhbFNlbGVjdGVkT3NkcygpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24uYWN0aXZlT3NkID0gbnVsbDtcbiAgICAgICAgICAgIF8uZm9yT3duKHRoaXMuZmlsdGVyZWRPU0QsICh2YWx1ZSwga2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCB2YWx1ZS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGlvbi5hY3RpdmVPc2QgPSB2YWx1ZVswXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LHRydWUpO1xuICAgIH1cblxuICAgIC8qIEdldHRpbmcgT1NEIGxpc3QgaGVyZSAqL1xuICAgIHB1YmxpYyBnZXRPU0RzKCkge1xuICAgICAgICBpZiggdGhpcy50eXBlID09PSAnQ2x1c3RlcicgKSB7XG4gICAgICAgICAgICB0aGlzLmNsdXN0ZXJTZXJ2aWNlLmdldFNsdXModGhpcy5pZCkudGhlbigoc2x1czogQXJyYXk8YW55PikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ1VwT3NkcyhzbHVzKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBlcmZvcm1Hcm91cEJ5KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyU2VydmljZS5nZXROb2RlU2x1cyh0aGlzLmlkKS50aGVuKChzbHVzOiBBcnJheTxhbnk+KSA9PiB7XG4gICAgICAgICAgICAgICAgLyogQWRkaW5nIGFsbCBwb3NzaWJsZSBzdG9yYWdlIHByb2ZpbGVzIGluIGRyb3AgZG93biAqL1xuICAgICAgICAgICAgICAgIHZhciBuZXdTdG9yYWdlUHJvZmlsZXMgPSBfLnBsdWNrKHNsdXMsICdzdG9yYWdlcHJvZmlsZScpO1xuICAgICAgICAgICAgICAgIG5ld1N0b3JhZ2VQcm9maWxlcy5mb3JFYWNoKChwcm9maWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmFnZVByb2ZpbGVBcnJheS5wdXNoKHsnbmFtZSc6IHByb2ZpbGUsICd2YWx1ZSc6IHByb2ZpbGV9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JhZ2VQcm9maWxlQXJyYXkgPSBfLnVuaXEodGhpcy5zdG9yYWdlUHJvZmlsZUFycmF5LCAndmFsdWUnKVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ1VwT3NkcyhzbHVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHNldHRpbmdVcE9zZHMoc2x1czogQXJyYXk8YW55Pikge1xuICAgICAgICB0aGlzLm9zZExpc3QgPSBzbHVzO1xuICAgICAgICAodGhpcy5vc2RMaXN0IHx8IFtdKS5tYXAoIChvc2QpID0+IHtcbiAgICAgICAgICAgIHZhciBwZ0FycmF5ID0gW107XG4gICAgICAgICAgICAvKiBBZGRpbmcgdGhlIHVzYWdlIHN0YXR1cyBmb3IgZWFjaCBvc2QgLCBzbyB0aGF0IGVhc2lseSBjYW4gZmluZCBjb2xvciBjb2RlIGFzIHdlbGxcbiAgICAgICAgICAgIGFzIGZpbHRlciBmb3IgcGVyY2VudHVzZWQgaW4gVUkgKi9cbiAgICAgICAgICAgIG9zZC51c2FnZS5zdGF0dXMgPSAob3NkLnVzYWdlLnBlcmNlbnR1c2VkPj05NT8gMCA6KG9zZC51c2FnZS5wZXJjZW50dXNlZD49ODU/IDEgOihvc2QudXNhZ2UucGVyY2VudHVzZWQ+PTUwPyAyIDogMyApKSk7XG4gICAgICAgICAgICAvKiBCeSBkZWZhdWx0ICwgd2UgaGF2ZSBkaXNhYmxlZCBhbGwgZmlsdGVyIC4gYW5kIEp1c3QgaGVyZSB3ZSBhcmUgZW5hYmxpbmcgdGhlIGZpbHRlcnNcbiAgICAgICAgICAgIHdoaWNoIGFyZSBwcmVzZW50IGluIE9TRCBsaXN0ICovXG4gICAgICAgICAgICBpZighdGhpcy5maWx0ZXJMaXN0Lk9TRFN0YXR1c1tvc2Quc3RhdHVzXS5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJMaXN0Lk9TRFN0YXR1c1tvc2Quc3RhdHVzXS5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCF0aGlzLmZpbHRlckxpc3QuVXRpbGl6YXRpb25bb3NkLnVzYWdlLnN0YXR1c10uZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyTGlzdC5VdGlsaXphdGlvbltvc2QudXNhZ2Uuc3RhdHVzXS5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qIHdlIGhhdmUgcGcgc3VtbWFyeSBpbiBvYmplY3QgZm9ybWF0IHdpdGggJysnIHNpZ24gLiBleGFtcGxlIC0gXCJwZ3N1bW1hcnlcIjp7XCJhY3RpdmUrdW5kZXJzaXplZCtkZWdyYWRlZFwiOjEyOH0gLlxuICAgICAgICAgICAgSGVyZSAsIHdlIHdhbnQgdG8gZWFjaCBrZXkgYWZ0ZXIgc3BsaXRpbmcgd2l0aCAnKycgc2lnbiAsIHNob3VsZCBiZSBhcnJheSBlbGVtZW50c1xuICAgICAgICAgICAgc28gdGhhdCBlYXNpbHkgY2FuIGFwcGx5IGZpbHRlciAgKi9cbiAgICAgICAgICAgIE9iamVjdC5rZXlzKG9zZC5vcHRpb25zMS5wZ3N1bW1hcnkpLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBwZ0FycmF5ID0gcGdBcnJheS5jb25jYXQoZWxlbWVudC5zcGxpdChcIitcIikpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBvc2Qub3B0aW9uczEucGdzdW1tYXJ5LnBnYXJyYXkgPSBwZ0FycmF5O1xuICAgICAgICAgICAgb3NkLm5vZGUgPSBvc2Qub3B0aW9uczEubm9kZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyogUGVyZm9ybWluZyBHcm91cCBieSAqL1xuICAgIHB1YmxpYyBwZXJmb3JtR3JvdXBCeSgpIHtcbiAgICAgICAgaWYodGhpcy5ncm91cEJ5ID09PSAnbm9kZScpIHtcbiAgICAgICAgICAgIHRoaXMub3NkTGlzdEdyb3VwQnkgPSBfLmdyb3VwQnkodGhpcy5vc2RMaXN0LCBmdW5jdGlvbihvc2QpeyByZXR1cm4gb3NkLm9wdGlvbnMxLm5vZGUgfSk7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3NkTGlzdEdyb3VwQnkgPSBfLmdyb3VwQnkodGhpcy5vc2RMaXN0LCBmdW5jdGlvbihvc2QpeyByZXR1cm4gb3NkLnN0b3JhZ2Vwcm9maWxlIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyogQ2FsbGluZyBvbiBvc2QgYWN0aW9uIGNoYW5nZWQgYW5kIHBlcmZvcm1pbmcgYWN0aW9ucyBvbiBzZWxlY3RlZCBvc2RzICovXG4gICAgcHVibGljIG9zZEFjdGlvbkNoYW5nZShvc2RBY3Rpb24pIHtcbiAgICAgICAgbGV0IGFjdGlvbk9iamVjdCA9IChvc2RBY3Rpb249PT0nbWFya191cCc/e3VwOnRydWV9Oihvc2RBY3Rpb249PT0nbWFya19pbic/e2luOnRydWV9OntpbjpmYWxzZX0pKTtcbiAgICAgICAgaWYob3NkQWN0aW9uID09PSAnbWFya19vdXQnKSB7XG4gICAgICAgICAgICB2YXIgbW9kYWwgPSBNb2RhbEhlbHBlcnMuT3NkQWN0aW9uQ29uZmlybWF0aW9uKHRoaXMuJG1vZGFsLCB7fSwgJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBtb3ZlIHRoZSBzZWxlY3RlZCBPU0RzIG91dCBvZiB0aGUgY2x1c3Rlcj8nKTtcbiAgICAgICAgICAgIG1vZGFsLiRzY29wZS4kaGlkZSA9IF8ud3JhcChtb2RhbC4kc2NvcGUuJGhpZGUsICgkaGlkZSwgY29uZmlybWVkOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBlcmZvcm1Pc2RBY3Rpb24oYWN0aW9uT2JqZWN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJGhpZGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBlcmZvcm1Pc2RBY3Rpb24oYWN0aW9uT2JqZWN0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qIFBlcmZvcm1pbmcgdGhlIEFjdGlvbnMgb24gc2VsZWN0ZWQgb3NkcyAqL1xuICAgIHB1YmxpYyBwZXJmb3JtT3NkQWN0aW9uKGFjdGlvbk9iamVjdCkge1xuICAgICAgICBpZih0aGlzLnRvdGFsU2VsZWN0ZWRPU0RzLmxlbmd0aCA9PT0gMCApIHtcbiAgICAgICAgICAgIHRoaXMuY2x1c3RlclNlcnZpY2Uuc2x1c0FjdGlvbih0aGlzLmlkLHRoaXMuc2VsZWN0aW9uLmFjdGl2ZU9zZC5zbHVpZCxhY3Rpb25PYmplY3QpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFN2Yy5nZXQocmVzdWx0LmRhdGEudGFza2lkKS50aGVuKCh0YXNrKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFRyYWNraW5nU3ZjLmFkZCh0YXNrLmlkLCB0YXNrLm5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIF8uZWFjaCh0aGlzLnRvdGFsU2VsZWN0ZWRPU0RzLCAob3NkOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsdXN0ZXJTZXJ2aWNlLnNsdXNBY3Rpb24odGhpcy5pZCxvc2Quc2x1aWQsYWN0aW9uT2JqZWN0KS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0U3ZjLmdldChyZXN1bHQuZGF0YS50YXNraWQpLnRoZW4oKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFRyYWNraW5nU3ZjLmFkZCh0YXNrLmlkLCB0YXNrLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uLmFsbFNlbGVjdGVkT3Nkcz0ge307XG4gICAgICAgIHRoaXMudG90YWxTZWxlY3RlZE9TRHMgPSBbXTtcbiAgICAgICAgdGhpcy50aW1lb3V0U2VydmljZSgoKSA9PiB0aGlzLmdldE9TRHMoKSwgMTAwMDApO1xuICAgIH1cblxuICAgIC8qIE1haW50YWluaW5nIHRoZSB0b3RhbCBzZWxlY3RlZCBvc2RzIGJ5IGNoZWNrYm94IGZvciBBY3Rpb24gKi9cbiAgICBwdWJsaWMgbWFpbnRhaW5Ub3RhbFNlbGVjdGVkT3NkcygpIHtcbiAgICAgICAgdGhpcy50b3RhbFNlbGVjdGVkT1NEcyA9IFtdO1xuICAgICAgICBfLmZvck93bih0aGlzLmZpbHRlcmVkT1NELCAodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICAgICAgXy5lYWNoKHZhbHVlLCAob3NkOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb24uYWxsU2VsZWN0ZWRPc2RzW29zZC5zbHVpZF0gPT09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxTZWxlY3RlZE9TRHMucHVzaChvc2QpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKiBBcHBseWluZyBmaWx0ZXIgb24gT1NEIGxpc3QgZnJvbSB0aGUgbmctcmVwZWF0IGluIFVJLiBoZXJlIHdlIGhhdmUgMyBzZXQgb2YgZmlsdGVycyBiYXNlZCBvblxuICAgIDEpb3NkIHN0YXR1cyAyKXV0aWxpemF0aW9uIDMpIHBnX3N0YXR1cyAuIGFuZCBhdCBhIHRpbWUgb25seSBvbmUgc2V0IG9mIGZpbHRlciBjYW4gYmUgYXBwbGllZCAuXG4gICAgc28gdGhhdCB3aHkgaGVyZSBpIGhhdmUgaWYgY29uZGl0aW9uIHRvIGNoZWNrIHRoZSBzZXQgb2YgZmlsdGVyIC4gKi9cbiAgICBwdWJsaWMgYXBwbHlGaWx0ZXIgPSAob3NkKSA9PiB7XG4gICAgICAgIGlmKHRoaXMuYWN0aXZlRmlsdGVyID09PSAnb3NkX3N0YXR1cycpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlckxpc3QuT1NEU3RhdHVzW29zZC5zdGF0dXNdLmNoZWNrZWQgfHwgdGhpcy5pc05vRmlsdGVyU2VsZWN0ZWQodGhpcy5maWx0ZXJMaXN0Lk9TRFN0YXR1cyk7XG4gICAgICAgIH1lbHNlIGlmKHRoaXMuYWN0aXZlRmlsdGVyID09PSAndXRpbGl6YXRpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJMaXN0LlV0aWxpemF0aW9uW29zZC51c2FnZS5zdGF0dXNdLmNoZWNrZWQgfHwgdGhpcy5pc05vRmlsdGVyU2VsZWN0ZWQodGhpcy5maWx0ZXJMaXN0LlV0aWxpemF0aW9uKTtcbiAgICAgICAgfWVsc2UgaWYodGhpcy5hY3RpdmVGaWx0ZXIgPT09ICdwZ19zdGF0dXMnKSB7XG4gICAgICAgICAgICBpZih0aGlzLmlzTm9GaWx0ZXJTZWxlY3RlZCh0aGlzLmZpbHRlckxpc3QuUEdTdGF0dXMpKSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICBfLmVhY2godGhpcy5maWx0ZXJMaXN0LlBHU3RhdHVzLCAoZWxlbWVudDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYoZWxlbWVudC5jaGVja2VkKXtcbiAgICAgICAgICAgICAgICAgICAgaWYob3NkLm9wdGlvbnMxLnBnc3VtbWFyeS5wZ2FycmF5LmluZGV4T2YoZWxlbWVudC5uYW1lKSA9PT0gLTEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBJdCB3aWxsIHJldHVybiB0cnVlL2ZhbHNlIGJhc2VkIG9uIGdpdmVuIGZpbHRlciBncm91cC5cbiAgICBJZiB0aGVyZSBpcyBubyBmaWx0ZXIgYXBwbGllZCBmb3IgdGhpcyAsIHRoYW4gaXQgd2lsbCByZXR1cm4gdHJ1ZVxuICAgIG90aGVyd2lzZSBpdCB3aWxsIHJldHVybiBmYWxzZS4qL1xuICAgIHB1YmxpYyBpc05vRmlsdGVyU2VsZWN0ZWQoZmlsdGVyT2JqKSB7XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBmaWx0ZXJPYmopIHtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJPYmpba2V5XS5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxufVxuIl19
