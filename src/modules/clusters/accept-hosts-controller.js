// <reference path="../typings/tsd.d.ts" />
var AcceptHostsController = (function () {
    function AcceptHostsController($location, $scope, $interval, $log, $timeout, $modal, serverSvc, requestSvc, utilSvc, requestTrackingSvc) {
        var _this = this;
        this.$location = $location;
        this.$scope = $scope;
        this.$interval = $interval;
        this.$log = $log;
        this.$timeout = $timeout;
        this.$modal = $modal;
        this.serverSvc = serverSvc;
        this.requestSvc = requestSvc;
        this.utilSvc = utilSvc;
        this.requestTrackingSvc = requestTrackingSvc;
        var queryParams = this.$location.search();
        this.expandcluster = queryParams['expandcluster'];
        this.from = queryParams['from'];
        this.discoveredHosts = [];
        this.hostsBeingAccepted = [];
        this.timer = this.$interval(function () { return _this.refreshHostsStatus(); }, 5000);
        this.$scope.$on('$destroy', function () {
            _this.$interval.cancel(_this.timer);
        });
        this.serverSvc.getDiscoveredHosts().then(function (discoverdHosts) {
            _.each(discoverdHosts, function (discoverdHost) {
                var host = {
                    hostname: discoverdHost.hostname,
                    fingerPrint: discoverdHost.saltfingerprint,
                    state: "UNACCEPTED",
                };
                _this.discoveredHosts.push(host);
            });
        });
    }
    AcceptHostsController.prototype.refreshHostsStatus = function () {
        var _this = this;
        _.each(this.hostsBeingAccepted, function (host) {
            if (host.state === "ACCEPTING") {
                _this.requestSvc.get(host.taskid).then(function (task) {
                    if (task.completed && task.status === 1) {
                        //Getting the initializing task for the particular host. Even if there are many failed initializing tasks for a given host, first one should be
                        //either in progress task and last updated task.
                        _this.requestSvc.getList(undefined, undefined, undefined, undefined, undefined, 'Initialize Node: ' + host.hostname).then(function (data) {
                            if (data.totalcount > 0) {
                                host.taskid = data.tasks[0].id;
                                _this.$log.info('Accepted host ' + host.hostname + ' in Accept Hosts Controller ');
                                host.state = "INITIALIZING";
                            }
                        });
                    }
                    else if (task.completed && (task.status === 2 || task.status === 3)) {
                        _this.$log.info('Failed to accept host ' + host.hostname + ' in Accept Hosts Controller ');
                        host.state = "FAILED";
                    }
                });
            }
            else if (host.state === "INITIALIZING") {
                _this.requestSvc.get(host.taskid).then(function (task) {
                    if (task.completed && task.status === 1) {
                        _this.$log.info('Initialized host ' + host.hostname + ' in Accept Hosts Controller ');
                        host.state = "INITIALIZED";
                        host.lastupdated = task.statuslist[task.statuslist.length - 1].Timestamp;
                    }
                    else if (task.completed && (task.status === 2 || task.status === 3)) {
                        _this.$log.info('Failed to initialize host ' + host.hostname + ' in Accept Hosts Controller');
                        host.state = "FAILED";
                        host.lastupdated = task.statuslist[task.statuslist.length - 1].Timestamp;
                    }
                });
            }
        });
    };
    AcceptHostsController.prototype.acceptAllHosts = function () {
        var _this = this;
        _.each(this.discoveredHosts, function (host) {
            if (host.state === 'UNACCEPTED') {
                _this.acceptHost(host);
            }
        });
    };
    AcceptHostsController.prototype.acceptHost = function (host) {
        var _this = this;
        var saltfingerprint = {
            saltfingerprint: host.fingerPrint
        };
        this.utilSvc.acceptHost(host.hostname, saltfingerprint).then(function (result) {
            _this.$log.info(result);
            _this.hostsBeingAccepted.push(host);
            host.state = "ACCEPTING";
            host.taskid = result.data.taskid;
        });
    };
    AcceptHostsController.prototype.showAcceptTaskDetails = function (host) {
        this.showTaskDetailsModal(host.taskid);
    };
    AcceptHostsController.prototype.showTaskDetailsModal = function (taskId) {
        return this.$modal({
            template: 'views/modal/task-details-popup.html',
            backdrop: 'static',
            keyboard: false,
            controller: function () {
                this.taskId = taskId;
            },
            controllerAs: 'tasks'
        });
    };
    AcceptHostsController.prototype.reinitialize = function (host) {
        this.serverSvc.reinitialize(host.hostname).then(function (result) {
            if (result.status === 200) {
                host.taskid = result.data.taskid;
                host.state = "INITIALIZING";
            }
        });
    };
    AcceptHostsController.prototype.hostsFailedToInitialize = function () {
        return _.filter(this.discoveredHosts, function (host) { return host.state === 'FAILED'; }).length;
    };
    AcceptHostsController.prototype.hostsInitialized = function () {
        return _.filter(this.discoveredHosts, function (host) { return host.state === 'INITIALIZED'; }).length;
    };
    AcceptHostsController.prototype.hostsInProgress = function () {
        return _.filter(this.discoveredHosts, function (host) { return (host.state === 'ACCEPTING' || host.state === 'INITIALIZING'); }).length;
    };
    AcceptHostsController.prototype.continue = function () {
        this.$location.search({});
        if (this.expandcluster !== undefined) {
            this.$location.path('/clusters/expand/' + this.expandcluster).search('hostsaccepted', 'true');
        }
        else {
            this.$location.path('/clusters/new').search('hostsaccepted', 'true');
        }
    };
    AcceptHostsController.prototype.cancel = function () {
        this.$location.search({});
        if (this.from !== undefined) {
            this.$location.path(this.from);
        }
        else {
            this.$location.path('/clusters');
        }
    };
    AcceptHostsController.$inject = ['$location', '$scope', '$interval', '$log', '$timeout', '$modal', 'ServerService', 'RequestService', 'UtilService', 'RequestTrackingService'];
    return AcceptHostsController;
})();
exports.AcceptHostsController = AcceptHostsController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvY2x1c3RlcnMvYWNjZXB0LWhvc3RzLWNvbnRyb2xsZXIudHMiXSwibmFtZXMiOlsiQWNjZXB0SG9zdHNDb250cm9sbGVyIiwiQWNjZXB0SG9zdHNDb250cm9sbGVyLmNvbnN0cnVjdG9yIiwiQWNjZXB0SG9zdHNDb250cm9sbGVyLnJlZnJlc2hIb3N0c1N0YXR1cyIsIkFjY2VwdEhvc3RzQ29udHJvbGxlci5hY2NlcHRBbGxIb3N0cyIsIkFjY2VwdEhvc3RzQ29udHJvbGxlci5hY2NlcHRIb3N0IiwiQWNjZXB0SG9zdHNDb250cm9sbGVyLnNob3dBY2NlcHRUYXNrRGV0YWlscyIsIkFjY2VwdEhvc3RzQ29udHJvbGxlci5zaG93VGFza0RldGFpbHNNb2RhbCIsIkFjY2VwdEhvc3RzQ29udHJvbGxlci5yZWluaXRpYWxpemUiLCJBY2NlcHRIb3N0c0NvbnRyb2xsZXIuaG9zdHNGYWlsZWRUb0luaXRpYWxpemUiLCJBY2NlcHRIb3N0c0NvbnRyb2xsZXIuaG9zdHNJbml0aWFsaXplZCIsIkFjY2VwdEhvc3RzQ29udHJvbGxlci5ob3N0c0luUHJvZ3Jlc3MiLCJBY2NlcHRIb3N0c0NvbnRyb2xsZXIuY29udGludWUiLCJBY2NlcHRIb3N0c0NvbnRyb2xsZXIuY2FuY2VsIl0sIm1hcHBpbmdzIjoiQUFBQSwyQ0FBMkM7QUFPM0M7SUFPSUEsK0JBQ1lBLFNBQThCQSxFQUM5QkEsTUFBaUJBLEVBQ2pCQSxTQUE4QkEsRUFDOUJBLElBQW9CQSxFQUNwQkEsUUFBNEJBLEVBQzVCQSxNQUFNQSxFQUNOQSxTQUF3QkEsRUFDeEJBLFVBQTBCQSxFQUMxQkEsT0FBb0JBLEVBQ3BCQSxrQkFBMENBO1FBakIxREMsaUJBd0pDQTtRQWhKZUEsY0FBU0EsR0FBVEEsU0FBU0EsQ0FBcUJBO1FBQzlCQSxXQUFNQSxHQUFOQSxNQUFNQSxDQUFXQTtRQUNqQkEsY0FBU0EsR0FBVEEsU0FBU0EsQ0FBcUJBO1FBQzlCQSxTQUFJQSxHQUFKQSxJQUFJQSxDQUFnQkE7UUFD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SUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDbkNBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ0pBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBO1FBQ3JDQSxDQUFDQTtJQUNMQSxDQUFDQTtJQWpKTVosNkJBQU9BLEdBQWtCQSxDQUFDQSxXQUFXQSxFQUFFQSxRQUFRQSxFQUFFQSxXQUFXQSxFQUFFQSxNQUFNQSxFQUFFQSxVQUFVQSxFQUFFQSxRQUFRQSxFQUFFQSxlQUFlQSxFQUFFQSxnQkFBZ0JBLEVBQUVBLGFBQWFBLEVBQUVBLHdCQUF3QkEsQ0FBQ0EsQ0FBQ0E7SUFrSm5MQSw0QkFBQ0E7QUFBREEsQ0F4SkEsQUF3SkNBLElBQUE7QUF4SlksNkJBQXFCLHdCQXdKakMsQ0FBQSIsImZpbGUiOiJtb2R1bGVzL2NsdXN0ZXJzL2FjY2VwdC1ob3N0cy1jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy90c2QuZC50c1wiIC8+XG5cbmltcG9ydCB7U2VydmVyU2VydmljZX0gZnJvbSAnLi4vcmVzdC9zZXJ2ZXInO1xuaW1wb3J0IHtSZXF1ZXN0U2VydmljZX0gZnJvbSAnLi4vcmVzdC9yZXF1ZXN0JztcbmltcG9ydCB7VXRpbFNlcnZpY2V9IGZyb20gJy4uL3Jlc3QvdXRpbCdcbmltcG9ydCB7UmVxdWVzdFRyYWNraW5nU2VydmljZX0gZnJvbSAnLi4vcmVxdWVzdHMvcmVxdWVzdC10cmFja2luZy1zdmMnO1xuXG5leHBvcnQgY2xhc3MgQWNjZXB0SG9zdHNDb250cm9sbGVyIHtcbiAgICBwcml2YXRlIGRpc2NvdmVyZWRIb3N0czogQXJyYXk8YW55PjtcbiAgICBwcml2YXRlIGhvc3RzQmVpbmdBY2NlcHRlZDogQXJyYXk8YW55PjtcbiAgICBwcml2YXRlIGV4cGFuZGNsdXN0ZXI6c3RyaW5nO1xuICAgIHByaXZhdGUgZnJvbTpzdHJpbmc7XG4gICAgcHJpdmF0ZSB0aW1lcjtcbiAgICBzdGF0aWMgJGluamVjdDogQXJyYXk8c3RyaW5nPiA9IFsnJGxvY2F0aW9uJywgJyRzY29wZScsICckaW50ZXJ2YWwnLCAnJGxvZycsICckdGltZW91dCcsICckbW9kYWwnLCAnU2VydmVyU2VydmljZScsICdSZXF1ZXN0U2VydmljZScsICdVdGlsU2VydmljZScsICdSZXF1ZXN0VHJhY2tpbmdTZXJ2aWNlJ107XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgJGxvY2F0aW9uOiBuZy5JTG9jYXRpb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlICRzY29wZTogbmcuSVNjb3BlLFxuICAgICAgICBwcml2YXRlICRpbnRlcnZhbDogbmcuSUludGVydmFsU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSAkbG9nOiBuZy5JTG9nU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSAkdGltZW91dDogbmcuSVRpbWVvdXRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlICRtb2RhbCxcbiAgICAgICAgcHJpdmF0ZSBzZXJ2ZXJTdmM6IFNlcnZlclNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgcmVxdWVzdFN2YzogUmVxdWVzdFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgdXRpbFN2YzogVXRpbFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgcmVxdWVzdFRyYWNraW5nU3ZjOiBSZXF1ZXN0VHJhY2tpbmdTZXJ2aWNlKSB7XG4gICAgICAgIHZhciBxdWVyeVBhcmFtcyA9IHRoaXMuJGxvY2F0aW9uLnNlYXJjaCgpO1xuICAgICAgICB0aGlzLmV4cGFuZGNsdXN0ZXIgPSBxdWVyeVBhcmFtc1snZXhwYW5kY2x1c3RlciddO1xuICAgICAgICB0aGlzLmZyb20gPSBxdWVyeVBhcmFtc1snZnJvbSddO1xuICAgICAgICB0aGlzLmRpc2NvdmVyZWRIb3N0cyA9IFtdO1xuICAgICAgICB0aGlzLmhvc3RzQmVpbmdBY2NlcHRlZCA9IFtdO1xuICAgICAgICB0aGlzLnRpbWVyID0gdGhpcy4kaW50ZXJ2YWwoKCkgPT4gdGhpcy5yZWZyZXNoSG9zdHNTdGF0dXMoKSwgNTAwMCk7XG4gICAgICAgIHRoaXMuJHNjb3BlLiRvbignJGRlc3Ryb3knLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLiRpbnRlcnZhbC5jYW5jZWwodGhpcy50aW1lcik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNlcnZlclN2Yy5nZXREaXNjb3ZlcmVkSG9zdHMoKS50aGVuKChkaXNjb3ZlcmRIb3N0cykgPT4ge1xuICAgICAgICAgICAgXy5lYWNoKGRpc2NvdmVyZEhvc3RzLCAoZGlzY292ZXJkSG9zdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIGhvc3QgPSB7XG4gICAgICAgICAgICAgICAgICAgIGhvc3RuYW1lOiBkaXNjb3ZlcmRIb3N0Lmhvc3RuYW1lLFxuICAgICAgICAgICAgICAgICAgICBmaW5nZXJQcmludDogZGlzY292ZXJkSG9zdC5zYWx0ZmluZ2VycHJpbnQsXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlOiBcIlVOQUNDRVBURURcIixcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzY292ZXJlZEhvc3RzLnB1c2goaG9zdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIHB1YmxpYyByZWZyZXNoSG9zdHNTdGF0dXMoKSB7XG4gICAgICAgIF8uZWFjaCh0aGlzLmhvc3RzQmVpbmdBY2NlcHRlZCwgKGhvc3QpID0+IHtcbiAgICAgICAgICAgIGlmIChob3N0LnN0YXRlID09PSBcIkFDQ0VQVElOR1wiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0U3ZjLmdldChob3N0LnRhc2tpZCkudGhlbigodGFzaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFzay5jb21wbGV0ZWQgJiYgdGFzay5zdGF0dXMgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vR2V0dGluZyB0aGUgaW5pdGlhbGl6aW5nIHRhc2sgZm9yIHRoZSBwYXJ0aWN1bGFyIGhvc3QuIEV2ZW4gaWYgdGhlcmUgYXJlIG1hbnkgZmFpbGVkIGluaXRpYWxpemluZyB0YXNrcyBmb3IgYSBnaXZlbiBob3N0LCBmaXJzdCBvbmUgc2hvdWxkIGJlXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2VpdGhlciBpbiBwcm9ncmVzcyB0YXNrIGFuZCBsYXN0IHVwZGF0ZWQgdGFzay5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFN2Yy5nZXRMaXN0KHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCAnSW5pdGlhbGl6ZSBOb2RlOiAnICsgaG9zdC5ob3N0bmFtZSkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnRvdGFsY291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3QudGFza2lkID0gZGF0YS50YXNrc1swXS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmluZm8oJ0FjY2VwdGVkIGhvc3QgJyArIGhvc3QuaG9zdG5hbWUgKyAnIGluIEFjY2VwdCBIb3N0cyBDb250cm9sbGVyICcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0LnN0YXRlID0gXCJJTklUSUFMSVpJTkdcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0YXNrLmNvbXBsZXRlZCAmJiAodGFzay5zdGF0dXMgPT09IDIgfHwgdGFzay5zdGF0dXMgPT09IDMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRsb2cuaW5mbygnRmFpbGVkIHRvIGFjY2VwdCBob3N0ICcgKyBob3N0Lmhvc3RuYW1lICsgJyBpbiBBY2NlcHQgSG9zdHMgQ29udHJvbGxlciAnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvc3Quc3RhdGUgPSBcIkZBSUxFRFwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChob3N0LnN0YXRlID09PSBcIklOSVRJQUxJWklOR1wiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0U3ZjLmdldChob3N0LnRhc2tpZCkudGhlbigodGFzaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFzay5jb21wbGV0ZWQgJiYgdGFzay5zdGF0dXMgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGxvZy5pbmZvKCdJbml0aWFsaXplZCBob3N0ICcgKyBob3N0Lmhvc3RuYW1lICsgJyBpbiBBY2NlcHQgSG9zdHMgQ29udHJvbGxlciAnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvc3Quc3RhdGUgPSBcIklOSVRJQUxJWkVEXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBob3N0Lmxhc3R1cGRhdGVkID0gdGFzay5zdGF0dXNsaXN0W3Rhc2suc3RhdHVzbGlzdC5sZW5ndGggLSAxXS5UaW1lc3RhbXA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGFzay5jb21wbGV0ZWQgJiYgKHRhc2suc3RhdHVzID09PSAyIHx8IHRhc2suc3RhdHVzID09PSAzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbG9nLmluZm8oJ0ZhaWxlZCB0byBpbml0aWFsaXplIGhvc3QgJyArIGhvc3QuaG9zdG5hbWUgKyAnIGluIEFjY2VwdCBIb3N0cyBDb250cm9sbGVyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBob3N0LnN0YXRlID0gXCJGQUlMRURcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvc3QubGFzdHVwZGF0ZWQgPSB0YXNrLnN0YXR1c2xpc3RbdGFzay5zdGF0dXNsaXN0Lmxlbmd0aCAtIDFdLlRpbWVzdGFtcDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWNjZXB0QWxsSG9zdHMoKSB7XG4gICAgICAgIF8uZWFjaCh0aGlzLmRpc2NvdmVyZWRIb3N0cywgKGhvc3QpID0+IHtcbiAgICAgICAgICAgIGlmIChob3N0LnN0YXRlID09PSAnVU5BQ0NFUFRFRCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjY2VwdEhvc3QoaG9zdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgcHVibGljIGFjY2VwdEhvc3QoaG9zdCkge1xuICAgICAgICB2YXIgc2FsdGZpbmdlcnByaW50ID0ge1xuICAgICAgICAgICAgc2FsdGZpbmdlcnByaW50OiBob3N0LmZpbmdlclByaW50XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy51dGlsU3ZjLmFjY2VwdEhvc3QoaG9zdC5ob3N0bmFtZSwgc2FsdGZpbmdlcnByaW50KS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuJGxvZy5pbmZvKHJlc3VsdCk7XG4gICAgICAgICAgICB0aGlzLmhvc3RzQmVpbmdBY2NlcHRlZC5wdXNoKGhvc3QpO1xuICAgICAgICAgICAgaG9zdC5zdGF0ZSA9IFwiQUNDRVBUSU5HXCI7XG4gICAgICAgICAgICBob3N0LnRhc2tpZCA9IHJlc3VsdC5kYXRhLnRhc2tpZDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNob3dBY2NlcHRUYXNrRGV0YWlscyhob3N0KSB7XG4gICAgICAgIHRoaXMuc2hvd1Rhc2tEZXRhaWxzTW9kYWwoaG9zdC50YXNraWQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2hvd1Rhc2tEZXRhaWxzTW9kYWwodGFza0lkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRtb2RhbCh7XG4gICAgICAgICAgICB0ZW1wbGF0ZTogJ3ZpZXdzL21vZGFsL3Rhc2stZGV0YWlscy1wb3B1cC5odG1sJyxcbiAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJywgLy8gZGlzYWJsZSBtb3VzZSBjbGlja3MgZm9yIG5vdyBzaW5jZSBJIGNhbid0IHdyYXAgdGhlbSBvciBzdXBwbHkgYSBjYWxsYmFja1xuICAgICAgICAgICAga2V5Ym9hcmQ6IGZhbHNlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50YXNrSWQgPSB0YXNrSWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndGFza3MnXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyByZWluaXRpYWxpemUoaG9zdCkge1xuICAgICAgICB0aGlzLnNlcnZlclN2Yy5yZWluaXRpYWxpemUoaG9zdC5ob3N0bmFtZSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgaG9zdC50YXNraWQgPSByZXN1bHQuZGF0YS50YXNraWQ7XG4gICAgICAgICAgICAgICAgaG9zdC5zdGF0ZSA9IFwiSU5JVElBTElaSU5HXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBob3N0c0ZhaWxlZFRvSW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHRoaXMuZGlzY292ZXJlZEhvc3RzLCBob3N0ID0+IGhvc3Quc3RhdGUgPT09ICdGQUlMRUQnKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgcHVibGljIGhvc3RzSW5pdGlhbGl6ZWQoKSB7XG4gICAgICAgIHJldHVybiBfLmZpbHRlcih0aGlzLmRpc2NvdmVyZWRIb3N0cywgaG9zdCA9PiBob3N0LnN0YXRlID09PSAnSU5JVElBTElaRUQnKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgcHVibGljIGhvc3RzSW5Qcm9ncmVzcygpIHtcbiAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHRoaXMuZGlzY292ZXJlZEhvc3RzLCBob3N0ID0+IChob3N0LnN0YXRlID09PSAnQUNDRVBUSU5HJyB8fCBob3N0LnN0YXRlID09PSAnSU5JVElBTElaSU5HJykpLmxlbmd0aDtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29udGludWUoKSB7XG4gICAgICAgIHRoaXMuJGxvY2F0aW9uLnNlYXJjaCh7fSk7XG4gICAgICAgIGlmICh0aGlzLmV4cGFuZGNsdXN0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy4kbG9jYXRpb24ucGF0aCgnL2NsdXN0ZXJzL2V4cGFuZC8nICsgdGhpcy5leHBhbmRjbHVzdGVyKS5zZWFyY2goJ2hvc3RzYWNjZXB0ZWQnLCAndHJ1ZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy4kbG9jYXRpb24ucGF0aCgnL2NsdXN0ZXJzL25ldycpLnNlYXJjaCgnaG9zdHNhY2NlcHRlZCcsICd0cnVlJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY2FuY2VsKCkge1xuICAgICAgICB0aGlzLiRsb2NhdGlvbi5zZWFyY2goe30pO1xuICAgICAgICBpZiAodGhpcy5mcm9tICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuJGxvY2F0aW9uLnBhdGgodGhpcy5mcm9tKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuJGxvY2F0aW9uLnBhdGgoJy9jbHVzdGVycycpO1xuICAgICAgICB9XG4gICAgfVxufSJdfQ==
