// <reference path="../typings/tsd.d.ts" />
var cluster_helpers_1 = require('./cluster-helpers');
var ModalHelpers = require('../modal/modal-helpers');
var ClusterExpandController = (function () {
    function ClusterExpandController(qService, logService, scopeService, modalService, timeoutService, locationService, routeParamsSvc, osdService, utilService, serverService, clusterService, requestService, requestTrackingService, configSvc) {
        var _this = this;
        this.qService = qService;
        this.logService = logService;
        this.scopeService = scopeService;
        this.modalService = modalService;
        this.timeoutService = timeoutService;
        this.locationService = locationService;
        this.routeParamsSvc = routeParamsSvc;
        this.osdService = osdService;
        this.utilService = utilService;
        this.serverService = serverService;
        this.clusterService = clusterService;
        this.requestService = requestService;
        this.requestTrackingService = requestTrackingService;
        this.configSvc = configSvc;
        this.cephMixHostRoles = false;
        this.newHost = {};
        this.selectedHosts = 0;
        this.hosts = [];
        this.disks = [];
        this.clusterHelper = new cluster_helpers_1.ClusterHelper(utilService, requestService, logService, timeoutService);
        this.clusterID = this.routeParamsSvc['id'];
        this.hostTypes = ["Monitor", "OSD Host", "OSD + Monitor"];
        this.configSvc.getConfig().then(function (config) {
            if (config.ceph_mix_host_roles) {
                _this.cephMixHostRoles = config.ceph_mix_host_roles;
            }
        });
        this.clusterService.get(this.clusterID).then(function (cluster) { return _this.loadCluster(cluster); });
        var queryParams = locationService.search();
        if (Object.keys(queryParams).length > 0 && queryParams['hostsaccepted'] === "true") {
            this.fetchFreeHosts();
        }
        else {
            this.serverService.getDiscoveredHosts().then(function (freeHosts) {
                if (freeHosts.length > 0) {
                    var modal = ModalHelpers.UnAcceptedHostsFound(_this.modalService, {}, freeHosts.length);
                    modal.$scope.$hide = _.wrap(modal.$scope.$hide, function ($hide, confirmed) {
                        if (confirmed) {
                            _this.locationService.path('/clusters/new/accept-hosts').search('expandcluster', _this.clusterID);
                        }
                        $hide();
                        _this.fetchFreeHosts();
                    });
                }
                else {
                    _this.fetchFreeHosts();
                }
            });
        }
    }
    ClusterExpandController.prototype.loadCluster = function (cluster) {
        this.cluster = cluster;
        this.name = cluster.name;
        this.clusterType = this.clusterHelper.getClusterType(cluster.cluster_type);
    };
    ClusterExpandController.prototype.updateFingerPrint = function (host) {
        var _this = this;
        this.newHost.cautionMessage = "";
        this.newHost.errorMessage = "";
        this.utilService.getSshFingerprint(host.hostname).then(function (sshfingerprint) {
            host.sshfingerprint = sshfingerprint;
        }, function () {
            _this.newHost.cautionMessage = "Error!.";
            _this.newHost.errorMessage = "Could not fetch ssh fingerprint";
        });
    };
    ClusterExpandController.prototype.updateIPAddress = function (host) {
        this.utilService.getIpAddresses(host.hostname).then(function (result) {
            host.ipaddress = result.length > 0 ? result[0] : "N/A";
        });
    };
    ClusterExpandController.prototype.fetchFreeHosts = function () {
        var _this = this;
        this.serverService.getFreeHosts().then(function (freeHosts) { return _this.loadFreeHosts(freeHosts); });
    };
    ClusterExpandController.prototype.loadFreeHosts = function (freeHosts) {
        var _this = this;
        this.hosts = [];
        _.each(freeHosts, function (freeHost) {
            var host = {
                id: freeHost.nodeid,
                hostname: freeHost.hostname,
                ipaddress: freeHost.management_ip4,
                state: "ACCEPTED",
                disks: freeHost.storage_disks,
                selected: false,
            };
            host.disks = _.filter(freeHost.storage_disks, function (disk) {
                return disk.Type === 'disk' && disk.Used === false;
            });
            _this.hosts.push(host);
            _this.updateFingerPrint(host);
        });
    };
    ClusterExpandController.prototype.selectAllHosts = function () {
        var _this = this;
        this.selectedHosts = 0;
        _.each(this.hosts, function (host) {
            _this.selectHost(host, true);
        });
    };
    ClusterExpandController.prototype.selectHost = function (host, selection) {
        host.selected = selection;
        if (selection && host.hostType === undefined) {
            if (host.disks.length === 0) {
                host.hostType = this.hostTypes[0]; //No Disk available so make this a Mon
            }
            else {
                host.hostType = this.hostTypes[1]; //There are some disks so it can be an OSD
            }
        }
        host.selected ? this.selectedHosts++ : this.selectedHosts--;
        this.countDisks();
        this.validateHost(host);
    };
    ClusterExpandController.prototype.isMon = function (hostType) {
        return hostType === this.hostTypes[0] || hostType === this.hostTypes[2];
    };
    ClusterExpandController.prototype.isOsd = function (hostType) {
        return hostType === this.hostTypes[1] || hostType === this.hostTypes[2];
    };
    ClusterExpandController.prototype.getDisks = function () {
        return this.disks;
    };
    ClusterExpandController.prototype.getHostsDisksSize = function (host) {
        var size = 0;
        size = _.reduce(host.disks, function (size, disk) {
            return size + disk.Size;
        }, 0);
        return size;
    };
    ClusterExpandController.prototype.getDisksSize = function () {
        var size = 0;
        size = _.reduce(this.disks, function (size, disk) {
            return size + disk.Size;
        }, 0);
        return size;
    };
    ClusterExpandController.prototype.countDisks = function () {
        var _this = this;
        var disks = [];
        _.each(this.hosts, function (host) {
            if (host.selected && _this.isOsd(host.hostType)) {
                Array.prototype.push.apply(disks, host.disks);
            }
        });
        this.disks = disks;
    };
    ClusterExpandController.prototype.hostTypeChanged = function (host) {
        this.validateHost(host);
        this.countDisks();
    };
    ClusterExpandController.prototype.validateHost = function (host) {
        if (host.selected) {
            if (host.hostType === undefined) {
                this.errorMessage = "Host '" + host.hostname + "' does not have any role attached.";
                return false;
            }
            else if (this.isOsd(host.hostType) && host.disks.length === 0) {
                this.errorMessage = "Host '" + host.hostname + "' does not have any disk attached and it can't be added as an OSD Host.";
                return false;
            }
        }
        this.errorMessage = "";
        return true;
    };
    ClusterExpandController.prototype.validateHosts = function () {
        var _this = this;
        this.newHost.errorMessage = "";
        var configValid = true;
        var selectedHosts = _.filter(this.hosts, function (host) { return host.selected; });
        if (selectedHosts.length === 0) {
            this.errorMessage = " Select at least one host to expand the Cluster";
            configValid = false;
        }
        else {
            configValid = _.every(selectedHosts, function (host) { return _this.validateHost(host); });
        }
        return configValid;
    };
    ClusterExpandController.prototype.addNewHost = function () {
        this.clusterHelper.addNewHost(this, this.serverService, this.timeoutService, this.requestService);
    };
    ClusterExpandController.prototype.postAddNewHost = function (host) {
        this.clusterHelper.acceptNewHost(this, host);
    };
    ClusterExpandController.prototype.isSubmitAvailable = function () {
        return true;
    };
    ClusterExpandController.prototype.cancel = function () {
        this.locationService.path('/clusters');
    };
    ClusterExpandController.prototype.submit = function () {
        var _this = this;
        if (this.validateHosts()) {
            var nodes = [];
            _.each(this.hosts, function (host) {
                if (host.selected) {
                    var localHost = {
                        nodeid: host.id,
                        nodetype: []
                    };
                    var disks = [];
                    if (_this.isOsd(host.hostType)) {
                        localHost.disks = _.map(host.disks, function (disk) {
                            return { name: disk.DevName, fstype: 'xfs' };
                        });
                        localHost.nodetype.push('OSD');
                    }
                    if (_this.isMon(host.hostType)) {
                        localHost.nodetype.push('MON');
                    }
                    nodes.push(localHost);
                }
            });
            this.expandCluster(this.clusterID, nodes);
        }
    };
    ClusterExpandController.prototype.expandCluster = function (clusterId, cluster) {
        var _this = this;
        this.clusterService.expand(clusterId, cluster).then(function (result) {
            if (result.status === 202) {
                _this.requestService.get(result.data.taskid).then(function (task) {
                    _this.requestTrackingService.add(task.id, task.name);
                });
                var modal = ModalHelpers.SuccessfulRequest(_this.modalService, {
                    title: 'Expand Cluster Request is Submitted',
                    container: '.usmClientApp'
                });
                modal.$scope.$hide = _.wrap(modal.$scope.$hide, function ($hide) {
                    $hide();
                    _this.locationService.path('/tasks/' + result.data.taskid);
                });
            }
            else {
                _this.logService.error('Unexpected response from Clusters.expand:', result);
            }
        });
    };
    ClusterExpandController.$inject = [
        '$q',
        '$log',
        '$scope',
        '$modal',
        '$timeout',
        '$location',
        '$routeParams',
        'OSDService',
        'UtilService',
        'ServerService',
        'ClusterService',
        'RequestService',
        'RequestTrackingService',
        'ConfigService'
    ];
    return ClusterExpandController;
})();
exports.ClusterExpandController = ClusterExpandController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvY2x1c3RlcnMvY2x1c3Rlci1leHBhbmQudHMiXSwibmFtZXMiOlsiQ2x1c3RlckV4cGFuZENvbnRyb2xsZXIiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5jb25zdHJ1Y3RvciIsIkNsdXN0ZXJFeHBhbmRDb250cm9sbGVyLmxvYWRDbHVzdGVyIiwiQ2x1c3RlckV4cGFuZENvbnRyb2xsZXIudXBkYXRlRmluZ2VyUHJpbnQiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci51cGRhdGVJUEFkZHJlc3MiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5mZXRjaEZyZWVIb3N0cyIsIkNsdXN0ZXJFeHBhbmRDb250cm9sbGVyLmxvYWRGcmVlSG9zdHMiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5zZWxlY3RBbGxIb3N0cyIsIkNsdXN0ZXJFeHBhbmRDb250cm9sbGVyLnNlbGVjdEhvc3QiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5pc01vbiIsIkNsdXN0ZXJFeHBhbmRDb250cm9sbGVyLmlzT3NkIiwiQ2x1c3RlckV4cGFuZENvbnRyb2xsZXIuZ2V0RGlza3MiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5nZXRIb3N0c0Rpc2tzU2l6ZSIsIkNsdXN0ZXJFeHBhbmRDb250cm9sbGVyLmdldERpc2tzU2l6ZSIsIkNsdXN0ZXJFeHBhbmRDb250cm9sbGVyLmNvdW50RGlza3MiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5ob3N0VHlwZUNoYW5nZWQiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci52YWxpZGF0ZUhvc3QiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci52YWxpZGF0ZUhvc3RzIiwiQ2x1c3RlckV4cGFuZENvbnRyb2xsZXIuYWRkTmV3SG9zdCIsIkNsdXN0ZXJFeHBhbmRDb250cm9sbGVyLnBvc3RBZGROZXdIb3N0IiwiQ2x1c3RlckV4cGFuZENvbnRyb2xsZXIuaXNTdWJtaXRBdmFpbGFibGUiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5jYW5jZWwiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5zdWJtaXQiLCJDbHVzdGVyRXhwYW5kQ29udHJvbGxlci5leHBhbmRDbHVzdGVyIl0sIm1hcHBpbmdzIjoiQUFBQSwyQ0FBMkM7QUFVM0MsZ0NBQTRCLG1CQUFtQixDQUFDLENBQUE7QUFFaEQsSUFBWSxZQUFZLFdBQU0sd0JBQXdCLENBQUMsQ0FBQTtBQUd2RDtJQThCSUEsaUNBQW9CQSxRQUFzQkEsRUFDOUJBLFVBQTBCQSxFQUMxQkEsWUFBdUJBLEVBQ3ZCQSxZQUFpQkEsRUFDakJBLGNBQWtDQSxFQUNsQ0EsZUFBb0NBLEVBQ3BDQSxjQUE0Q0EsRUFDNUNBLFVBQXNCQSxFQUN0QkEsV0FBd0JBLEVBQ3hCQSxhQUE0QkEsRUFDNUJBLGNBQThCQSxFQUM5QkEsY0FBOEJBLEVBQzlCQSxzQkFBOENBLEVBQzlDQSxTQUF3QkE7UUEzQ3hDQyxpQkErUkNBO1FBalF1QkEsYUFBUUEsR0FBUkEsUUFBUUEsQ0FBY0E7UUFDOUJBLGVBQVVBLEdBQVZBLFVBQVVBLENBQWdCQTtRQUMxQkEsaUJBQVlBLEdBQVpBLFlBQVlBLENBQVdBO1FBQ3ZCQSxpQkFBWUEsR0FBWkEsWUFBWUEsQ0FBS0E7UUFDakJBLG1CQUFjQSxHQUFkQSxjQUFjQSxDQUFvQkE7UUFDbENBLG9CQUFlQSxHQUFmQSxlQUFlQSxDQUFxQkE7UUFDcENBLG1CQUFjQSxHQUFkQSxjQUFjQSxDQUE4QkE7UUFDNUNBLGVBQVVBLEdBQVZBLFVBQVVBLENBQVlBO1FBQ3RCQSxnQkFBV0EsR0FBWEEsV0FBV0EsQ0FBYUE7UUFDeEJBLGtCQUFhQSxHQUFiQSxhQUFhQSxDQUFlQTtRQUM1QkEsbUJBQWNBLEdBQWRBLGNBQWNBLENBQWdCQTtRQUM5QkEsbUJBQWNBLEdBQWRBLGNBQWNBLENBQWdCQTtRQUM5QkEsMkJBQXNCQSxHQUF0QkEsc0JBQXNCQSxDQUF3QkE7UUFDOUNBLGNBQVNBLEdBQVRBLFNBQVNBLENBQWVBO1FBL0I1QkEscUJBQWdCQSxHQUFZQSxLQUFLQSxDQUFDQTtRQWlD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LEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLEVBQUVBLFVBQUNBLEtBQUtBO29CQUNsREEsS0FBS0EsRUFBRUEsQ0FBQ0E7b0JBQ1JBLEtBQUlBLENBQUNBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO2dCQUM5REEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDUEEsQ0FBQ0E7WUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ0ZBLEtBQUlBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLDJDQUEyQ0EsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDL0VBLENBQUNBO1FBQ0xBLENBQUNBLENBQUNBLENBQUNBO0lBQ1BBLENBQUNBO0lBalJNdkIsK0JBQU9BLEdBQWtCQTtRQUM1QkEsSUFBSUE7UUFDSkEsTUFBTUE7UUFDTkEsUUFBUUE7UUFDUkEsUUFBUUE7UUFDUkEsVUFBVUE7UUFDVkEsV0FBV0E7UUFDWEEsY0FBY0E7UUFDZEEsWUFBWUE7UUFDWkEsYUFBYUE7UUFDYkEsZUFBZUE7UUFDZkEsZ0JBQWdCQTtRQUNoQkEsZ0JBQWdCQTtRQUNoQkEsd0JBQXdCQTtRQUN4QkEsZUFBZUE7S0FDbEJBLENBQUNBO0lBbVFOQSw4QkFBQ0E7QUFBREEsQ0EvUkEsQUErUkNBLElBQUE7QUEvUlksK0JBQXVCLDBCQStSbkMsQ0FBQSIsImZpbGUiOiJtb2R1bGVzL2NsdXN0ZXJzL2NsdXN0ZXItZXhwYW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy90c2QuZC50c1wiIC8+XG5cbmltcG9ydCB7T1NEU2VydmljZX0gZnJvbSAnLi4vcmVzdC9vc2QnO1xuaW1wb3J0IHtQb29sU2VydmljZX0gZnJvbSAnLi4vcmVzdC9wb29sJztcbmltcG9ydCB7VXRpbFNlcnZpY2V9IGZyb20gJy4uL3Jlc3QvdXRpbCc7XG5pbXBvcnQge1ZvbHVtZVNlcnZpY2V9IGZyb20gJy4uL3Jlc3Qvdm9sdW1lJztcbmltcG9ydCB7U2VydmVyU2VydmljZX0gZnJvbSAnLi4vcmVzdC9zZXJ2ZXInO1xuaW1wb3J0IHtDbHVzdGVyU2VydmljZX0gZnJvbSAnLi4vcmVzdC9jbHVzdGVycyc7XG5pbXBvcnQge1JlcXVlc3RTZXJ2aWNlfSBmcm9tICcuLi9yZXN0L3JlcXVlc3QnO1xuaW1wb3J0IHtDb25maWdTZXJ2aWNlfSBmcm9tICcuLi9yZXN0L2NvbmZpZyc7XG5pbXBvcnQge0NsdXN0ZXJIZWxwZXJ9IGZyb20gJy4vY2x1c3Rlci1oZWxwZXJzJztcbmltcG9ydCB7UmVxdWVzdFRyYWNraW5nU2VydmljZX0gZnJvbSAnLi4vcmVxdWVzdHMvcmVxdWVzdC10cmFja2luZy1zdmMnO1xuaW1wb3J0ICogYXMgTW9kYWxIZWxwZXJzIGZyb20gJy4uL21vZGFsL21vZGFsLWhlbHBlcnMnO1xuaW1wb3J0IHtudW1lcmFsfSBmcm9tICcuLi9iYXNlL2xpYnMnO1xuXG5leHBvcnQgY2xhc3MgQ2x1c3RlckV4cGFuZENvbnRyb2xsZXIge1xuICAgIHByaXZhdGUgbmFtZTogYW55O1xuICAgIHByaXZhdGUgY2x1c3RlclR5cGU6IGFueTtcbiAgICBwcml2YXRlIGNsdXN0ZXI6IGFueTtcbiAgICBwcml2YXRlIG5ld0hvc3Q6IGFueTtcbiAgICBwcml2YXRlIGNsdXN0ZXJJRDogc3RyaW5nO1xuICAgIHByaXZhdGUgaG9zdHM6IEFycmF5PGFueT47XG4gICAgcHJpdmF0ZSBkaXNrczogQXJyYXk8YW55PjtcbiAgICBwcml2YXRlIGNsdXN0ZXJIZWxwZXI6IENsdXN0ZXJIZWxwZXI7XG4gICAgcHJpdmF0ZSBob3N0VHlwZXM6IEFycmF5PHN0cmluZz47XG4gICAgcHJpdmF0ZSBlcnJvck1lc3NhZ2U6IHN0cmluZztcbiAgICBwcml2YXRlIHNlbGVjdGVkSG9zdHM6IG51bWJlcjtcbiAgICBwcml2YXRlIGNlcGhNaXhIb3N0Um9sZXM6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBzdGF0aWMgJGluamVjdDogQXJyYXk8c3RyaW5nPiA9IFtcbiAgICAgICAgJyRxJyxcbiAgICAgICAgJyRsb2cnLFxuICAgICAgICAnJHNjb3BlJyxcbiAgICAgICAgJyRtb2RhbCcsXG4gICAgICAgICckdGltZW91dCcsXG4gICAgICAgICckbG9jYXRpb24nLFxuICAgICAgICAnJHJvdXRlUGFyYW1zJyxcbiAgICAgICAgJ09TRFNlcnZpY2UnLFxuICAgICAgICAnVXRpbFNlcnZpY2UnLFxuICAgICAgICAnU2VydmVyU2VydmljZScsXG4gICAgICAgICdDbHVzdGVyU2VydmljZScsXG4gICAgICAgICdSZXF1ZXN0U2VydmljZScsXG4gICAgICAgICdSZXF1ZXN0VHJhY2tpbmdTZXJ2aWNlJyxcbiAgICAgICAgJ0NvbmZpZ1NlcnZpY2UnXG4gICAgXTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcVNlcnZpY2U6IG5nLklRU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBsb2dTZXJ2aWNlOiBuZy5JTG9nU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBzY29wZVNlcnZpY2U6IG5nLklTY29wZSxcbiAgICAgICAgcHJpdmF0ZSBtb2RhbFNlcnZpY2U6IGFueSxcbiAgICAgICAgcHJpdmF0ZSB0aW1lb3V0U2VydmljZTogbmcuSVRpbWVvdXRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGxvY2F0aW9uU2VydmljZTogbmcuSUxvY2F0aW9uU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByb3V0ZVBhcmFtc1N2Yzogbmcucm91dGUuSVJvdXRlUGFyYW1zU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBvc2RTZXJ2aWNlOiBPU0RTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHV0aWxTZXJ2aWNlOiBVdGlsU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBzZXJ2ZXJTZXJ2aWNlOiBTZXJ2ZXJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGNsdXN0ZXJTZXJ2aWNlOiBDbHVzdGVyU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByZXF1ZXN0U2VydmljZTogUmVxdWVzdFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgcmVxdWVzdFRyYWNraW5nU2VydmljZTogUmVxdWVzdFRyYWNraW5nU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBjb25maWdTdmM6IENvbmZpZ1NlcnZpY2UpIHtcblxuICAgICAgICB0aGlzLm5ld0hvc3QgPSB7fTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEhvc3RzID0gMDtcbiAgICAgICAgdGhpcy5ob3N0cyA9IFtdO1xuICAgICAgICB0aGlzLmRpc2tzID0gW107XG4gICAgICAgIHRoaXMuY2x1c3RlckhlbHBlciA9IG5ldyBDbHVzdGVySGVscGVyKHV0aWxTZXJ2aWNlLCByZXF1ZXN0U2VydmljZSwgbG9nU2VydmljZSwgdGltZW91dFNlcnZpY2UpO1xuICAgICAgICB0aGlzLmNsdXN0ZXJJRCA9IHRoaXMucm91dGVQYXJhbXNTdmNbJ2lkJ107XG4gICAgICAgIHRoaXMuaG9zdFR5cGVzID0gW1wiTW9uaXRvclwiLCBcIk9TRCBIb3N0XCIsIFwiT1NEICsgTW9uaXRvclwiXTtcbiAgICAgICAgdGhpcy5jb25maWdTdmMuZ2V0Q29uZmlnKCkudGhlbigoY29uZmlnKSA9PiB7XG4gICAgICAgICAgICBpZiAoY29uZmlnLmNlcGhfbWl4X2hvc3Rfcm9sZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNlcGhNaXhIb3N0Um9sZXMgPSBjb25maWcuY2VwaF9taXhfaG9zdF9yb2xlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2x1c3RlclNlcnZpY2UuZ2V0KHRoaXMuY2x1c3RlcklEKS50aGVuKChjbHVzdGVyKSA9PiB0aGlzLmxvYWRDbHVzdGVyKGNsdXN0ZXIpKTtcbiAgICAgICAgdmFyIHF1ZXJ5UGFyYW1zID0gbG9jYXRpb25TZXJ2aWNlLnNlYXJjaCgpO1xuICAgICAgICBpZiAoT2JqZWN0LmtleXMocXVlcnlQYXJhbXMpLmxlbmd0aCA+IDAgJiYgcXVlcnlQYXJhbXNbJ2hvc3RzYWNjZXB0ZWQnXSA9PT0gXCJ0cnVlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hGcmVlSG9zdHMoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyU2VydmljZS5nZXREaXNjb3ZlcmVkSG9zdHMoKS50aGVuKGZyZWVIb3N0cyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZyZWVIb3N0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RhbCA9IE1vZGFsSGVscGVycy5VbkFjY2VwdGVkSG9zdHNGb3VuZCh0aGlzLm1vZGFsU2VydmljZSwge30sIGZyZWVIb3N0cy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC4kc2NvcGUuJGhpZGUgPSBfLndyYXAobW9kYWwuJHNjb3BlLiRoaWRlLCAoJGhpZGUsIGNvbmZpcm1lZDogYm9vbGVhbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRpb25TZXJ2aWNlLnBhdGgoJy9jbHVzdGVycy9uZXcvYWNjZXB0LWhvc3RzJykuc2VhcmNoKCdleHBhbmRjbHVzdGVyJyx0aGlzLmNsdXN0ZXJJRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAkaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mZXRjaEZyZWVIb3N0cygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hGcmVlSG9zdHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBsb2FkQ2x1c3RlcihjbHVzdGVyOiBhbnkpIHtcbiAgICAgICAgdGhpcy5jbHVzdGVyID0gY2x1c3RlcjtcbiAgICAgICAgdGhpcy5uYW1lID0gY2x1c3Rlci5uYW1lO1xuICAgICAgICB0aGlzLmNsdXN0ZXJUeXBlID0gdGhpcy5jbHVzdGVySGVscGVyLmdldENsdXN0ZXJUeXBlKGNsdXN0ZXIuY2x1c3Rlcl90eXBlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXBkYXRlRmluZ2VyUHJpbnQoaG9zdDogYW55KSB7XG4gICAgICAgIHRoaXMubmV3SG9zdC5jYXV0aW9uTWVzc2FnZSA9IFwiXCI7XG4gICAgICAgIHRoaXMubmV3SG9zdC5lcnJvck1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICB0aGlzLnV0aWxTZXJ2aWNlLmdldFNzaEZpbmdlcnByaW50KGhvc3QuaG9zdG5hbWUpLnRoZW4oXG4gICAgICAgICAgICAoc3NoZmluZ2VycHJpbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGhvc3Quc3NoZmluZ2VycHJpbnQgPSBzc2hmaW5nZXJwcmludDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXdIb3N0LmNhdXRpb25NZXNzYWdlID0gXCJFcnJvciEuXCI7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXdIb3N0LmVycm9yTWVzc2FnZSA9IFwiQ291bGQgbm90IGZldGNoIHNzaCBmaW5nZXJwcmludFwiO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZUlQQWRkcmVzcyhob3N0OiBhbnkpIHtcbiAgICAgICAgdGhpcy51dGlsU2VydmljZS5nZXRJcEFkZHJlc3Nlcyhob3N0Lmhvc3RuYW1lKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGhvc3QuaXBhZGRyZXNzID0gcmVzdWx0Lmxlbmd0aCA+IDAgPyByZXN1bHRbMF0gOiBcIk4vQVwiO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZmV0Y2hGcmVlSG9zdHMoKSB7XG4gICAgICAgIHRoaXMuc2VydmVyU2VydmljZS5nZXRGcmVlSG9zdHMoKS50aGVuKChmcmVlSG9zdHMpID0+IHRoaXMubG9hZEZyZWVIb3N0cyhmcmVlSG9zdHMpKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbG9hZEZyZWVIb3N0cyhmcmVlSG9zdHM6IGFueSkge1xuICAgICAgICB0aGlzLmhvc3RzID0gW107XG4gICAgICAgIF8uZWFjaChmcmVlSG9zdHMsIChmcmVlSG9zdDogYW55KSA9PiB7XG4gICAgICAgICAgICB2YXIgaG9zdCA9IHtcbiAgICAgICAgICAgICAgICBpZDogZnJlZUhvc3Qubm9kZWlkLFxuICAgICAgICAgICAgICAgIGhvc3RuYW1lOiBmcmVlSG9zdC5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICBpcGFkZHJlc3M6IGZyZWVIb3N0Lm1hbmFnZW1lbnRfaXA0LFxuICAgICAgICAgICAgICAgIHN0YXRlOiBcIkFDQ0VQVEVEXCIsXG4gICAgICAgICAgICAgICAgZGlza3M6IGZyZWVIb3N0LnN0b3JhZ2VfZGlza3MsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGhvc3QuZGlza3MgPSBfLmZpbHRlcihmcmVlSG9zdC5zdG9yYWdlX2Rpc2tzLCAoZGlzazogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRpc2suVHlwZSA9PT0gJ2Rpc2snICYmIGRpc2suVXNlZCA9PT0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuaG9zdHMucHVzaChob3N0KTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRmluZ2VyUHJpbnQoaG9zdCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZWxlY3RBbGxIb3N0cygpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEhvc3RzID0gMDtcbiAgICAgICAgXy5lYWNoKHRoaXMuaG9zdHMsIChob3N0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdEhvc3QoaG9zdCwgdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZWxlY3RIb3N0KGhvc3Q6IGFueSwgc2VsZWN0aW9uOiBib29sZWFuKSB7XG4gICAgICAgIGhvc3Quc2VsZWN0ZWQgPSBzZWxlY3Rpb247XG4gICAgICAgIGlmIChzZWxlY3Rpb24gJiYgaG9zdC5ob3N0VHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoaG9zdC5kaXNrcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBob3N0Lmhvc3RUeXBlID0gdGhpcy5ob3N0VHlwZXNbMF07ICAvL05vIERpc2sgYXZhaWxhYmxlIHNvIG1ha2UgdGhpcyBhIE1vblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBob3N0Lmhvc3RUeXBlID0gdGhpcy5ob3N0VHlwZXNbMV07ICAvL1RoZXJlIGFyZSBzb21lIGRpc2tzIHNvIGl0IGNhbiBiZSBhbiBPU0RcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGhvc3Quc2VsZWN0ZWQgPyB0aGlzLnNlbGVjdGVkSG9zdHMrKyA6IHRoaXMuc2VsZWN0ZWRIb3N0cy0tO1xuICAgICAgICB0aGlzLmNvdW50RGlza3MoKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUhvc3QoaG9zdCk7XG4gICAgfVxuXG4gICAgcHVibGljIGlzTW9uKGhvc3RUeXBlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGhvc3RUeXBlID09PSB0aGlzLmhvc3RUeXBlc1swXSB8fCBob3N0VHlwZSA9PT0gdGhpcy5ob3N0VHlwZXNbMl07XG4gICAgfVxuXG4gICAgcHVibGljIGlzT3NkKGhvc3RUeXBlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGhvc3RUeXBlID09PSB0aGlzLmhvc3RUeXBlc1sxXSB8fCBob3N0VHlwZSA9PT0gdGhpcy5ob3N0VHlwZXNbMl07XG4gICAgfVxuXG4gICAgcHVibGljIGdldERpc2tzKCk6IGFueSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc2tzO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRIb3N0c0Rpc2tzU2l6ZShob3N0OiBhbnkpOiBudW1iZXIge1xuICAgICAgICB2YXIgc2l6ZTogbnVtYmVyID0gMDtcbiAgICAgICAgc2l6ZSA9IF8ucmVkdWNlKGhvc3QuZGlza3MsIChzaXplOiBhbnksIGRpc2s6IGFueSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHNpemUgKyBkaXNrLlNpemU7XG4gICAgICAgIH0sIDApO1xuICAgICAgICByZXR1cm4gc2l6ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0RGlza3NTaXplKCk6IGFueSB7XG4gICAgICAgIHZhciBzaXplOiBudW1iZXIgPSAwO1xuICAgICAgICBzaXplID0gXy5yZWR1Y2UodGhpcy5kaXNrcywgKHNpemU6IGFueSwgZGlzazogYW55KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gc2l6ZSArIGRpc2suU2l6ZTtcbiAgICAgICAgfSwgMCk7XG4gICAgICAgIHJldHVybiBzaXplO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb3VudERpc2tzKCkge1xuICAgICAgICB2YXIgZGlza3M6IEFycmF5PGFueT4gPSBbXTtcbiAgICAgICAgXy5lYWNoKHRoaXMuaG9zdHMsIChob3N0KSA9PiB7XG4gICAgICAgICAgICBpZiAoaG9zdC5zZWxlY3RlZCAmJiB0aGlzLmlzT3NkKGhvc3QuaG9zdFR5cGUpKSB7XG4gICAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoZGlza3MsIGhvc3QuZGlza3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5kaXNrcyA9IGRpc2tzO1xuICAgIH1cblxuICAgIHB1YmxpYyBob3N0VHlwZUNoYW5nZWQoaG9zdDogYW55KSB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVIb3N0KGhvc3QpO1xuICAgICAgICB0aGlzLmNvdW50RGlza3MoKVxuICAgIH1cblxuICAgIHB1YmxpYyB2YWxpZGF0ZUhvc3QoaG9zdDogYW55KTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChob3N0LnNlbGVjdGVkKSB7XG4gICAgICAgICAgICBpZiAoaG9zdC5ob3N0VHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBcIkhvc3QgJ1wiICsgaG9zdC5ob3N0bmFtZSArIFwiJyBkb2VzIG5vdCBoYXZlIGFueSByb2xlIGF0dGFjaGVkLlwiO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaXNPc2QoaG9zdC5ob3N0VHlwZSkgJiYgaG9zdC5kaXNrcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycm9yTWVzc2FnZSA9IFwiSG9zdCAnXCIgKyBob3N0Lmhvc3RuYW1lICsgXCInIGRvZXMgbm90IGhhdmUgYW55IGRpc2sgYXR0YWNoZWQgYW5kIGl0IGNhbid0IGJlIGFkZGVkIGFzIGFuIE9TRCBIb3N0LlwiO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gXCJcIjtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHVibGljIHZhbGlkYXRlSG9zdHMoKTogYm9vbGVhbiB7XG4gICAgICAgIHRoaXMubmV3SG9zdC5lcnJvck1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICB2YXIgY29uZmlnVmFsaWQgPSB0cnVlO1xuICAgICAgICB2YXIgc2VsZWN0ZWRIb3N0cyA9IF8uZmlsdGVyKHRoaXMuaG9zdHMsIGhvc3QgPT4gaG9zdC5zZWxlY3RlZCk7XG4gICAgICAgIGlmIChzZWxlY3RlZEhvc3RzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5lcnJvck1lc3NhZ2UgPSBcIiBTZWxlY3QgYXQgbGVhc3Qgb25lIGhvc3QgdG8gZXhwYW5kIHRoZSBDbHVzdGVyXCI7XG4gICAgICAgICAgICBjb25maWdWYWxpZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uZmlnVmFsaWQgPSBfLmV2ZXJ5KHNlbGVjdGVkSG9zdHMsIGhvc3QgPT4gdGhpcy52YWxpZGF0ZUhvc3QoaG9zdCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvbmZpZ1ZhbGlkO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGROZXdIb3N0KCkge1xuICAgICAgICB0aGlzLmNsdXN0ZXJIZWxwZXIuYWRkTmV3SG9zdCh0aGlzLCB0aGlzLnNlcnZlclNlcnZpY2UsIHRoaXMudGltZW91dFNlcnZpY2UsIHRoaXMucmVxdWVzdFNlcnZpY2UpO1xuICAgIH1cblxuICAgIHB1YmxpYyBwb3N0QWRkTmV3SG9zdChob3N0OiBhbnkpIHtcbiAgICAgICAgdGhpcy5jbHVzdGVySGVscGVyLmFjY2VwdE5ld0hvc3QodGhpcywgaG9zdCk7XG4gICAgfVxuXG4gICAgcHVibGljIGlzU3VibWl0QXZhaWxhYmxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2FuY2VsKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmxvY2F0aW9uU2VydmljZS5wYXRoKCcvY2x1c3RlcnMnKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3VibWl0KCkge1xuICAgICAgICBpZiAodGhpcy52YWxpZGF0ZUhvc3RzKCkpIHtcbiAgICAgICAgICAgIHZhciBub2RlczogQXJyYXk8YW55PiA9IFtdO1xuICAgICAgICAgICAgXy5lYWNoKHRoaXMuaG9zdHMsIChob3N0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaG9zdC5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxIb3N0OiBhbnkgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlaWQ6IGhvc3QuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBub2RldHlwZTogW11cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpc2tzID0gW107XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3NkKGhvc3QuaG9zdFR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbEhvc3QuZGlza3MgPSBfLm1hcChob3N0LmRpc2tzLCAoZGlzazogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgbmFtZTogZGlzay5EZXZOYW1lLCBmc3R5cGU6ICd4ZnMnIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsSG9zdC5ub2RldHlwZS5wdXNoKCdPU0QnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01vbihob3N0Lmhvc3RUeXBlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxIb3N0Lm5vZGV0eXBlLnB1c2goJ01PTicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG5vZGVzLnB1c2gobG9jYWxIb3N0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZXhwYW5kQ2x1c3Rlcih0aGlzLmNsdXN0ZXJJRCwgbm9kZXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGV4cGFuZENsdXN0ZXIoY2x1c3RlcklkOiBzdHJpbmcsIGNsdXN0ZXIpIHtcbiAgICAgICAgdGhpcy5jbHVzdGVyU2VydmljZS5leHBhbmQoY2x1c3RlcklkLCBjbHVzdGVyKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSAyMDIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RTZXJ2aWNlLmdldChyZXN1bHQuZGF0YS50YXNraWQpLnRoZW4oKHRhc2spID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0VHJhY2tpbmdTZXJ2aWNlLmFkZCh0YXNrLmlkLCB0YXNrLm5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBtb2RhbCA9IE1vZGFsSGVscGVycy5TdWNjZXNzZnVsUmVxdWVzdCh0aGlzLm1vZGFsU2VydmljZSwge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0V4cGFuZCBDbHVzdGVyIFJlcXVlc3QgaXMgU3VibWl0dGVkJyxcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiAnLnVzbUNsaWVudEFwcCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBtb2RhbC4kc2NvcGUuJGhpZGUgPSBfLndyYXAobW9kYWwuJHNjb3BlLiRoaWRlLCAoJGhpZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgJGhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdGlvblNlcnZpY2UucGF0aCgnL3Rhc2tzLycgKyByZXN1bHQuZGF0YS50YXNraWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKCdVbmV4cGVjdGVkIHJlc3BvbnNlIGZyb20gQ2x1c3RlcnMuZXhwYW5kOicsIHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==
