// <reference path="../../../typings/tsd.d.ts" />
var EventListController = (function () {
    function EventListController($scope, $interval, $location, modalSvc, eventSvc) {
        var _this = this;
        this.$scope = $scope;
        this.$interval = $interval;
        this.$location = $location;
        this.modalSvc = modalSvc;
        this.eventSvc = eventSvc;
        this.pageNo = 1;
        this.pageSize = 10;
        this.totalPages = 1;
        this.totalCount = 0;
        this.filterObject = {};
        this.requestObject = {};
        this.searchEntity = "Description";
        this.warningCount = 0;
        this.criticalCount = 0;
        this.errorMessage = "";
        this.severityLevel = [];
        this.statusFilter = "active";
        this.alarmStatus = ["indeterminate",
            "critical",
            "major",
            "minor",
            "warning",
            "info"];
        this.criticalEvents = [this.alarmStatus[1], this.alarmStatus[2]];
        this.warningEvents = [this.alarmStatus[0], this.alarmStatus[3], this.alarmStatus[4]];
        var queryParams = $location.search();
        if (Object.keys(queryParams).length > 0) {
            if (queryParams['searchmessage'] !== undefined) {
                this.searchQuery = queryParams['searchmessage'];
                this.searchEntity = "description";
            }
            else if (queryParams['nodename'] !== undefined) {
                this.searchQuery = queryParams['nodename'];
                this.searchEntity = "host";
            }
            else if (queryParams['clustername'] !== undefined) {
                this.searchQuery = queryParams['clustername'];
                this.searchEntity = "cluster";
            }
            this.applyFilter(this.searchEntity, this.searchQuery);
            this.applyFilter('severity', 'critical & warning');
            this.severity = 'notok';
        }
        this.timer = this.$interval(function () { return _this.refresh(); }, 5000);
        this.$scope.$on('$destroy', function () {
            _this.$interval.cancel(_this.timer);
        });
        this.filterObject['status'] = this.statusFilter;
        this.refresh();
    }
    EventListController.prototype.refresh = function () {
        var _this = this;
        if (this.severity === 'critical') {
            this.severityLevel = this.criticalEvents;
        }
        else if (this.severity === 'warning') {
            this.severityLevel = this.warningEvents;
        }
        else if (this.severity === 'notok') {
            this.severityLevel = this.criticalEvents;
            this.severityLevel = this.severityLevel.concat(this.warningEvents);
        }
        else {
            this.severityLevel = [];
        }
        this.requestObject = {
            pageno: this.pageNo,
            pagesize: this.pageSize,
            fromdatetime: this.fromDateTimeFilter,
            todatetime: this.toDateTimeFilter,
            severity: this.severityLevel
        };
        if (this.searchEntity.toLowerCase() === 'cluster') {
            this.requestObject['clustername'] = this.searchQuery;
        }
        else if (this.searchEntity.toLowerCase() === 'host') {
            this.requestObject['nodename'] = this.searchQuery;
        }
        else if (this.searchEntity.toLowerCase() === 'description') {
            this.requestObject['searchmessage'] = this.searchQuery;
        }
        if (this.statusFilter === "active") {
            this.requestObject['acked'] = false;
        }
        if (this.statusFilter === "dismissed") {
            this.requestObject['acked'] = true;
        }
        if (this.statusFilter === "both") {
            delete this.requestObject['acked'];
        }
        this.eventSvc.getList(this.requestObject).then(function (data) {
            _this.totalCount = data.totalcount;
            _this.totalPages = Math.ceil(data.totalcount / _this.pageSize);
            _this.list = data.events;
        });
        this.requestObject['pageno'] = 1;
        this.requestObject['severity'] = this.criticalEvents;
        this.eventSvc.getList(this.requestObject).then(function (data) {
            _this.criticalCount = data.totalcount;
        });
        this.requestObject['severity'] = this.warningEvents;
        this.eventSvc.getList(this.requestObject).then(function (data) {
            _this.warningCount = data.totalcount;
        });
    };
    EventListController.prototype.paginate = function (pageNo) {
        if (pageNo < 1 || pageNo > this.totalPages)
            return;
        this.pageNo = pageNo;
        this.refresh();
    };
    EventListController.prototype.viewDetails = function (eventId) {
        this.$location.path('/events/' + eventId);
    };
    EventListController.prototype.resetFilters = function () {
        this.filterObject = {};
        this.fromDateTimeFilter = undefined;
        this.toDateTimeFilter = undefined;
        this.searchQuery = undefined;
        this.severity = undefined;
        this.statusFilter = "active";
        this.filterObject['status'] = this.statusFilter;
    };
    EventListController.prototype.applyFilter = function (key, value) {
        if (value.length === 0) {
            delete this.filterObject[key];
        }
        else {
            this.filterObject[key] = value;
        }
        this.refresh();
    };
    EventListController.prototype.clearFilter = function (key) {
        delete this.filterObject[key];
        this.fromDateTimeFilter = this.filterObject["from"];
        this.toDateTimeFilter = this.filterObject["to"];
        this.searchQuery = this.filterObject[this.searchEntity];
        this.severity = this.filterObject["severity"];
    };
    EventListController.prototype.setSearchEntity = function (entity) {
        this.searchQuery = "";
        this.searchEntity = entity;
        delete this.filterObject['cluster'];
        delete this.filterObject['host'];
        delete this.filterObject['description'];
    };
    EventListController.prototype.dismiss = function (eventId) {
        var modalInstance = this.modalSvc({
            templateUrl: 'views/events/event-dismiss.tpl.html',
            controllerAs: 'event',
            controller: ['EventService', 'growl', function (eventSvc, growl) {
                    this.dismissMessage = "";
                    this.errorMessage = "";
                    this.dismiss = function () {
                        var _this = this;
                        eventSvc.dismiss(eventId, this.dismissMessage).then(function (status) {
                            modalInstance.$scope.$hide();
                            growl.success("Event Dismissed");
                        }).catch(function (status) {
                            _this.errorMessage = status.data;
                            growl.error(status.data);
                        });
                    };
                }]
        });
    };
    EventListController.$inject = [
        '$scope',
        '$interval',
        '$location',
        '$modal',
        'EventService'
    ];
    return EventListController;
})();
exports.EventListController = EventListController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvZXZlbnRzL2V2ZW50LWxpc3QudHMiXSwibmFtZXMiOlsiRXZlbnRMaXN0Q29udHJvbGxlciIsIkV2ZW50TGlzdENvbnRyb2xsZXIuY29uc3RydWN0b3IiLCJFdmVudExpc3RDb250cm9sbGVyLnJlZnJlc2giLCJFdmVudExpc3RDb250cm9sbGVyLnBhZ2luYXRlIiwiRXZlbnRMaXN0Q29udHJvbGxlci52aWV3RGV0YWlscyIsIkV2ZW50TGlzdENvbnRyb2xsZXIucmVzZXRGaWx0ZXJzIiwiRXZlbnRMaXN0Q29udHJvbGxlci5hcHBseUZpbHRlciIsIkV2ZW50TGlzdENvbnRyb2xsZXIuY2xlYXJGaWx0ZXIiLCJFdmVudExpc3RDb250cm9sbGVyLnNldFNlYXJjaEVudGl0eSIsIkV2ZW50TGlzdENvbnRyb2xsZXIuZGlzbWlzcyJdLCJtYXBwaW5ncyI6IkFBQUEsaURBQWlEO0FBS2pEO0lBa0NJQSw2QkFDWUEsTUFBaUJBLEVBQ2pCQSxTQUE4QkEsRUFDOUJBLFNBQThCQSxFQUM5QkEsUUFBUUEsRUFDUkEsUUFBc0JBO1FBdkN0Q0MsaUJBMExDQTtRQXZKZUEsV0FBTUEsR0FBTkEsTUFBTUEsQ0FBV0E7UUFDakJBLGNBQVNBLEdBQVRBLFNBQVNBLENBQXFCQTtRQUM5QkEsY0FBU0EsR0FBVEEsU0FBU0EsQ0FBcUJBO1FBQzlCQSxhQUFRQSxHQUFSQSxRQUFRQSxDQUFBQTtRQUNSQSxhQUFRQSxHQUFSQSxRQUFRQSxDQUFjQTtRQXBDMUJBLFdBQU1BLEdBQVdBLENBQUNBLENBQUNBO1FBQ25CQSxhQUFRQSxHQUFXQSxFQUFFQSxDQUFDQTtRQUN0QkEsZUFBVUEsR0FBV0EsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLGVBQVVBLEdBQVdBLENBQUNBLENBQUNBO1FBR3ZCQSxpQkFBWUEsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDbEJBLGtCQUFhQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUVuQkEsaUJBQVlBLEdBQVdBLGFBQWFBLENBQUNBO1FBQ3JDQSxpQkFBWUEs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LEdBQUdBLElBQUlBLENBQUNBO1FBQ3ZDQSxDQUFDQTtRQUNEQSxFQUFFQSxDQUFBQSxDQUFDQSxJQUFJQSxDQUFDQSxZQUFZQSxLQUFLQSxNQUFNQSxDQUFDQSxDQUFBQSxDQUFDQTtZQUM3QkEsT0FBT0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFDdkNBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQUNBLElBQVNBO1lBQ3JEQSxLQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQTtZQUNsQ0EsS0FBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsS0FBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7WUFDN0RBLEtBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1FBQzVCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNIQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxRQUFRQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUNqQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0E7UUFDckRBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQUNBLElBQVNBO1lBQ3JEQSxLQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUN6Q0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDSEEsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0E7UUFDcERB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QVdBO1FBQ1hBLFFBQVFBO1FBQ1JBLGNBQWNBO0tBQ2pCQSxDQUFDQTtJQXlKTkEsMEJBQUNBO0FBQURBLENBMUxBLEFBMExDQSxJQUFBO0FBMUxZLDJCQUFtQixzQkEwTC9CLENBQUEiLCJmaWxlIjoibW9kdWxlcy9ldmVudHMvZXZlbnQtbGlzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uL3R5cGluZ3MvdHNkLmQudHNcIiAvPlxuXG5pbXBvcnQge1V0aWxTZXJ2aWNlfSBmcm9tICcuLi9yZXN0L3V0aWwnO1xuaW1wb3J0IHtFdmVudFNlcnZpY2V9IGZyb20gJy4uL3Jlc3QvZXZlbnRzJztcblxuZXhwb3J0IGNsYXNzIEV2ZW50TGlzdENvbnRyb2xsZXIge1xuICAgIHByaXZhdGUgbGlzdDogQXJyYXk8YW55PjtcbiAgICBwcml2YXRlIHRpbWVyO1xuICAgIHByaXZhdGUgcGFnZU5vOiBudW1iZXIgPSAxO1xuICAgIHByaXZhdGUgcGFnZVNpemU6IG51bWJlciA9IDEwO1xuICAgIHByaXZhdGUgdG90YWxQYWdlczogbnVtYmVyID0gMTtcbiAgICBwcml2YXRlIHRvdGFsQ291bnQ6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBmcm9tRGF0ZVRpbWVGaWx0ZXI6IHN0cmluZztcbiAgICBwcml2YXRlIHRvRGF0ZVRpbWVGaWx0ZXI6IHN0cmluZztcbiAgICBwcml2YXRlIGZpbHRlck9iamVjdCA9IHt9O1xuICAgIHByaXZhdGUgcmVxdWVzdE9iamVjdCA9IHt9O1xuICAgIHByaXZhdGUgc2VhcmNoUXVlcnk6IHN0cmluZztcbiAgICBwcml2YXRlIHNlYXJjaEVudGl0eTogc3RyaW5nID0gXCJEZXNjcmlwdGlvblwiO1xuICAgIHByaXZhdGUgd2FybmluZ0NvdW50OiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgY3JpdGljYWxDb3VudDogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIGVycm9yTWVzc2FnZTogc3RyaW5nID0gXCJcIjtcbiAgICBwcml2YXRlIHNldmVyaXR5OiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBzZXZlcml0eUxldmVsID0gW107XG4gICAgcHJpdmF0ZSBzdGF0dXNGaWx0ZXI6IHN0cmluZyA9IFwiYWN0aXZlXCI7XG4gICAgcHJpdmF0ZSBhbGFybVN0YXR1cyA9IFtcImluZGV0ZXJtaW5hdGVcIixcbiAgICAgICAgXCJjcml0aWNhbFwiLFxuICAgICAgICBcIm1ham9yXCIsXG4gICAgICAgIFwibWlub3JcIixcbiAgICAgICAgXCJ3YXJuaW5nXCIsXG4gICAgICAgIFwiaW5mb1wiXTtcbiAgICBwcml2YXRlIGNyaXRpY2FsRXZlbnRzID0gW3RoaXMuYWxhcm1TdGF0dXNbMV0sIHRoaXMuYWxhcm1TdGF0dXNbMl1dO1xuICAgIHByaXZhdGUgd2FybmluZ0V2ZW50cyA9IFt0aGlzLmFsYXJtU3RhdHVzWzBdLCB0aGlzLmFsYXJtU3RhdHVzWzNdLCB0aGlzLmFsYXJtU3RhdHVzWzRdXTtcbiAgICBzdGF0aWMgJGluamVjdDogQXJyYXk8c3RyaW5nPiA9IFtcbiAgICAgICAgJyRzY29wZScsXG4gICAgICAgICckaW50ZXJ2YWwnLFxuICAgICAgICAnJGxvY2F0aW9uJyxcbiAgICAgICAgJyRtb2RhbCcsXG4gICAgICAgICdFdmVudFNlcnZpY2UnXG4gICAgXTtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSAkc2NvcGU6IG5nLklTY29wZSxcbiAgICAgICAgcHJpdmF0ZSAkaW50ZXJ2YWw6IG5nLklJbnRlcnZhbFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgJGxvY2F0aW9uOiBuZy5JTG9jYXRpb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIG1vZGFsU3ZjLFxuICAgICAgICBwcml2YXRlIGV2ZW50U3ZjOiBFdmVudFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHF1ZXJ5UGFyYW1zID0gJGxvY2F0aW9uLnNlYXJjaCgpO1xuICAgICAgICBpZiAoT2JqZWN0LmtleXMocXVlcnlQYXJhbXMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmIChxdWVyeVBhcmFtc1snc2VhcmNobWVzc2FnZSddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFF1ZXJ5ID0gcXVlcnlQYXJhbXNbJ3NlYXJjaG1lc3NhZ2UnXTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaEVudGl0eSA9IFwiZGVzY3JpcHRpb25cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHF1ZXJ5UGFyYW1zWydub2RlbmFtZSddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFF1ZXJ5ID0gcXVlcnlQYXJhbXNbJ25vZGVuYW1lJ107XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hFbnRpdHkgPSBcImhvc3RcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHF1ZXJ5UGFyYW1zWydjbHVzdGVybmFtZSddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFF1ZXJ5ID0gcXVlcnlQYXJhbXNbJ2NsdXN0ZXJuYW1lJ107XG4gICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hFbnRpdHkgPSBcImNsdXN0ZXJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKHRoaXMuc2VhcmNoRW50aXR5LCB0aGlzLnNlYXJjaFF1ZXJ5KTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5RmlsdGVyKCdzZXZlcml0eScsICdjcml0aWNhbCAmIHdhcm5pbmcnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldmVyaXR5ID0gJ25vdG9rJztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbWVyID0gdGhpcy4kaW50ZXJ2YWwoKCkgPT4gdGhpcy5yZWZyZXNoKCksIDUwMDApO1xuICAgICAgICB0aGlzLiRzY29wZS4kb24oJyRkZXN0cm95JywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy4kaW50ZXJ2YWwuY2FuY2VsKHRoaXMudGltZXIpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5maWx0ZXJPYmplY3RbJ3N0YXR1cyddID0gdGhpcy5zdGF0dXNGaWx0ZXI7XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZWZyZXNoKCkge1xuICAgICAgICBpZiAodGhpcy5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJykge1xuICAgICAgICAgICAgdGhpcy5zZXZlcml0eUxldmVsID0gdGhpcy5jcml0aWNhbEV2ZW50cztcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNldmVyaXR5ID09PSAnd2FybmluZycpIHtcbiAgICAgICAgICAgIHRoaXMuc2V2ZXJpdHlMZXZlbCA9IHRoaXMud2FybmluZ0V2ZW50cztcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNldmVyaXR5ID09PSAnbm90b2snKSB7XG4gICAgICAgICAgICB0aGlzLnNldmVyaXR5TGV2ZWwgPSB0aGlzLmNyaXRpY2FsRXZlbnRzO1xuICAgICAgICAgICAgdGhpcy5zZXZlcml0eUxldmVsID0gdGhpcy5zZXZlcml0eUxldmVsLmNvbmNhdCh0aGlzLndhcm5pbmdFdmVudHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXZlcml0eUxldmVsID0gW107XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlcXVlc3RPYmplY3QgPSB7XG4gICAgICAgICAgICBwYWdlbm86IHRoaXMucGFnZU5vLFxuICAgICAgICAgICAgcGFnZXNpemU6IHRoaXMucGFnZVNpemUsXG4gICAgICAgICAgICBmcm9tZGF0ZXRpbWU6IHRoaXMuZnJvbURhdGVUaW1lRmlsdGVyLFxuICAgICAgICAgICAgdG9kYXRldGltZTogdGhpcy50b0RhdGVUaW1lRmlsdGVyLFxuICAgICAgICAgICAgc2V2ZXJpdHk6IHRoaXMuc2V2ZXJpdHlMZXZlbFxuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5zZWFyY2hFbnRpdHkudG9Mb3dlckNhc2UoKSA9PT0gJ2NsdXN0ZXInKSB7XG4gICAgICAgICAgICB0aGlzLnJlcXVlc3RPYmplY3RbJ2NsdXN0ZXJuYW1lJ10gPSB0aGlzLnNlYXJjaFF1ZXJ5O1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc2VhcmNoRW50aXR5LnRvTG93ZXJDYXNlKCkgPT09ICdob3N0Jykge1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0T2JqZWN0Wydub2RlbmFtZSddID0gdGhpcy5zZWFyY2hRdWVyeTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaEVudGl0eS50b0xvd2VyQ2FzZSgpID09PSAnZGVzY3JpcHRpb24nKSB7XG4gICAgICAgICAgICB0aGlzLnJlcXVlc3RPYmplY3RbJ3NlYXJjaG1lc3NhZ2UnXSA9IHRoaXMuc2VhcmNoUXVlcnk7XG4gICAgICAgIH1cblxuICAgICAgICBpZih0aGlzLnN0YXR1c0ZpbHRlciA9PT0gXCJhY3RpdmVcIiApIHtcbiAgICAgICAgICAgIHRoaXMucmVxdWVzdE9iamVjdFsnYWNrZWQnXSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRoaXMuc3RhdHVzRmlsdGVyID09PSBcImRpc21pc3NlZFwiICkge1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0T2JqZWN0WydhY2tlZCddID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLnN0YXR1c0ZpbHRlciA9PT0gXCJib3RoXCIpe1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMucmVxdWVzdE9iamVjdFsnYWNrZWQnXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmV2ZW50U3ZjLmdldExpc3QodGhpcy5yZXF1ZXN0T2JqZWN0KS50aGVuKChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMudG90YWxDb3VudCA9IGRhdGEudG90YWxjb3VudDtcbiAgICAgICAgICAgIHRoaXMudG90YWxQYWdlcyA9IE1hdGguY2VpbChkYXRhLnRvdGFsY291bnQgLyB0aGlzLnBhZ2VTaXplKTtcbiAgICAgICAgICAgIHRoaXMubGlzdCA9IGRhdGEuZXZlbnRzO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0T2JqZWN0WydwYWdlbm8nXSA9IDE7XG4gICAgICAgIHRoaXMucmVxdWVzdE9iamVjdFsnc2V2ZXJpdHknXSA9IHRoaXMuY3JpdGljYWxFdmVudHM7XG4gICAgICAgIHRoaXMuZXZlbnRTdmMuZ2V0TGlzdCh0aGlzLnJlcXVlc3RPYmplY3QpLnRoZW4oKGRhdGE6IGFueSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jcml0aWNhbENvdW50ID0gZGF0YS50b3RhbGNvdW50O1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0T2JqZWN0WydzZXZlcml0eSddID0gdGhpcy53YXJuaW5nRXZlbnRzO1xuICAgICAgICB0aGlzLmV2ZW50U3ZjLmdldExpc3QodGhpcy5yZXF1ZXN0T2JqZWN0KS50aGVuKChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMud2FybmluZ0NvdW50ID0gZGF0YS50b3RhbGNvdW50O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcGFnaW5hdGUocGFnZU5vKSB7XG4gICAgICAgIGlmIChwYWdlTm8gPCAxIHx8IHBhZ2VObyA+IHRoaXMudG90YWxQYWdlcylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5wYWdlTm8gPSBwYWdlTm87XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyB2aWV3RGV0YWlscyhldmVudElkKSB7XG4gICAgICAgIHRoaXMuJGxvY2F0aW9uLnBhdGgoJy9ldmVudHMvJyArIGV2ZW50SWQpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZXNldEZpbHRlcnMoKSB7XG4gICAgICAgIHRoaXMuZmlsdGVyT2JqZWN0ID0ge307XG4gICAgICAgIHRoaXMuZnJvbURhdGVUaW1lRmlsdGVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnRvRGF0ZVRpbWVGaWx0ZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2VhcmNoUXVlcnkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2V2ZXJpdHkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdHVzRmlsdGVyID0gXCJhY3RpdmVcIjtcbiAgICAgICAgdGhpcy5maWx0ZXJPYmplY3RbJ3N0YXR1cyddID0gdGhpcy5zdGF0dXNGaWx0ZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGFwcGx5RmlsdGVyKGtleSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuZmlsdGVyT2JqZWN0W2tleV1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyT2JqZWN0W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2xlYXJGaWx0ZXIoa2V5KSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmZpbHRlck9iamVjdFtrZXldO1xuICAgICAgICB0aGlzLmZyb21EYXRlVGltZUZpbHRlciA9IHRoaXMuZmlsdGVyT2JqZWN0W1wiZnJvbVwiXTtcbiAgICAgICAgdGhpcy50b0RhdGVUaW1lRmlsdGVyID0gdGhpcy5maWx0ZXJPYmplY3RbXCJ0b1wiXTtcbiAgICAgICAgdGhpcy5zZWFyY2hRdWVyeSA9IHRoaXMuZmlsdGVyT2JqZWN0W3RoaXMuc2VhcmNoRW50aXR5XTtcbiAgICAgICAgdGhpcy5zZXZlcml0eSA9IHRoaXMuZmlsdGVyT2JqZWN0W1wic2V2ZXJpdHlcIl07XG4gICAgfVxuXG4gICAgcHVibGljIHNldFNlYXJjaEVudGl0eShlbnRpdHkpIHtcbiAgICAgICAgdGhpcy5zZWFyY2hRdWVyeSA9IFwiXCI7XG4gICAgICAgIHRoaXMuc2VhcmNoRW50aXR5ID0gZW50aXR5O1xuICAgICAgICBkZWxldGUgdGhpcy5maWx0ZXJPYmplY3RbJ2NsdXN0ZXInXTtcbiAgICAgICAgZGVsZXRlIHRoaXMuZmlsdGVyT2JqZWN0Wydob3N0J107XG4gICAgICAgIGRlbGV0ZSB0aGlzLmZpbHRlck9iamVjdFsnZGVzY3JpcHRpb24nXTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZGlzbWlzcyhldmVudElkKSB7XG4gICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gdGhpcy5tb2RhbFN2Yyh7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2V2ZW50cy9ldmVudC1kaXNtaXNzLnRwbC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2V2ZW50JyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnRXZlbnRTZXJ2aWNlJywgJ2dyb3dsJywgZnVuY3Rpb24oZXZlbnRTdmM6IEV2ZW50U2VydmljZSwgZ3Jvd2w6IGFueSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzbWlzc01lc3NhZ2UgPSBcIlwiO1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gXCJcIjtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc21pc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRTdmMuZGlzbWlzcyhldmVudElkLCB0aGlzLmRpc21pc3NNZXNzYWdlKS50aGVuKHN0YXR1cyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlLiRzY29wZS4kaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3Jvd2wuc3VjY2VzcyhcIkV2ZW50IERpc21pc3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goc3RhdHVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JNZXNzYWdlID0gc3RhdHVzLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBncm93bC5lcnJvcihzdGF0dXMuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0pO1xuICAgIH1cblxuXG59XG4iXX0=
